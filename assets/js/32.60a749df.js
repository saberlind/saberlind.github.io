(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{555:function(s,t,a){"use strict";a.r(t);var e=a(4),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"_1-presto-简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-presto-简介"}},[s._v("#")]),s._v(" 1.  Presto 简介")]),s._v(" "),a("h3",{attrs:{id:"_1-1-presto-概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-presto-概念"}},[s._v("#")]),s._v(" 1.1 Presto 概念")]),s._v(" "),a("blockquote",[a("ul",[a("li",[s._v("Presto是一个开源的分布式 SQL 查询引擎，数据量支持GB到PB字节，主要用来处理秒级查询的场景。")]),s._v(" "),a("li",[s._v("虽然Presto可以解析SQL，但它不是一个标准的数据库。不是MySQL、Oracle的代替品，也不能用来处理在线事务（OLTP）")])])]),s._v(" "),a("h3",{attrs:{id:"_1-2-presto-架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-presto-架构"}},[s._v("#")]),s._v(" 1.2 Presto 架构")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/presto%2Fpresto_frwk.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"_1-3-presto-优缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-presto-优缺点"}},[s._v("#")]),s._v(" 1.3 Presto 优缺点")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/presto%2Fmeritanddemerit.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"_1-4-presto、impala-性能比较"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-presto、impala-性能比较"}},[s._v("#")]),s._v(" 1.4 Presto、Impala 性能比较")]),s._v(" "),a("blockquote",[a("p",[s._v("​\tImpala性能稍领先于Presto，但是Presto在数据源支持上非常丰富，包括Hive、图数据库、传统关系型数据库、Redis等。")])]),s._v(" "),a("h2",{attrs:{id:"_2-presto-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-presto-安装"}},[s._v("#")]),s._v(" 2. Presto 安装")]),s._v(" "),a("h3",{attrs:{id:"_2-1-presto-server安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-presto-server安装"}},[s._v("#")]),s._v(" 2.1 Presto Server安装")]),s._v(" "),a("p",[s._v("https://prestodb.github.io/")]),s._v(" "),a("p",[s._v("https://repo1.maven.org/maven2/com/facebook/presto/presto-server/0.196/presto-server-0.196.tar.gz")]),s._v(" "),a("p",[s._v("进入 Presto目录，创建存储数据文件夹和存储配置文件的文件夹")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" data\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" etc\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("etc/jvm.config")]),s._v(" "),a("div",{staticClass:"language-config line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("-server\n-Xmx16G\n-XX:+UseG1GC\n-XX:G1HeapRegionSize=32M\n-XX:+UseGCOverheadLimit\n-XX:+ExplicitGCInvokesConcurrent\n-XX:+HeapDumpOnOutOfMemoryError\n-XX:+ExitOnOutOfMemoryError\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("etc/catalog/hive.properties")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("connector.name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("hive-hadoop2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("hive.metastore.uri")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("thrift://hadoop102:9083")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("xsync presto\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("进入每台节点的 presto/etc 路径下")]),s._v(" "),a("p",[s._v("etc/node.properties （确保每台节点的 node.id 不同）")]),s._v(" "),a("div",{staticClass:"language-pro line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("node.environment=production\nnode.id=ffffffff-ffff-ffff-ffff-ffffffffffff\nnode.data-dir=/opt/module/presto/data\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("Presto是由一个coordinator节点和多个worker节点组成。在hadoop102上配置成coordinator，在hadoop103、hadoop104上配置为worker。")]),s._v(" "),a("p",[s._v("[102 ] etc/config.properties")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("coordinator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("node-scheduler.include-coordinator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("false")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("http-server.http.port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("8881")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("query.max-memory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("50GB")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("discovery-server.enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("discovery.uri")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("http://hadoop102:8881")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("[103/104] etc/config.properties")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("coordinator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("false")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("http-server.http.port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("8881")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("query.max-memory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("50GB")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("discovery.uri")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("http://hadoop102:8881")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("102 启动Hive Metastore")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" bin/hive --service metastore "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("三台节点各自启动")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 前台启动")]),s._v("\nbin/launcher run\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 后台启动")]),s._v("\nbin/launcher start\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("日志查看路径/opt/module/presto/data/var/log")]),s._v(" "),a("h3",{attrs:{id:"_2-2-presto命令行client安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-presto命令行client安装"}},[s._v("#")]),s._v(" 2.2 Presto命令行Client安装")]),s._v(" "),a("p",[s._v("https://repo1.maven.org/maven2/com/facebook/presto/presto-cli/0.196/presto-cli-0.196-executable.jar")]),s._v(" "),a("p",[s._v("将 jar 包放到 presto目录下，并更名为 prestocli")]),s._v(" "),a("p",[s._v("启动")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("./prestocli --server hadoop102:8881 --catalog hive --schema default\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("Presto的命令行操作，相当于Hive命令行操作。每个表必须要加上schema。\n例如：\n"),a("code",[s._v("select * from schema.table limit 100")])]),s._v(" "),a("h3",{attrs:{id:"_2-3-presto可视化client安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-presto可视化client安装"}},[s._v("#")]),s._v(" 2.3 Presto可视化Client安装")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" yanagishima-18.0.zip\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" yanagishima-18.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("yanagishima-18.0/conf")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" yanagishima.properties\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("jetty.port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("7080")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("presto.datasources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("saberlind-presto")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("presto.coordinator.server.saberlind-presto")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("http://hadoop102:8881")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("catalog.saberlind-presto")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("hive")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("schema.saberlind-presto")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("gmall")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sql.query.engines")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("presto")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("yanagishima-18.0/")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" bin/yanagishima-start.sh "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("y.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("http://hadoop102:7080")]),s._v(" "),a("h2",{attrs:{id:"_3-presto-优化之数据存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-presto-优化之数据存储"}},[s._v("#")]),s._v(" 3. Presto 优化之数据存储")]),s._v(" "),a("h3",{attrs:{id:"_3-1-合理设置分区"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-合理设置分区"}},[s._v("#")]),s._v(" 3.1 合理设置分区")]),s._v(" "),a("blockquote",[a("p",[s._v("与Hive类似，Presto会根据元数据信息读取分区数据，合理的分区能减少Presto数据读取量，提升查询性能。")])]),s._v(" "),a("h3",{attrs:{id:"_3-2-使用列式存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-使用列式存储"}},[s._v("#")]),s._v(" 3.2 使用列式存储")]),s._v(" "),a("blockquote",[a("p",[s._v("​\tPresto对ORC文件读取做了特定优化，因此在Hive中创建Presto使用的表时，建议采用ORC格式存储。相对于Parquet，Presto对ORC支持更好。")])]),s._v(" "),a("h3",{attrs:{id:"_3-3-使用压缩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-使用压缩"}},[s._v("#")]),s._v(" 3.3 使用压缩")]),s._v(" "),a("blockquote",[a("p",[s._v("数据压缩可以减少节点间数据传输对IO带宽压力，对于即席查询需要快速解压，建议采用Snappy压缩。")])]),s._v(" "),a("h2",{attrs:{id:"_4-presto优化之查询sql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-presto优化之查询sql"}},[s._v("#")]),s._v(" 4. Presto优化之查询SQL")]),s._v(" "),a("h3",{attrs:{id:"_4-1-只选择使用的字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-只选择使用的字段"}},[s._v("#")]),s._v(" 4.1 只选择使用的字段")]),s._v(" "),a("blockquote",[a("p",[s._v("由于采用列式存储，选择需要的字段可加快字段的读取、减少数据量。避免采用*读取所有字段。")])]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("GOOD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" tbl\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("BAD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" tbl\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_4-2-过滤条件必须加上分区字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-过滤条件必须加上分区字段"}},[s._v("#")]),s._v(" 4.2 过滤条件必须加上分区字段")]),s._v(" "),a("blockquote",[a("p",[s._v("​\t对于有分区的表，where语句中优先使用分区字段进行过滤。acct_day是分区字段，visit_time是具体访问时间。")])]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("GOOD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" tbl "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" acct_day"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20171101")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("BAD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" tbl "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" visit_time"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20171101")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_4-3-group-by语句优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-group-by语句优化"}},[s._v("#")]),s._v(" 4.3 Group By语句优化")]),s._v(" "),a("blockquote",[a("p",[s._v("​\t合理安排Group by语句中字段顺序对性能有一定提升。将Group By语句中字段按照每个字段distinct数据多少进行降序排列。")])]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("GOOD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GROUP")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" uid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" gender\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("BAD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GROUP")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" gender"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" uid\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_4-4-order-by时使用limit"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-order-by时使用limit"}},[s._v("#")]),s._v(" 4.4 Order by时使用Limit")]),s._v(" "),a("blockquote",[a("p",[s._v("​\tOrder by需要扫描数据到单个worker节点进行排序，导致单个worker需要大量内存。如果是查询Top N或者Bottom N，使用limit可减少排序计算和内存压力。")])]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("GOOD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" tbl "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("time")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LIMIT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("BAD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" tbl "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("time")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_4-5-使用join语句时将大表放在左边"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-使用join语句时将大表放在左边"}},[s._v("#")]),s._v(" 4.5 使用Join语句时将大表放在左边")]),s._v(" "),a("blockquote",[a("p",[s._v("​\tPresto中join的默认算法是broadcast join，即将join左边的表分割到多个worker，然后将join右边的表数据整个复制一份发送到每个worker进行计算。如果右边的表数据量太大，则可能会报内存溢出错误。")])]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("GOOD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" large_table l "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("join")]),s._v(" small_table s "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" l"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("BAD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" small_table s "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("join")]),s._v(" large_table l "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" l"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"_5-注意事项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-注意事项"}},[s._v("#")]),s._v(" 5. 注意事项")]),s._v(" "),a("h3",{attrs:{id:"_5-1-字段名引用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-字段名引用"}},[s._v("#")]),s._v(" 5.1 字段名引用")]),s._v(" "),a("blockquote",[a("p",[s._v("​\t避免和关键字冲突：MySQL对字段加反引号`、Presto对字段加双引号分割；当然，如果字段名称不是关键字，可以不加这个双引号。")])]),s._v(" "),a("h3",{attrs:{id:"_5-2-时间函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-时间函数"}},[s._v("#")]),s._v(" 5.2 时间函数")]),s._v(" "),a("blockquote",[a("p",[s._v("​\t对于Timestamp，需要进行比较的时候，需要添加Timestamp关键字，而MySQL中对Timestamp可以直接进行比较。")])]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*MySQL的写法*/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" t "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" a "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" t "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2017-01-01 00:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*Presto中的写法*/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" t "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" a "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" t "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("timestamp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2017-01-01 00:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"_5-3-不支持insert-overwrite语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-不支持insert-overwrite语法"}},[s._v("#")]),s._v(" 5.3 不支持INSERT OVERWRITE语法")]),s._v(" "),a("blockquote",[a("p",[s._v("Presto中不支持insert overwrite语法，只能先delete，然后insert into。")])]),s._v(" "),a("h3",{attrs:{id:"_5-4-parquet格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-parquet格式"}},[s._v("#")]),s._v(" 5.4 PARQUET格式")]),s._v(" "),a("blockquote",[a("p",[s._v("Presto目前支持Parquet格式，支持查询，但不支持insert。")])])])}),[],!1,null,null,null);t.default=r.exports}}]);