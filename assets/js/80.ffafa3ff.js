(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{605:function(s,a,e){"use strict";e.r(a);var t=e(4),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"_1-mysql安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-mysql安装"}},[s._v("#")]),s._v(" 1.MySQL安装")]),s._v(" "),e("p",[s._v("第一步：检查linux是否已经自带了mariadb分支，如果携带了，先卸载\nrpm -qa | grep mariadb\nrpm -e mariadb-libs-5.5.56-2.el7.x86_64 --nodeps\n第二步：准备mysql安装所需要的环境\nchmod -R 777 /tmp\nrpm -qa|grep libaio\nrpm -qa|grep net-tools\n第三步：安装mysql(需要按着顺序安装)\t\nrpm -ivh mysql-community-common-xxx.rpm\nrpm -ivh mysql-community-libs-xxx.rpm\nrpm -ivh mysql-community-client-xxx.rpm\nrpm -ivh mysql-community-server-xxx.rpm")]),s._v(" "),e("p",[s._v("第四步：先为root用户生成一个登录的临时密码")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("mysqld --initialize --user"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /var/log/mysqld.log: 查看临时密码:7aVAUIyMFC*I\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("第五步：启动mysql，首次登录及时修改root用户的密码\nsystemctl start|stop|restart|status|enable|disable mysqld")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("mysql -u root -p\n修改密码：ALTER "),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),s._v("@"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),s._v(" IDENTIFIED BY "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("第六步：检查mysql自带的字符集是啥？latin1不支持中文，utf8支持中文\nshow variables like '%character%' ;\n如果出现了latin1，说明不支持中文，如果想让mysql支持中文，需要修改字符集。\nvim /etc/my.cnf\n[client]   （没有client就自己添加）\ndefault-character-set=utf8\n[mysqld]\ncharacter-set-server=utf8\ncollation-server=utf8_general_ci")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("systemctl restart mysqld:重启 \n第七步：正常使用：\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("mysql的安装目录")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("参数")]),s._v(" "),e("th",[s._v("路径")]),s._v(" "),e("th",[s._v("解释")]),s._v(" "),e("th",[s._v("备注")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("--basedir")]),s._v(" "),e("td",[s._v("/usr/bin")]),s._v(" "),e("td",[s._v("相关命令目录")]),s._v(" "),e("td",[s._v("mysqladmin mysqldump等命令")])]),s._v(" "),e("tr",[e("td",[s._v("--datadir")]),s._v(" "),e("td",[s._v("/var/lib/mysql/")]),s._v(" "),e("td",[s._v("mysql数据库文件的存放路径")]),s._v(" "),e("td")]),s._v(" "),e("tr",[e("td",[s._v("--plugin-dir")]),s._v(" "),e("td",[s._v("/usr/lib64/mysql/plugin")]),s._v(" "),e("td",[s._v("mysql插件存放路径")]),s._v(" "),e("td")]),s._v(" "),e("tr",[e("td",[s._v("--log-error")]),s._v(" "),e("td",[e("strong",[s._v("/var/log/mysqld.log")])]),s._v(" "),e("td",[s._v("mysql错误日志路径")]),s._v(" "),e("td")]),s._v(" "),e("tr",[e("td",[s._v("--pid-file")]),s._v(" "),e("td",[s._v("/var/run/mysqld/mysqld.pid")]),s._v(" "),e("td",[s._v("进程pid文件")]),s._v(" "),e("td")]),s._v(" "),e("tr",[e("td",[s._v("--socket")]),s._v(" "),e("td",[s._v("/var/lib/mysql/mysql.sock")]),s._v(" "),e("td",[s._v("本地连接时用的unix套接字文件")]),s._v(" "),e("td")]),s._v(" "),e("tr",[e("td"),s._v(" "),e("td",[s._v("/usr/share/mysql")]),s._v(" "),e("td",[s._v("配置文件目录")]),s._v(" "),e("td",[s._v("mysql脚本及配置文件")])]),s._v(" "),e("tr",[e("td"),s._v(" "),e("td",[s._v("/etc/systemd/system/multi-user.target.wants/mysqld.service")]),s._v(" "),e("td",[s._v("服务启停相关脚本")]),s._v(" "),e("td")]),s._v(" "),e("tr",[e("td"),s._v(" "),e("td",[e("strong",[s._v("/etc/my.cnf")])]),s._v(" "),e("td",[s._v("mysql配置文件")]),s._v(" "),e("td",[s._v("cat /etc/my.cnf")])])])]),s._v(" "),e("h2",{attrs:{id:"_2-mysql用户管理和权限管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-mysql用户管理和权限管理"}},[s._v("#")]),s._v(" 2.MySQL用户管理和权限管理")]),s._v(" "),e("p",[e("strong",[s._v("用户管理")]),s._v("：\n用户添加:\ncreate user 用户名 identified by '密码';\n用户删除:\ndrop user 用户名;\n注意：不要使用delete from user where :删除的不彻底\n用户修改:\n修改用户信息之后，一定要刷新权限。\nupdate user set 字段1=值1,字段2=值2 where条件\nflush privileges;\n用户查询:\nselect host,user,authentication_string from mysql.user;")]),s._v(" "),e("p",[s._v("​\t\t\t  host:  表示在哪个ip的机子上的可以连接当前mysql服务器\n​\t\t\t  localhost: 表示在mysql服务器所在linux系统可以使用客户端连接\n​\t\t\t  %        : 表示在任意客户端都可以连接当前mysql服务器\n​\t\t\t  ip       ：表示在指定的ip这台机子上使用客户端连接当前mysql服务器\n​\t\t\t  主机名   : 表示在指定的ip这台机子上使用客户端连接当前mysql服务器")]),s._v(" "),e("p",[s._v("​\t\t\tuser: 当前用户名\n​\t\t\tauthentication_string:密码，password('明文')")]),s._v(" "),e("p",[s._v("防火墙操作\nsystemctl start|status|stop|enable|disable firewalld")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("firewall-cmd --add-port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("/tcp --permanent:放开某个端口号\nfirewall-cmd --reload:重新加载\nfirewall-cmd --list-all:查看防火墙放开的端口号\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("权限管理：\t"),e("br"),s._v("\n授予权限：\n语法：grant 权限1,权限2,…权限n on 数据库名称.表名称 to 用户名@用户地址 identified by ‘连接口令’;\n案例1：\ncreate user liangchun identified by '123456';\ngrant insert,select,update on test.* to liangchun@'%';\n案例2： \t\ngrant all privileges on "),e("em",[s._v(".")]),s._v(" to yangqun@'%' identified by '123456';\n收回权限：\n语法：revoke 权限1,权限2,…权限n on 数据库名称.表名称 from 用户名@用户地址;\n案例1:\nrevoke insert,select,update on test.* from liangchun@'%';\n案例2:\nrevoke all privileges on "),e("em",[s._v(".")]),s._v(" from yangqun@'%';\n查看某用户的全局权限：select  * from mysql.user ;")]),s._v(" "),e("h2",{attrs:{id:"_3-mysql会话"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-mysql会话"}},[s._v("#")]),s._v(" 3.MySQL会话")]),s._v(" "),e("p",[s._v("局部会话：在局部会话中设置的变量只对当前窗口起作用。\n读取                                          \t\t\t\t修改\nshow variables like '%变量名%';              \t  set 变量名=值\nshow session variables like '%变量名%';      set session 变量名=值")]),s._v(" "),e("p",[s._v("全局会话：在全局会话中设置的变量只对所有窗口起作用。\nshow global variables like '%变量名%';       \tset global 变量名=值")]),s._v(" "),e("p",[s._v("无论是局部变量还是全局变量，等mysql服务器重启之后，这些设置都会失效，如果想让这些设置永久生效，在\nmysql配置文件中配置./etc/my.cnf")]),s._v(" "),e("h2",{attrs:{id:"_4-查询案例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-查询案例"}},[s._v("#")]),s._v(" 4.查询案例")]),s._v(" "),e("h3",{attrs:{id:"where和having的区别"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#where和having的区别"}},[s._v("#")]),s._v(" where和having的区别")]),s._v(" "),e("p",[s._v("where:")]),s._v(" "),e("ul",[e("li",[s._v("where是一个约束声明，使用where来约束来自数据库的数据")]),s._v(" "),e("li",[s._v("where是在结果返回之前起作用的")]),s._v(" "),e("li",[s._v("where中不能使用聚合函数")])]),s._v(" "),e("p",[s._v("having:")]),s._v(" "),e("ul",[e("li",[s._v("having是一个过滤声明")]),s._v(" "),e("li",[s._v("在查询返回结果集以后，对查询结果进行的过滤操作")]),s._v(" "),e("li",[s._v("在having中可以使用聚合函数")])]),s._v(" "),e("blockquote",[e("p",[s._v("分组查询时，select 的列必须要是group by后面的字段，或者函数(count *)")])]),s._v(" "),e("ol",[e("li",[s._v("求每个部门年龄最大的人")])]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("select * from mytbl2 t1 inner join(select dept,max(age) max_age from mytbl2 group by dept) tmp on t1.age = tmp.max_age and t1.dept = tmp.dept\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ol",{attrs:{start:"2"}},[e("li",[s._v("求每个部门年龄第二大的人")])]),s._v(" "),e("p",[s._v("mysql5.5版本的SQL_MODE不严格：")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("mysql5.7版本的SQL_MODE比较严格,严格是好事，错误的SQL及脏数据就可以避免掉了。")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[s._v("ONLY_FULL_GROUP_BY: 一旦在SQL语句中使用了group by分组，那么select 后面的列要么是出现在group by之后,要么是聚合函数(count、max、min、avg、sum)\nSTRICT_TRANS_TABLES: 表示开启严格模式,控制着数据的格式。\n\nNO_ZERO_IN_DATE: 表示不能在月份和日 这两个字段出现纯0,但是：0000-00-00例外。\n                 \nNO_ZERO_DATE:    表示在年、月和日 这三个字段不同同时全为0,0000-00-00。\n\nERROR_FOR_DIVISION_BY_ZERO: 设置了这一项之后，除数不能为0.\n\nNO_AUTO_CREATE_USER: 禁止GRANT创建密码为空的用户\nNO_ENGINE_SUBSTITUTION: 如果需要的存储引擎被禁用或不存在，那么抛出错误。不设置此值时，用默认的存储引擎替代\n")])])]),e("h2",{attrs:{id:"_5-mysql的架构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-mysql的架构"}},[s._v("#")]),s._v(" 5.MySQL的架构")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/2021/11/16/45dda25b300cb.png",alt:"MySQL架构.png"}})]),s._v(" "),e("h3",{attrs:{id:"_1-解析器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-解析器"}},[s._v("#")]),s._v(" 1.解析器")]),s._v(" "),e("p",[s._v("手写的SQL:")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("select  distinct 列1,列2,\nfrom 表名1\nleft join 表2\non 连接条件\nwhere 过滤条件\ngroup by 分组字段1，分组字段2\nhaving 聚合函数进一步过滤\norder by 排序字段1，排序字段2\nlimit offset,size\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("机读的SQL:")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("from 表1\non 连接条件\njoin 表2\nwhere 过滤条件\ngroup by 分组字段1，分组字段2\nhaving 聚合函数进一步过滤\nselect  distinct 列1,列2\norder by 排序字段1，排序字段2\nlimit offset,size\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("h3",{attrs:{id:"_2-优化器-optimizer"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-优化器-optimizer"}},[s._v("#")]),s._v(" 2.优化器(optimizer)")]),s._v(" "),e("blockquote",[e("p",[s._v("explain+SQL查询语句：查看SQL语句的执行路径")])]),s._v(" "),e("h3",{attrs:{id:"_3-存储引擎"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-存储引擎"}},[s._v("#")]),s._v(" 3.存储引擎")]),s._v(" "),e("ol",[e("li",[s._v("查看mysql支持哪些数据引擎")])]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("show engines;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("MyISAM引擎和Innodb引擎区别：")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th"),s._v(" "),e("th",[s._v("MyISAM引擎")]),s._v(" "),e("th",[s._v("Innodb引擎")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("是否支持事务")]),s._v(" "),e("td",[s._v("No")]),s._v(" "),e("td",[s._v("Yes")])]),s._v(" "),e("tr",[e("td",[s._v("行表锁")]),s._v(" "),e("td",[s._v("表锁，即使操作一条记录也会锁住整个表，并发弱")]),s._v(" "),e("td",[s._v("行锁，操作时只锁某一行，并发强")])]),s._v(" "),e("tr",[e("td",[s._v("是否支持外键")]),s._v(" "),e("td",[s._v("No")]),s._v(" "),e("td",[s._v("Yes")])]),s._v(" "),e("tr",[e("td",[s._v("是否支持XA协议")]),s._v(" "),e("td",[s._v("NO")]),s._v(" "),e("td",[s._v("Yes")])]),s._v(" "),e("tr",[e("td",[s._v("读的性能")]),s._v(" "),e("td",[s._v("高")]),s._v(" "),e("td",[s._v("低")])]),s._v(" "),e("tr",[e("td",[s._v("是否支持聚簇索引")]),s._v(" "),e("td",[s._v("No")]),s._v(" "),e("td",[s._v("Yes")])]),s._v(" "),e("tr",[e("td",[s._v("数据的组织结构")]),s._v(" "),e("td",[s._v("3个文件")]),s._v(" "),e("td",[s._v("2个文件")])]),s._v(" "),e("tr",[e("td",[s._v("是否支持MVCC机制")]),s._v(" "),e("td",[s._v("No")]),s._v(" "),e("td",[s._v("Yes")])]),s._v(" "),e("tr",[e("td",[s._v("适用场景")]),s._v(" "),e("td",[s._v("从机slave")]),s._v(" "),e("td",[s._v("主机master")])])])]),s._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[s._v("每一张对应一个数据库引擎")]),s._v(" "),e("li",[s._v("如何查看某张表的数据库引擎")])]),s._v(" "),e("p",[s._v("https://dev.mysql.com/doc/refman/5.7/en/storage-engines.html")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("show table status from 数据库名;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ol",{attrs:{start:"4"}},[e("li",[s._v("如何修改一张表对应的数据库引擎")])]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("alter table 表名 engine = '数据库引擎';\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ol",{attrs:{start:"5"}},[e("li",[s._v("查看数据库及表存在磁盘的哪个目录")])]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("show variables like 'datadir';\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ol",{attrs:{start:"6"}},[e("li",[e("p",[s._v("Innodb与MyISAM引擎底层存储结构")]),s._v(" "),e("p",[s._v("Innodb引擎:")]),s._v(" "),e("p",[s._v("​\txxx.frm:存储表结构")]),s._v(" "),e("p",[s._v("​\txxx.ibd:存储表数据和索引")]),s._v(" "),e("p",[s._v("MyISAM引擎:")]),s._v(" "),e("p",[s._v("​\txxx.frm:存储表结构")]),s._v(" "),e("p",[s._v("​\txxx.MYD:存储的表数据")]),s._v(" "),e("p",[s._v("​    xxx.MYI:存储的表索引")])]),s._v(" "),e("li",[e("p",[s._v("mysql的数据库引擎支持自定义")])])]),s._v(" "),e("p",[s._v("https://dev.mysql.com/doc/internals/en/custom-engine.html")]),s._v(" "),e("h3",{attrs:{id:"_4-缓存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-缓存"}},[s._v("#")]),s._v(" 4.缓存")]),s._v(" "),e("p",[s._v("查看SQL的是否走了查询缓存及SQL语句的消耗时间")]),s._v(" "),e("p",[s._v("1.开启查询缓存")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/my.cnf\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("query_cache_type")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mysqld标签内"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nsystemctl restart mysqld\nshow variables like "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'query_cache%'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("2.开启查询，执行计划")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("show variables like '%profiling%';  默认没有开启\nset profiling=1;  临时开启\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("3.执行语句两次：select * from mydbl2 where id=1;")]),s._v(" "),e("p",[s._v("4.执行show profiles;  查看最近几条SQL语句的消耗时间")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("show profiles;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("5.确认某条SQL语句是否真的走了查询缓存")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("show profile block io,cpu for query 3;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("如果想让一条SQL语句能从查询缓存中得到数据需要满足什么条件？")]),s._v(" "),e("ol",[e("li",[s._v("要求这条查询SQL肯定不是第一次执行。")]),s._v(" "),e("li",[s._v("要求后面执行的查询SQL要和前面的查询SQL保持完全一致。[大小写一致、空格也不要多]")]),s._v(" "),e("li",[s._v("在两次查询之间不能有增删改语句。")])])]),s._v(" "),e("h2",{attrs:{id:"_6-索引"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-索引"}},[s._v("#")]),s._v(" 6.索引")]),s._v(" "),e("p",[s._v("定义：一种排好序的数据结构，便于快速查询[定位]某些数据。")]),s._v(" "),e("p",[s._v("优势：")]),s._v(" "),e("ol",[e("li",[s._v("减少IO操作。")]),s._v(" "),e("li",[s._v("减少CPU操作。")])]),s._v(" "),e("p",[s._v("劣势：")]),s._v(" "),e("ol",[e("li",[s._v("索引也是一种数据结构，本身也是占空间大小。不是说为表创建的索引越多越好。")]),s._v(" "),e("li",[s._v("创建了索引之后，降低对表增删改速度。")])]),s._v(" "),e("p",[s._v("索引：底层数据结构用的是"),e("strong",[s._v("B+Ttree")])]),s._v(" "),e("p",[s._v("ES:倒排索引[站内搜索]")]),s._v(" "),e("h3",{attrs:{id:"b-ttree相比于btree的优势"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#b-ttree相比于btree的优势"}},[s._v("#")]),s._v(" "),e("strong",[s._v("B+Ttree相比于BTree的优势：")])]),s._v(" "),e("ol",[e("li",[s._v("B+Ttree根节点和枝节点没有存储行数据的地址值，只有叶子节点存储数据，每次加载时，一片叶子能够存储更多的索引节点。")]),s._v(" "),e("li",[s._v("B+Ttree叶子节点有指向相邻叶子节点的双向指针，便于范围查询。")]),s._v(" "),e("li",[s._v("根据左闭右开区间来检索数据")])]),s._v(" "),e("p",[s._v("1）B+ 树和 B 树的差异")]),s._v(" "),e("p",[s._v("（1）B+树中非叶子节点的关键字也会同时存在子节点中，并且是在子节点中所有关键字的最大值（或最小）。")]),s._v(" "),e("p",[s._v("（2）B+树中非叶子节点仅用于索引，不保存数据记录，跟记录有关的信息都放在叶子节点中。而B树中，非叶子节点既保存索引，也保存数据记录。")]),s._v(" "),e("p",[s._v("（3）B+树中所有关键字都在叶子节点出现，叶子节点构成一个有序链表，而且叶子节点本身按照关键字的大小从小到大顺序链接。")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/2021/12/24/e48e3fa8a6542.png",alt:"图片1.png"}})]),s._v(" "),e("blockquote",[e("p",[s._v("举个例子：假设一条记录是 1K，一个叶子节点（一页）可以存储 16 条记录。非叶 子节点可以存储多少个指针？ 假设索引字段是 bigint 类型，长度为 8 字节。指针大小在 InnoDB 源码中设置为 6 字节，这样一共 14 字节。非叶子节点（一页）可以存储 16384/14=1170 个这样的 单元（键值+指针），代表有 1170 个指针。 树 深 度 为 2 的 时 候 ， 有 1170^2 个 叶 子 节 点 ， 可 以 存 储 的 数 据 为 1170"),e("em",[s._v("1170")]),s._v("16=21902400。也就是说，一张 2000 万左右的表，查询 数据最多需要访问 3 次磁盘。 所以在 InnoDB 中 B+ 树深度一般为 1-3 层，它就能满足千万级的数据存储。")])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/2021/12/24/77c9c4f840a60.png",alt:"图片2.png"}})]),s._v(" "),e("h3",{attrs:{id:"mysql索引"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mysql索引"}},[s._v("#")]),s._v(" MySQL索引")]),s._v(" "),e("h4",{attrs:{id:"聚簇索引与非聚簇索引"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#聚簇索引与非聚簇索引"}},[s._v("#")]),s._v(" 聚簇索引与非聚簇索引")]),s._v(" "),e("ul",[e("li",[s._v("聚簇索引并不是一种单独的索引类型，而是一种数据存储方式")]),s._v(" "),e("li",[s._v("索引键值的逻辑顺序跟表数据行的物理存储顺序一致")]),s._v(" "),e("li",[s._v("在 InnoDB 里面，它组织数据的方式叫做叫做（聚集）索引组织表（clustered index organize table），所以主键索引是聚簇索引，非主键都是非聚簇索引")])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/2021/11/17/932ecd86b238a.png",alt:"聚簇索引.png"}})]),s._v(" "),e("p",[s._v("如果 InnoDB 里面主键是这样存储的，那主键之外的索引，比如我们在 name 字段 上面建的普通索引，又是怎么存储和检索数据的呢？")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/2021/11/17/dcd56724843ac.png",alt:"非主键索引.png"}})]),s._v(" "),e("p",[s._v("如果使用辅助索引查询，会根据主键值在主键索引中查询，最终取得数据。")]),s._v(" "),e("p",[s._v("比如我们用 name 索引查询 name= 'Qingshan'，它会在叶子节点找到主键值，也就是 id=1，然后再到主键索引的叶子节点拿到数据。一个问题，如果一张表没有主键怎么办？")]),s._v(" "),e("p",[s._v("1、 如果我们定义了主键(PRIMARY KEY)，那么 InnoDB 会选择主键作为聚集索引。")]),s._v(" "),e("p",[s._v("2、如果没有显式定义主键，则 InnoDB 会选择第一个不包含有 NULL 值的唯一索引 作为主键索引。")]),s._v(" "),e("p",[s._v("3、如果也没有这样的唯一索引，则 InnoDB 会选择内置 6 字节长的 ROWID 作为隐藏的聚集索引，它会随着行记录的写入而主键递增。(_rowid:隐含、自增的)")]),s._v(" "),e("p",[s._v("4、select _rowid from 表名;")]),s._v(" "),e("p",[e("strong",[s._v("聚簇索引的好处：")])]),s._v(" "),e("ul",[e("li",[s._v("按照聚簇索引排列顺序，查询显示一定范围数据的时候，由于数据都是紧密相连，数据库不用从多个数据块中提取数据，所以节省了大量的io操作。")])]),s._v(" "),e("p",[e("strong",[s._v("聚簇索引的限制：")])]),s._v(" "),e("ul",[e("li",[e("p",[s._v("对于MySQL数据库目前只有"),e("strong",[s._v("innodb")]),s._v("数据引擎支持聚簇索引，而Myisam并不支持聚簇索引。")])]),s._v(" "),e("li",[e("p",[s._v("由于数据物理存储排序方式只能有一种，所以每个MySQL的表只能有一个聚簇索引。一般情况下就是该表的主键。")])]),s._v(" "),e("li",[e("p",[s._v("为了充分利用聚簇索引的聚簇的特性，所以innodb表的主键列"),e("strong",[s._v("尽量选用有序的顺序id")]),s._v("，而不建议用无序的id，比如uuid这种。")])])]),s._v(" "),e("h4",{attrs:{id:"myisam"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#myisam"}},[s._v("#")]),s._v(" MyISAM")]),s._v(" "),e("p",[s._v("在 MyISAM 里面，另外有两个文件：")]),s._v(" "),e("p",[s._v("一个是.MYD 文件，D 代表 Data，是 MyISAM 的数据文件，存放数据记录,比如我们的 user_myisam 表的所有的表数据。")]),s._v(" "),e("p",[s._v("一个是.MYI 文件，I 代表 Index，是 MyISAM 的索引文件，存放索引，比如我们在 id 字段上面创建了一个主键索引，那么主键索引就是在这个索引文件里面。")]),s._v(" "),e("p",[s._v("也就是说，在 MyISAM 里面，索引和数据是两个独立的文件。 那我们怎么根据索引找到数据呢？ MyISAM 的 B+Tree 里面，叶子节点存储的是数据文件对应的磁盘地址。所以从索引文件.MYI 中找到键值后，会到数据文件.MYD 中获取相应的数据记录。")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/2021/11/17/9176b86c0e504.png",alt:"MyISAM.png"}})]),s._v(" "),e("p",[s._v("数据和索引是分开存放的。("),e("strong",[s._v("MyISAM引擎支持主键索引，但是没有聚簇索引(聚簇索引数据和索引在一起。只有Innodb引擎有聚簇索引")]),s._v("))")]),s._v(" "),e("h4",{attrs:{id:"小结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[s._v("#")]),s._v(" 小结")]),s._v(" "),e("p",[s._v("只有InnoDB引擎支持聚簇索引，聚簇索引索引键值的逻辑顺序跟表数据行的物理存储顺序是一致的。便于范围查询。")]),s._v(" "),e("p",[s._v("MyISAM引擎：只有主键索引，没有聚簇索引。")]),s._v(" "),e("p",[s._v("确切的说是：")]),s._v(" "),e("ol",[e("li",[e("p",[s._v("在Innodb引擎中，主键索引也即聚簇索引。")])]),s._v(" "),e("li",[e("p",[s._v("在MyISAM引擎中，主键索引和辅助索引的搜索是一样的。")])]),s._v(" "),e("li",[e("p",[s._v("在MyISAM引擎中，没有聚簇索引。")])]),s._v(" "),e("li",[e("p",[s._v("在Innodb引擎中，主键索引(聚簇索引)和辅助索引(存储的是索引值和主键值)的搜索是不太一样。")])]),s._v(" "),e("li",[e("p",[s._v("只有Innodb引擎支持回表查询。(辅助索引存储的是辅助索引和主键值：上图的Innodb就是回表查询)")])])]),s._v(" "),e("h3",{attrs:{id:"mysql索引分类"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mysql索引分类"}},[s._v("#")]),s._v(" MySQL索引分类")]),s._v(" "),e("h4",{attrs:{id:"单值索引"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#单值索引"}},[s._v("#")]),s._v(" 单值索引")]),s._v(" "),e("p",[s._v("即一个索引只包含单个列，一个表可以有多个单列索引")]),s._v(" "),e("p",[s._v("语法：")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("随表一起建索引：\nCREATE TABLE customer (\n  id INT(10) UNSIGNED  AUTO_INCREMENT ,\n  customer_no VARCHAR(200),\n  customer_name VARCHAR(200),\n  PRIMARY KEY(id),\n  KEY (customer_name)\n);\n单独建单值索引：\nCREATE INDEX idx_customer_name ON customer(customer_name); \n删除索引：\nDROP INDEX idx_customer_name  on customer;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("h4",{attrs:{id:"唯一索引"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#唯一索引"}},[s._v("#")]),s._v(" 唯一索引")]),s._v(" "),e("p",[s._v("索引列的值必须唯一，但允许有空值")]),s._v(" "),e("p",[s._v("语法：")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("随表一起建索引：\nCREATE TABLE customer (\n  id INT(10) UNSIGNED  AUTO_INCREMENT ,\n  customer_no VARCHAR(200),\n  customer_name VARCHAR(200),\n  PRIMARY KEY(id),\n  KEY (customer_name),\n  UNIQUE (customer_no)\n);\n单独建唯一索引：\nCREATE UNIQUE INDEX idx_customer_no ON customer(customer_no); \n删除索引：\nDROP INDEX idx_customer_no on customer ;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("h4",{attrs:{id:"主键索引"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#主键索引"}},[s._v("#")]),s._v(" 主键索引")]),s._v(" "),e("p",[s._v("设定为主键后数据库会自动建立索引，innodb为聚簇索引")]),s._v(" "),e("p",[s._v("语法：")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("随表一起建索引：\nCREATE TABLE customer (\n  id INT(10) UNSIGNED  AUTO_INCREMENT ,\n  customer_no VARCHAR(200),\n  customer_name VARCHAR(200),\n  PRIMARY KEY(id) \n);\nCREATE TABLE customer2 (\n  id INT(10) UNSIGNED   ,\n  customer_no VARCHAR(200),\n  customer_name VARCHAR(200) \n);\n单独建主键索引：\nALTER TABLE customer2 add PRIMARY KEY customer2(id);  \n删除主键索引：\nALTER TABLE customer2 drop PRIMARY KEY ;  \n修改主键索引：\n必须先删除掉(drop)原索引，再新建(add)索引\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br")])]),e("h4",{attrs:{id:"复合索引"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#复合索引"}},[s._v("#")]),s._v(" 复合索引")]),s._v(" "),e("p",[s._v("即一个索引包含多个列")]),s._v(" "),e("p",[s._v("语法：")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("随表一起建索引：\nCREATE TABLE customer (\n  id INT(10) UNSIGNED  AUTO_INCREMENT ,\n  customer_no VARCHAR(200),\n  customer_name VARCHAR(200),\n  PRIMARY KEY(id),\n  KEY (customer_name),\n  UNIQUE (customer_name),\n  KEY (customer_no,customer_name)\n);\n单独建索引：\nCREATE INDEX idx_customer_no_name ON customer(customer_no,customer_name); \n删除索引：\nDROP INDEX idx_customer_no_name  on customer ;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("h3",{attrs:{id:"基本语法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#基本语法"}},[s._v("#")]),s._v(" 基本语法")]),s._v(" "),e("ol",[e("li",[s._v("创建")])]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("create [UNIQUE] index indexName on mytable(mytable.name); #这种方法创建必须指定索引名字\nalter mytable add [UNIQUE] index [indexName] (列名); #这种方法创建可以不用指定名字\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("ol",{attrs:{start:"2"}},[e("li",[s._v("删除")])]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("drop index [indexName] on mytable;\nAlter table mytable drop index index_name;\nalter table mytable drop primary key\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ol",{attrs:{start:"3"}},[e("li",[s._v("查看")])]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("show index from table_name\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ol",{attrs:{start:"4"}},[e("li",[s._v("ALTER命令")])]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ALTER TABLE tbl_name ADD PRIMARY KEY (column_list): 该语句添加一个主键，这意味着索引值必须是唯一的，且不能为NULL。\nALTER TABLE tbl_name ADD UNIQUE index_name (column_list): 这条语句创建索引的值必须是唯一的（除了NULL外，NULL可能会出现多次）。\nALTER TABLE tbl_name ADD INDEX index_name (column_list): 添加普通索引，索引值可出现多次。\nALTER TABLE tbl_name ADD FULLTEXT index_name (column_list):该语句指定了索引为 FULLTEXT ，用于全文索引。了解\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[e("strong",[s._v("注意点：")])]),s._v(" "),e("ol",[e("li",[s._v("唯一索引：通常针对手机号、用户名(非真实姓名)、身份证号、员工编号等字段创建")]),s._v(" "),e("li",[s._v("主键索引：建表时，表主键指定后、主键索引自动创建")]),s._v(" "),e("li",[s._v("一个表一旦建立主键之后后期几乎不会改动，如果要删除一个表的主键，必须保证该主键不能是自增的主键，否则删除不了。")])]),s._v(" "),e("h3",{attrs:{id:"索引创建的情况分析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#索引创建的情况分析"}},[s._v("#")]),s._v(" 索引创建的情况分析")]),s._v(" "),e("p",[e("strong",[s._v("需要创建索引的情况：")])]),s._v(" "),e("ol",[e("li",[s._v("主键自动建立唯一索引")]),s._v(" "),e("li",[s._v("频繁作为查询条件的字段应该创建索引(where后面的字段)")]),s._v(" "),e("li",[s._v("与其他表有关联的字段，外键关系建立索引")]),s._v(" "),e("li",[s._v("单键/组合索引的选择问题(在高并发下倾向创建组合索引)")]),s._v(" "),e("li",[s._v("查询中排序的字段，排序字段通过索引去访问将大大提高排序速度")]),s._v(" "),e("li",[s._v("查询中统计或者分组字段")])]),s._v(" "),e("p",[e("strong",[s._v("不需要创建索引的情况：")])]),s._v(" "),e("ol",[e("li",[s._v("表记录太少(300万数据时MySQL性能开始下降，这时就可以开始优化了)")]),s._v(" "),e("li",[s._v("经常增删改的表(提高查询的速度，同时会降低更新表的速度，因为要同时保存索引文件)")]),s._v(" "),e("li",[s._v("where条件里用不到的字段不创建索引(索引也是占空间的)")]),s._v(" "),e("li",[s._v("区分度低的字段：例如 性别")])]),s._v(" "),e("h2",{attrs:{id:"_7-索引优化分析-explain、desc"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_7-索引优化分析-explain、desc"}},[s._v("#")]),s._v(" 7.索引优化分析_explain、desc")]),s._v(" "),e("p",[s._v("官网介绍 https://dev.mysql.com/doc/refman/5.7/en/explain-output.html")]),s._v(" "),e("p",[e("strong",[s._v("作用：")])]),s._v(" "),e("ol",[e("li",[s._v("表的读取顺序")]),s._v(" "),e("li",[s._v("数据读取操作的操作类型")]),s._v(" "),e("li",[s._v("哪些索引可以使用")]),s._v(" "),e("li",[s._v("哪些索引被实际使用")]),s._v(" "),e("li",[s._v("表之间的引用")]),s._v(" "),e("li",[s._v("每张表有多少行被优化器查询")])]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("Explain + SQL语句\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("strong",[s._v("输出：")])]),s._v(" "),e("p",[e("strong",[s._v("id")]),s._v(":   \t查询的序列号，包含一组数字，表示查询中执行select子句或操作表的顺序(id相同：顺序由上至下，id不同：id越大优先级越高)\nselect_type：查询的类型，主要是用于区别普通查询、联合查询、子查询等的复杂查询\ntable\t       ：显示这一行的数据是关于哪张表的\npartitions   :匹配的分区,一般不用,直接忽略\n"),e("strong",[s._v("type")]),s._v(":  联接类型\npossible_keys:可能用到的索引\n"),e("strong",[s._v("key")]),s._v(" :   实际选择的索引\n"),e("strong",[s._v("key_len")]),s._v(":  所选键的长度,值越大越好 index(name,rank,age)\nref:        显示索引的哪一列被使用了\n"),e("strong",[s._v("rows")]),s._v(":    估计要检查的行[估算值],越小越好。\nfiltered\t     按表条件过滤的行百分比[不重要]\n"),e("strong",[s._v("Extra")]),s._v(":   附加信息,尤其要注意出现using filesort的情况,要尽量避免")]),s._v(" "),e("h2",{attrs:{id:"_8-explain重要字段解释"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_8-explain重要字段解释"}},[s._v("#")]),s._v(" 8.explain重要字段解释")]),s._v(" "),e("h3",{attrs:{id:"id"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#id"}},[s._v("#")]),s._v(" "),e("strong",[s._v("id")]),s._v(":")]),s._v(" "),e("p",[s._v("id相同：顺序由上至下，id不同：id越大优先级越高")]),s._v(" "),e("h3",{attrs:{id:"type值"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#type值"}},[s._v("#")]),s._v(" type值：")]),s._v(" "),e("p",[s._v("system > const > eq_ref > ref > range > index > all")]),s._v(" "),e("h3",{attrs:{id:"key-len-越大越好"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#key-len-越大越好"}},[s._v("#")]),s._v(" "),e("strong",[s._v("key_len:")]),s._v("  越大越好")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("explain 表名;\ndesc 表名;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("​      索引列允许为null:                +1\n​      索引列动态类型(varchar、text):   +2")]),s._v(" "),e("p",[s._v("​      tinyint:                         1\nsmallint:                       2\nmediumint:                 3\nint:                                4\nlong/float/double:     8")]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[s._v("字符串类型的key_len值(varchar,char)： latin1: 1  gbk:2 utf8:3 utf84: 4\n")])])]),e("h3",{attrs:{id:"extra列"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#extra列"}},[s._v("#")]),s._v(" Extra列：")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("using index:          \t使用到了覆盖索引\nusing index condition:  使用到了索引下推(Index condition pushdown:简称ICP)\n\nusing filesort:     排序字段没有用到索引,使用了文件外排序：需要优化\n\t\t\t\t\t如果出现了where 过滤和order by排序的话，要为where后边的条件和order by建立组合索引。\n                    存在索引失效的情况：\n                       1.没有使用过滤条件\n                       2.过滤条件是limit过滤也有可能失效\n                       3.尽量使用where过滤，不会失效\n                       \nusing temporary:    分组字段没有用到索引\n\t\t\t\t\t分组必排序：如果出现了where过滤和order by排序的话，要为where后边的条件和group by建立组合索引。\n\t\t\t\t\t\t\t  group by和order by的唯一区别：group by没有过滤条件，也可以用上索引。\nusing join buffer:    \t连表字段没有用到索引\nusing where:          \t使用了where 进行过滤，有的时候不可避免。\nimpossible where:     \tSQL语句有问题\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("h3",{attrs:{id:"rows-越小越好"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rows-越小越好"}},[s._v("#")]),s._v(" rows：越小越好")]),s._v(" "),e("p",[s._v("rows列显示MySQL认为它执行查询时必须检查的行数。值越小越好,速度越快,注意这是个预估值，因为这是用explain关键字模拟执行的，不是真实执行的。")]),s._v(" "),e("p",[s._v("谁先执行谁就是驱动表，建议使用小表作为驱动表，因为驱动表避免不了全表扫描。")]),s._v(" "),e("blockquote",[e("p",[s._v("有索引的时候，数据库也不一定会走索引。数据库的优化器会根据具体情况，选择执行效率高的SQL执行路径执行。\n也即走了索引不一定比不走索引的SQL快。")])]),s._v(" "),e("h2",{attrs:{id:"_9-查询优化-准备"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_9-查询优化-准备"}},[s._v("#")]),s._v(" 9.查询优化_准备")]),s._v(" "),e("h3",{attrs:{id:"连表概念"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#连表概念"}},[s._v("#")]),s._v(" 连表概念")]),s._v(" "),e("ol",[e("li",[s._v("横向连接")])]),s._v(" "),e("p",[s._v("形式1：")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("select * from 表1 \nleft|right|inner|full join 表2 \non 连接条件\nwhere 过滤条件\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("形式2：（笛卡尔积，5.7以后底层优化，where转化为inner join）")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("select *\nfrom 表1,表2\nwhere 表1.列=表2.列\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ol",{attrs:{start:"2"}},[e("li",[s._v("纵向连接")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("select 列1,列2\nfrom 表1\nunion all | union\nselect 列1,列2\nfrom 表2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"表数据准备"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#表数据准备"}},[s._v("#")]),s._v(" 表数据准备")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("CREATE TABLE `dept` (\n\t `id` INT(11) NOT NULL AUTO_INCREMENT,\n\t `deptName` VARCHAR(30) DEFAULT NULL,\n\t `address` VARCHAR(40) DEFAULT NULL,\n\t `ceo` INT NULL ,\n\t PRIMARY KEY (`id`)\n\t) ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;\n\nCREATE TABLE `emp` (\n\t `id` INT(11) NOT NULL AUTO_INCREMENT,\n\t `empno` INT NOT NULL ,\n\t `name` VARCHAR(20) DEFAULT NULL,\n\t `age` INT(3) DEFAULT NULL,\n\t `deptId` INT(11) DEFAULT NULL,\n\t PRIMARY KEY (`id`)\n\t #CONSTRAINT `fk_dept_id` FOREIGN KEY (`deptId`) REFERENCES `t_dept` (`id`)\n\t) ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("h3",{attrs:{id:"函数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#函数"}},[s._v("#")]),s._v(" 函数")]),s._v(" "),e("blockquote",[e("p",[s._v("存储过程：")]),s._v(" "),e("ol",[e("li",[s._v("存储过程声明")]),s._v(" "),e("li",[s._v("存储过程调用")])]),s._v(" "),e("p",[s._v("函数：")]),s._v(" "),e("ol",[e("li",[s._v("函数声明")]),s._v(" "),e("li",[s._v("函数调用")])])]),s._v(" "),e("h4",{attrs:{id:"开启函数设置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#开启函数设置"}},[s._v("#")]),s._v(" 开启函数设置")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("show variables like 'log_bin_trust_function_creators';\nset global log_bin_trust_function_creators=1;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("配置文件的[mysqld] 加上log_bin_trust_function_creators=1")]),s._v(" "),e("h4",{attrs:{id:"随机字符串函数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#随机字符串函数"}},[s._v("#")]),s._v(" 随机字符串函数")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("DELIMITER $$  #将停止字符设置为$$，防止粘贴在linux时遇到;直接停止执行了\nCREATE FUNCTION rand_string(n INT) RETURNS VARCHAR(255)\nBEGIN    \nDECLARE chars_str VARCHAR(100) DEFAULT 'abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ';\nDECLARE return_str VARCHAR(255) DEFAULT '';\nDECLARE i INT DEFAULT 0;\nWHILE i < n DO  \nSET return_str =CONCAT(return_str,SUBSTRING(chars_str,FLOOR(1+RAND()*52),1));  \nSET i = i + 1;\nEND WHILE;\nRETURN return_str;\nEND $$\nDELIMITER ;  #将停止字符串改回来 \n#假如要删除\ndrop function rand_string;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("h4",{attrs:{id:"随机部门编号"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#随机部门编号"}},[s._v("#")]),s._v(" 随机部门编号")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("#用于随机产生多少到多少的编号\nDELIMITER $$\nCREATE FUNCTION  rand_num (from_num INT ,to_num INT) RETURNS INT(11)\nBEGIN   \nDECLARE i INT DEFAULT 0;  \nSET i = FLOOR(from_num +RAND()*(to_num - from_num+1))   ;\nRETURN i;  \nEND$$ \nDELIMITER ;\n#假如要删除\ndrop function rand_num;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("h4",{attrs:{id:"emp表中插入数据的存储过程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#emp表中插入数据的存储过程"}},[s._v("#")]),s._v(" emp表中插入数据的存储过程")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("DELIMITER $$\nCREATE PROCEDURE  insert_emp(  START INT ,  max_num INT )\nBEGIN  \nDECLARE i INT DEFAULT 0;   \n SET autocommit = 0;    #设置手动提交事务\n REPEAT  #循环\n SET i = i + 1;  #赋值\n INSERT INTO emp (empno, NAME ,age ,deptid ) VALUES ((START+i),rand_string(6),rand_num(30,50),rand_num(1,10000));  \n UNTIL i = max_num  \n END REPEAT;  \n COMMIT;  #提交事务\nEND$$\nDELIMITER ;\n#删除\ndrop PROCEDURE insert_emp;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("h4",{attrs:{id:"dept表插入数据的存储过程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#dept表插入数据的存储过程"}},[s._v("#")]),s._v(" dept表插入数据的存储过程")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("DELIMITER $$\nCREATE PROCEDURE `insert_dept`(  max_num INT )\nBEGIN  \nDECLARE i INT DEFAULT 0;   \n SET autocommit = 0;    \n REPEAT  \n SET i = i + 1;  \n INSERT INTO dept ( deptname,address,ceo ) VALUES (rand_string(8),rand_string(10),rand_num(1,500000));  \n UNTIL i = max_num  \n END REPEAT;  \n COMMIT; \nEND$$\nDELIMITER ;\n#删除\ndrop PROCEDURE insert_dept;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("h4",{attrs:{id:"存储过程调用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#存储过程调用"}},[s._v("#")]),s._v(" 存储过程调用")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("#执行\nCALL insert_dept(100000);\n#执行存储过程，往emp表添加50万条数据\nCALL insert_emp(100000,500000); \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h4",{attrs:{id:"批量删除索引的存储过程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#批量删除索引的存储过程"}},[s._v("#")]),s._v(" 批量删除索引的存储过程")]),s._v(" "),e("h5",{attrs:{id:"_1-找到一个表的所有索引"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-找到一个表的所有索引"}},[s._v("#")]),s._v(" 1.找到一个表的所有索引")]),s._v(" "),e("blockquote",[e("p",[s._v("系统表information_schema.statistics中")]),s._v(" "),e("p",[s._v("table_schema:数据库名")]),s._v(" "),e("p",[s._v("table_name:表名")]),s._v(" "),e("p",[s._v("seq_in_index=1:组合索引去重")])]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("select index_name from information_schema.statistics where table_schema='mytbl' and table_name='t_emp' and index_name!='primary' and seq_in_index=1;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h5",{attrs:{id:"_2-取出表的所有索引"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-取出表的所有索引"}},[s._v("#")]),s._v(" 2.取出表的所有索引")]),s._v(" "),e("blockquote",[e("p",[s._v("使用 CURSOR 游标")])]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("cursor 游标名 for select index_name from information_schema.statistics where table_schema='mytbl' and table_name='t_emp' and index_name!='primary' and seq_in_index=1\nopen 游标名\nFETCH 游标名 INTO 变量;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h5",{attrs:{id:"_3-把字符串类型的索引名称转为sql语句"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-把字符串类型的索引名称转为sql语句"}},[s._v("#")]),s._v(" 3.把字符串类型的索引名称转为SQL语句")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("PREPARE alter table t_emp drop index '变量'  #预编译语句\nexecute sql语句;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h5",{attrs:{id:"_4-创建过程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-创建过程"}},[s._v("#")]),s._v(" 4.创建过程")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("DELIMITER $$\nCREATE  PROCEDURE `proc_drop_index`(dbname VARCHAR(200),tablename VARCHAR(200))\nBEGIN\n\tDECLARE done INT DEFAULT 0;\n\tDECLARE ct INT DEFAULT 0;\n\tDECLARE _index VARCHAR(200) DEFAULT '';\n\tDECLARE _cur CURSOR FOR SELECT index_name FROM information_schema.STATISTICS WHERE table_schema=dbname AND table_name=tablename AND seq_in_index=1 AND index_name <>'PRIMARY'  ;\n#每个游标必须使用不同的declare continue handler for not found set done=1来控制游标的结束\n\tDECLARE CONTINUE HANDLER FOR NOT FOUND set done=2 ;      \n#若没有数据返回,程序继续,并将变量done设为2\n\tOPEN _cur;\n\tFETCH _cur INTO _index;\n\tWHILE  _index<>'' DO \n\t\t\tSET @str = CONCAT(\"drop index \" , _index , \" on \" , tablename ); \n\t\t\tPREPARE sql_str FROM @str ;\n\t\t\tEXECUTE  sql_str;\n\t\t\tDEALLOCATE PREPARE sql_str;\n\t\t\tSET _index=''; \n\t\t\tFETCH _cur INTO _index; \n\tEND WHILE;\nCLOSE _cur;\nEND$$\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br")])]),e("h5",{attrs:{id:"_5-调用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-调用"}},[s._v("#")]),s._v(" 5.调用")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('CALL proc_drop_index("mytbl","emp");\nCALL proc_drop_index("mytbl","dept");\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h2",{attrs:{id:"_10-查询优化-单表"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_10-查询优化-单表"}},[s._v("#")]),s._v(" 10.查询优化_单表")]),s._v(" "),e("h3",{attrs:{id:"索引失效情况"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#索引失效情况"}},[s._v("#")]),s._v(" 索引失效情况")]),s._v(" "),e("h4",{attrs:{id:"_1-全值匹配"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-全值匹配"}},[s._v("#")]),s._v(" 1.全值匹配")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("EXPLAIN SELECT SQL_NO_CACHE * FROM emp WHERE age=30 and deptid=4 AND name = 'abcd';\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("创建索引")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("CREATE INDEX idx_age_deptid_name ON emp(age,deptid,NAME);\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h4",{attrs:{id:"_2-最佳左前缀法则"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-最佳左前缀法则"}},[s._v("#")]),s._v(" 2.最佳左前缀法则")]),s._v(" "),e("blockquote",[e("p",[s._v("写SQL的时候要遵循最佳左前缀原则")])]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("idx_age_deptid_name索引只对以下情况有效\nwhere age=? and deptId=? and name=?\nwhere age=? and deptId=?\nwhere age=?\n对以下无效\nwhere deptId=? and name=?(因为第一个位置无法确定)\nwhere age=? and name=?(中间断开也不行)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h4",{attrs:{id:"_3-计算、函数导致索引失效"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-计算、函数导致索引失效"}},[s._v("#")]),s._v(" 3.计算、函数导致索引失效")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("CREATE INDEX idx_name ON emp(NAME);\n\nEXPLAIN SELECT SQL_NO_CACHE * FROM emp WHERE emp.name LIKE 'abc%';\nEXPLAIN SELECT SQL_NO_CACHE * FROM emp WHERE LEFT(emp.name,3) = 'abc';\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("第一种查询索引生效、第二种查询索引失效")]),s._v(" "),e("h4",{attrs:{id:"_4-范围条件右边的列索引失效"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-范围条件右边的列索引失效"}},[s._v("#")]),s._v(" 4.范围条件右边的列索引失效")]),s._v(" "),e("blockquote",[e("p",[s._v("所以遇到范围查询，尽量将范围查询放在最后边，然后针对这几个字段建立组合索引。")])]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("EXPLAIN SELECT  SQL_NO_CACHE * FROM emp WHERE emp.age=30 AND emp.deptId>20 AND emp.name = 'abc' ;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("虽然显示使用了索引，但是key_len的值明显少了很多，并且查询的列rows也增多了。")]),s._v(" "),e("p",[s._v("应该建立：")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("create index idx_age_name_deptid on emp(age,name,deptid);\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("然后将范围查询条件放最后：")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("EXPLAIN SELECT  SQL_NO_CACHE * FROM emp WHERE emp.age=30 AND emp.name = 'abc'AND  emp.deptId>20 ;\n# 对比强制使用idx_age_deptId_name，有明显的优化效果\nEXPLAIN SELECT  SQL_NO_CACHE * FROM emp force index(idx_age_deptId_name) WHERE emp.age=30 AND emp.name = 'abc'AND  emp.deptId>20 ;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h4",{attrs:{id:"_5-或者-索引失效"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-或者-索引失效"}},[s._v("#")]),s._v(" 5.!=或者<>索引失效")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("CREATE INDEX idx_name ON emp(NAME);\n\nEXPLAIN SELECT SQL_NO_CACHE * FROM emp WHERE emp.name != 'abc';\nEXPLAIN SELECT SQL_NO_CACHE * FROM emp WHERE emp.name <>  'abc';\n\nEXPLAIN SELECT SQL_NO_CACHE * FROM emp WHERE emp.name = 'abc'; # 使用 = 不会失效\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h4",{attrs:{id:"_6-is-not-null无法使用索引-is-null可以"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-is-not-null无法使用索引-is-null可以"}},[s._v("#")]),s._v(" 6.is not null无法使用索引，is null可以")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("CREATE INDEX idx_age ON emp(age);\nEXPLAIN SELECT SQL_NO_CACHE * FROM emp WHERE age IS NULL;  \nEXPLAIN SELECT SQL_NO_CACHE * FROM emp WHERE age IS NOT NULL;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h4",{attrs:{id:"_7-like以通配符-开头索引失效"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_7-like以通配符-开头索引失效"}},[s._v("#")]),s._v(" 7.like以通配符%开头索引失效")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("EXPLAIN SELECT SQL_NO_CACHE * FROM emp WHERE name LIKE 'ab%'; \nEXPLAIN SELECT SQL_NO_CACHE * FROM emp WHERE name LIKE '%ab%';\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h4",{attrs:{id:"_8-类型转换导致索引失效"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_8-类型转换导致索引失效"}},[s._v("#")]),s._v(" 8.类型转换导致索引失效")]),s._v(" "),e("blockquote",[e("p",[s._v("设计实体类属性时，一定要与数据库字段类型相对应，否则会出现类型转换的情况")])]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("EXPLAIN SELECT SQL_NO_CACHE * FROM emp WHERE name=123;  # 失效\nEXPLAIN SELECT SQL_NO_CACHE * FROM emp WHERE name='123'; \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"单表优化建议"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#单表优化建议"}},[s._v("#")]),s._v(" 单表优化建议")]),s._v(" "),e("ol",[e("li",[e("p",[s._v("对于单键索引，尽量选择过滤性更好的索引（例如：手机号，邮件，身份证，用户名）")])]),s._v(" "),e("li",[e("p",[s._v("选择组合索引的时候，过滤性最好的字段在索引字段顺序位置越靠前越好。")])]),s._v(" "),e("li",[e("p",[s._v("组合索引遇到范围查询时，尽量把这个字段放在索引次序的最后面")])]),s._v(" "),e("li",[e("p",[s._v("选择组合索引的时候，尽量包含where中更多字段的索引。(where deptId>20；索引：idx_age_name_deptId)")])]),s._v(" "),e("li",[e("p",[s._v("尽量避免索引失效的情况")])])]),s._v(" "),e("h2",{attrs:{id:"_11-查询优化-连表"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_11-查询优化-连表"}},[s._v("#")]),s._v(" 11.查询优化_连表")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th"),s._v(" "),e("th",[s._v("驱动表")]),s._v(" "),e("th",[s._v("被驱动表")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("left join")]),s._v(" "),e("td",[s._v("左表")]),s._v(" "),e("td",[s._v("右表")])]),s._v(" "),e("tr",[e("td",[s._v("right join")]),s._v(" "),e("td",[s._v("右表")]),s._v(" "),e("td",[s._v("左表")])])])]),s._v(" "),e("h3",{attrs:{id:"建议"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#建议"}},[s._v("#")]),s._v(" 建议")]),s._v(" "),e("ol",[e("li",[s._v("针对左外、右外连接，保证被驱动表的关联字段被索引。")]),s._v(" "),e("li",[s._v("选择小表作为驱动表，大表作为被驱动表（但是具体哪个表作为驱动表还是需要根据实际业务决定）")]),s._v(" "),e("li",[s._v("inner join时，mysql自动选择一个表【小表或连表字段没有索引的】作为驱动表（不一定）。")]),s._v(" "),e("li",[s._v("straight_join 可以优化inner join,强制使用一张表【straight_join前边的表】作为驱动表")])]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("create index idx_deptid on emp(deptId);\n\nexplain SELECT * from dept STRAIGHT_JOIN emp on emp.deptId = dept.id\nexplain SELECT * from dept INNER JOIN emp on emp.deptId = dept.id\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("ol",{attrs:{start:"5"}},[e("li",[s._v("互联网公司，不建议连表，用空间换时间（当A表需要使用B表的字段时，直接在A表中添加这些字段，这样就可以直接单表查询）")]),s._v(" "),e("li",[s._v("能够直接使用多表联查就不要用子查询。")])]),s._v(" "),e("h2",{attrs:{id:"_12-查询优化-子查询"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_12-查询优化-子查询"}},[s._v("#")]),s._v(" 12.查询优化_子查询")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("先创建一个索引\nCREATE INDEX idx_ceo ON t_dept (ceo);\n①不推荐\nExplain SELECT * FROM t_emp a WHERE a.id NOT IN \n(SELECT b.ceo FROM t_dept b WHERE b.ceo IS NOT NULL);\n②推荐\nExplain SELECT a.* FROM t_emp a \nLEFT JOIN t_dept b\nON a.id = b.ceo \nWHERE b.id IS NULL;\n结论：\nNOT IN --\x3eLEFT JOIN xxx ON xx WHERE xx IS NULL\n尽量不要使用not in  或者 not exists\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("h3",{attrs:{id:"建议-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#建议-2"}},[s._v("#")]),s._v(" 建议")]),s._v(" "),e("p",[s._v("遇到子查询就转为连表查询")]),s._v(" "),e("h2",{attrs:{id:"_13-查询优化-排序、分组优化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_13-查询优化-排序、分组优化"}},[s._v("#")]),s._v(" 13.查询优化_排序、分组优化")]),s._v(" "),e("h3",{attrs:{id:"排序情况"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#排序情况"}},[s._v("#")]),s._v(" 排序情况")]),s._v(" "),e("h4",{attrs:{id:"_1-无过滤-不索引"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-无过滤-不索引"}},[s._v("#")]),s._v(" 1.无过滤，不索引")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("#创建索引\ncreate index idx_deptid on emp(deptid);\nEXPLAIN SELECT SQL_NO_CACHE * FROM emp ORDER BY deptid; \n#增加limit过滤条件，使用上索引了。\nEXPLAIN SELECT SQL_NO_CACHE * FROM emp ORDER BY deptid LIMIT 10; \n#limit过滤索引失效\nEXPLAIN SELECT SQL_NO_CACHE * FROM emp ORDER BY deptid LIMIT 100000,10; \n#可以使用where先进行过滤\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h4",{attrs:{id:"_2-顺序错-必排序-using-filesort"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-顺序错-必排序-using-filesort"}},[s._v("#")]),s._v(" 2.顺序错，必排序(using filesort)")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("CREATE INDEX idx_age_deptid_name ON emp (age,deptid,NAME);\nEXPLAIN SELECT * FROM emp WHERE age=45 ORDER BY deptid;\nEXPLAIN SELECT * FROM emp WHERE age=45 ORDER BY deptid,NAME;\n\nEXPLAIN SELECT * FROM emp WHERE age=45 ORDER BY NAME,deptid; #顺序不对(Using filesort)\nEXPLAIN SELECT * FROM emp WHERE deptid=45 ORDER BY age; #顺序不对(Using filesort)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h4",{attrs:{id:"_3-方向反-必排序-using-filesort"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-方向反-必排序-using-filesort"}},[s._v("#")]),s._v(" 3.方向反，必排序(using filesort)")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("EXPLAIN SELECT * FROM emp WHERE age=45 ORDER BY deptid DESC, NAME DESC ;\nEXPLAIN SELECT * FROM emp WHERE age=45 ORDER BY deptid ASC, NAME DESC ; #升序和降序相反(using filesort)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"索引的选择"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#索引的选择"}},[s._v("#")]),s._v(" 索引的选择")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("EXPLAIN SELECT SQL_NO_CACHE * FROM emp WHERE age =30 AND empno <101000 ORDER BY NAME ;\n#创建索引\nCREATE INDEX idx_age_empno_name ON emp (age,empno,NAME);\n#由于empno<101000 导致 name索引失效 (using filesort)\n#创建能去掉using filesort的索引\n#先删除前面的索引\nCREATE INDEX idx_age_name ON emp(age,NAME);\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[e("strong",[s._v("创建idx_age_name确实把using filesort去掉了，但是我们idx_age_empno_name索引优化的效率更高")])]),s._v(" "),e("p",[s._v("原因：")]),s._v(" "),e("ul",[e("li",[s._v("where条件的过滤性 ,where条件如果过滤性好，就算出现using filesort也没关系。")]),s._v(" "),e("li",[s._v("where条件如果过滤性不好，要给where条件和order by后边的字段建立组合索引")])]),s._v(" "),e("h3",{attrs:{id:"双路排序和单路排序"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#双路排序和单路排序"}},[s._v("#")]),s._v(" 双路排序和单路排序")]),s._v(" "),e("h4",{attrs:{id:"双路排序-慢"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#双路排序-慢"}},[s._v("#")]),s._v(" 双路排序(慢)")]),s._v(" "),e("blockquote",[e("p",[s._v("先把索引列从磁盘加载到内存中排序，然后再把非索引列从磁盘加载到内存中进行排序，需要两次扫盘。")]),s._v(" "),e("p",[s._v("两次磁盘读取，占用内存空间少")])]),s._v(" "),e("h4",{attrs:{id:"单路排序-快"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#单路排序-快"}},[s._v("#")]),s._v(" 单路排序(快)")]),s._v(" "),e("blockquote",[e("p",[s._v("一次把所有的列(索引列、非索引列)从磁盘加载到内存中排序，只需要一次扫盘。")]),s._v(" "),e("p",[s._v("一次磁盘读取，占用内存空间多")])]),s._v(" "),e("h4",{attrs:{id:"单路排序的问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#单路排序的问题"}},[s._v("#")]),s._v(" 单路排序的问题")]),s._v(" "),e("ul",[e("li",[s._v("单次读取数据超出sort_buffer的容量，导致每次只能去sort_buffer容量大小的数据，进行排序（创建tmp文件，多路合并），排完再取sort_buffer容量大小，再排.....从而多次I/O操作")]),s._v(" "),e("li",[s._v("单路本意是减少I/O操作，现在反而导致了大量的I/O操作，得不偿失")])]),s._v(" "),e("h4",{attrs:{id:"优化策略"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#优化策略"}},[s._v("#")]),s._v(" 优化策略")]),s._v(" "),e("ul",[e("li",[s._v("增大sort_buffer_size参数的设置（1m-8m）")]),s._v(" "),e("li",[s._v("增大max_length_for_sort_data参数的设置（1k-8k）")]),s._v(" "),e("li",[s._v("减少select后面的查询的字段。禁止使用select *")])]),s._v(" "),e("h3",{attrs:{id:"group-by优化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#group-by优化"}},[s._v("#")]),s._v(" GROUP BY优化")]),s._v(" "),e("ul",[e("li",[s._v("group by 没有过滤条件，也可以用上索引。Order By 必须有过滤条件才能使用索引")]),s._v(" "),e("li",[s._v("group by 先排序再分组，遵照最佳左前缀法则")]),s._v(" "),e("li",[s._v("当无法使用索引列，增大max_length_for_sort_data和sort_buffer_size参数的设置")])]),s._v(" "),e("blockquote",[e("p",[s._v("1.limit分页优化，尽量也是结合where条件\n2.优化器执行的不一定是最好的，实际开发中，试一试,explain 、show profiles！")])]),s._v(" "),e("h2",{attrs:{id:"_14-覆盖索引优化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_14-覆盖索引优化"}},[s._v("#")]),s._v(" 14.覆盖索引优化")]),s._v(" "),e("blockquote",[e("p",[s._v("select 到 from 之间查询的列使用了索引！覆盖索引不用回表查询，通常出现于innodb引擎")])]),s._v(" "),e("p",[s._v("回表查询：先定位主键值，再定位行数据，性能较低。")]),s._v(" "),e("p",[s._v("覆盖索引：只需要在一颗索引树上就能获取SQL所需的所有列数据")]),s._v(" "),e("p",[s._v("将被查询的字段，建立到联合索引里去就能实现覆盖索引")]),s._v(" "),e("blockquote",[e("p",[s._v("select count(*) from user;默认使用了索引覆盖。"),e("strong",[s._v("作用等同于")]),s._v(":explain select count(id) from user; //id列是有主键索引的。")])]),s._v(" "),e("h2",{attrs:{id:"_15-查询截取分析-慢查询日志"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_15-查询截取分析-慢查询日志"}},[s._v("#")]),s._v(" 15.查询截取分析_慢查询日志")]),s._v(" "),e("blockquote",[e("p",[s._v("作用：保存慢查询SQL的日志文件：慢查询日志\nmysql默认的慢SQL的时间：10s")])]),s._v(" "),e("h3",{attrs:{id:"使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[s._v("#")]),s._v(" 使用")]),s._v(" "),e("ol",[e("li",[s._v("show variables like 'slow query%';")]),s._v(" "),e("li",[s._v("开启慢查询日志功能:slow query_log = 1")]),s._v(" "),e("li",[s._v("多长时间的SQL算慢SQL？show global variables like 'long_query_time';(默认10s)")]),s._v(" "),e("li",[s._v("配置文件中修改参数")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/my.cnf \n "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("slow_query_log")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("slow_query_log_file")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql/localhost-slow.log\n "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("long_query_time")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("log_output")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("FILE\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("ol",{attrs:{start:"5"}},[e("li",[s._v("查看慢查询日志中的SQL：show global status like '%Slow_queries';")]),s._v(" "),e("li",[s._v("针对慢查询日志文件中的SQL，如果有多个的情况，还可以使用mysqldumpslow分析工具对慢日志进行分析")])]),s._v(" "),e("h2",{attrs:{id:"_16-视图"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_16-视图"}},[s._v("#")]),s._v(" 16.视图")]),s._v(" "),e("p",[s._v("概念：视图是建立表的基础之上的一张伪表，是底层表的映射")]),s._v(" "),e("p",[s._v("作用：1.保存表的隐私数据，2.封装复杂的业务逻辑[统计分析]")]),s._v(" "),e("p",[s._v("具体操作：")]),s._v(" "),e("ol",[e("li",[s._v("视图的创建：\ncreate or replace view 视图名 as select 查询语句(表)")]),s._v(" "),e("li",[s._v("视图的增删改操作和表的是一模一样。\ninsert into 视图名 values()\nupdate 视图名 set 字段名 where 条件\ndelete from 视图名 where 条件")])]),s._v(" "),e("h2",{attrs:{id:"_17-主从复制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_17-主从复制"}},[s._v("#")]),s._v(" 17.主从复制")]),s._v(" "),e("h3",{attrs:{id:"相关概念"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#相关概念"}},[s._v("#")]),s._v(" 相关概念")]),s._v(" "),e("p",[s._v("bin log：二进制日志，记录的是对当前节点的增删改的语句")]),s._v(" "),e("p",[s._v("relay log：中继日志，在主从复制的从节点使用，记录的是从主节点复制过来的SQL")]),s._v(" "),e("p",[s._v("redo log：当mysql服务区出现问题的时候，恢复mysql服务器中的数据使用的。")]),s._v(" "),e("p",[s._v("undo log：事务回滚使用的")]),s._v(" "),e("h4",{attrs:{id:"mysql的主从复制和redis的主从复制的区别"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mysql的主从复制和redis的主从复制的区别"}},[s._v("#")]),s._v(" mysql的主从复制和redis的主从复制的区别")]),s._v(" "),e("ol",[e("li",[s._v("mysql主从复制慢一些")]),s._v(" "),e("li",[s._v("mysql的复制是增量复制，是从成为从节点之后的位置开始复制")])]),s._v(" "),e("h3",{attrs:{id:"复制的基本原理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#复制的基本原理"}},[s._v("#")]),s._v(" 复制的基本原理")]),s._v(" "),e("blockquote",[e("p",[s._v("slave会从master读取binlog来进行数据同步")])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/2021/11/23/6b3b3589edf4b.png",alt:"1637669283730.png"}})]),s._v(" "),e("p",[s._v("MySQL复制三步骤:")]),s._v(" "),e("p",[s._v("1 master将写操作记录到"),e("strong",[s._v("二进制日志（binary log）")]),s._v("。这些记录过程叫做二进制日志事件，binary log events；")]),s._v(" "),e("p",[s._v("2 slave将master的binary log events拷贝到它的"),e("strong",[s._v("中继日志（relay log）")]),s._v("；")]),s._v(" "),e("p",[s._v("从服务器I/O线程将主服务器的二进制日志读取过来记录到从服务器本地文件，然后SQL线程会读取relay-log日志的内容并应用到从服务器，从而使从服务器和主服务器的数据保持一致！")]),s._v(" "),e("p",[s._v("3 slave重做中继日志中的事件，将改变应用到自己的数据库中。 MySQL复制是"),e("strong",[s._v("异步的且串行化的，而且重启后从接入点开始复制。")])]),s._v(" "),e("h3",{attrs:{id:"复制的基本原则"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#复制的基本原则"}},[s._v("#")]),s._v(" 复制的基本原则")]),s._v(" "),e("ul",[e("li",[s._v("每个slave只有一个master")]),s._v(" "),e("li",[s._v("每个slave只能有一个唯一的服务器ID")]),s._v(" "),e("li",[s._v("每个master可以有多个slave")])]),s._v(" "),e("h2",{attrs:{id:"主从复制搭建"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#主从复制搭建"}},[s._v("#")]),s._v(" 主从复制搭建")]),s._v(" "),e("blockquote",[e("p",[s._v("vim /var/lib/mysql/auto.cnf 下更改uuid(uuid不能重复，建议修改一个数字)，重启服务")])]),s._v(" "),e("h3",{attrs:{id:"主机配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#主机配置"}},[s._v("#")]),s._v(" 主机配置")]),s._v(" "),e("p",[s._v("my.cnf")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("server-id=1\nlog-bin=mysql-bin\nbinlog-ignore-db=mysql\nbinlog-ignore-db=infomation_schema\nbinlog-do-db=mytestdb\nbinlog_format=STATEMENT\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h3",{attrs:{id:"创建账户并授权"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建账户并授权"}},[s._v("#")]),s._v(" 创建账户并授权")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("CREATE USER 'username'@'%' IDENTIFIED BY '123456';\nGRANT REPLICATION SLAVE ON *.* TO 'slave'@'%' IDENTIFIED BY '123456';\nflush privileges;\nshow master status;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h3",{attrs:{id:"从机配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#从机配置"}},[s._v("#")]),s._v(" 从机配置")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("server-id=2\nrelay-log=mysql-relay\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"从机指定主机"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#从机指定主机"}},[s._v("#")]),s._v(" 从机指定主机")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("CHANGE MASTER TO MASTER_HOST='192.168.136.10',\nMASTER_USER='slave',MASTER_PASSWORD='123456',\nMASTER_LOG_FILE='mysql-bin.000001',MASTER_LOG_POS=590; \nstart slave;  开始主从复制\nshow slave status;查看从机状态\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h2",{attrs:{id:"if和case-when"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#if和case-when"}},[s._v("#")]),s._v(" if和case when")]),s._v(" "),e("div",{staticClass:"language-mysql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# if\nselect a.name,\nif(b.ceo is null,'否','是')'是否为掌门'\nfrom t_emp a\nleft JOIN t_dept b on a.id = b.ceo\n#case when\nselect a.name,case when b.ceo is null then '否' else '是' end '是否为掌门'\nfrom t_emp a\nleft JOIN t_dept b on a.id = b.ceo\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("h2",{attrs:{id:"mysql-binlog"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mysql-binlog"}},[s._v("#")]),s._v(" MySQL-Binlog")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" master "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" master logs\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'binlog_format'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'log_bin'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%server_id%'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" binlog events "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql-bin.000496'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("743316937")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#398035538")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BINARY")]),s._v(" logs"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("h2",{attrs:{id:"_18-问题排查"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_18-问题排查"}},[s._v("#")]),s._v(" 18. 问题排查")]),s._v(" "),e("p",[s._v("查询是否锁表")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OPEN")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLES")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" In_user "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" e"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("查询进程")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" processlist\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("查询正在锁的事务")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" information_schema"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("innodb_locks\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("查看等待锁的事务")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" information_schema"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("innodb_lock_waits\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"_19-锁表"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_19-锁表"}},[s._v("#")]),s._v(" 19. 锁表")]),s._v(" "),e("p",[s._v("mysql 什么情况下会出现表锁定问题？")]),s._v(" "),e("p",[s._v("1）大量并发访问")]),s._v(" "),e("p",[s._v("​\t当多个用户同时访问同一张表时，可能会出现表锁定问题。这是因为MySQL默认使用行级锁定，但当需要修改表结构、插入大量数据或执行复杂查询等操作时，MySQL会自动切换为表级锁定，导致其他用户无法访问该表。")]),s._v(" "),e("p",[s._v("解决方案：优化SQL语句，尽量减少表级锁定的使用，或者采用分区表技术，将一张大表拆分成多个小表，减少并发访问冲突")]),s._v(" "),e("p",[s._v("2）长事务导致锁定")]),s._v(" "),e("p",[s._v("​\t长时间运行的事务可能会导致表锁定。当一个事务占用了表中的某些资源，其他事务无法访问该资源，从而出现表锁定问题。")]),s._v(" "),e("p",[s._v("解决方案：尽量减少事务的运行时间，及时提交或回滚事务，避免长时间运行。")]),s._v(" "),e("p",[s._v("3）索引问题")]),s._v(" "),e("p",[s._v("​\t如果表没有适当的索引或索引使用不当，也可能会导致表锁定问题。例如，在执行一些复杂查询时，MySQL可能会锁定整个表，而不是只锁定需要查询的行。")]),s._v(" "),e("p",[s._v("解决方案：为表添加适当的索引，优化SQL查询语句，减少锁定的行数。")]),s._v(" "),e("p",[s._v("4）存储引擎问题")]),s._v(" "),e("p",[s._v("MyISAM引擎只支持表锁，InnoDB存储引擎则支持行级锁定。")]),s._v(" "),e("p",[s._v("解决方案：根据业务需求选择合适的存储引擎，或者将表转换为支持行级锁定的存储引擎。")]),s._v(" "),e("p",[s._v("表锁定问题是MySQL中常见的问题，但可以通过优化SQL语句、减少事务运行时间、添加适当的索引、选择合适的存储引擎等方式来解决。对于大量并发访问的情况，可以采用分区表技术将一张大表拆分成多个小表，减少并发访问冲突。")])])}),[],!1,null,null,null);a.default=n.exports}}]);