(window.webpackJsonp=window.webpackJsonp||[]).push([[101],{622:function(a,s,t){"use strict";t.r(s);var r=t(4),p=Object(r.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h2",{attrs:{id:"_1-源码全流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-源码全流程"}},[a._v("#")]),a._v(" 1. 源码全流程")]),a._v(" "),t("h3",{attrs:{id:"_1-1-spark-提交流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-spark-提交流程"}},[a._v("#")]),a._v(" 1.1 Spark 提交流程")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/spark%2Fspark_submit.png",alt:""}})]),a._v(" "),t("h3",{attrs:{id:"_1-2-spark-通讯架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-spark-通讯架构"}},[a._v("#")]),a._v(" 1.2 Spark 通讯架构")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/spark%2Fcore%2Fspark_core_com.png",alt:""}})]),a._v(" "),t("h3",{attrs:{id:"_1-3-spark-任务划分"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-spark-任务划分"}},[a._v("#")]),a._v(" 1.3 Spark 任务划分")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/spark%2Fcore%2Fspark_core_stage.png",alt:""}})]),a._v(" "),t("h3",{attrs:{id:"_1-4-task-任务调度"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-task-任务调度"}},[a._v("#")]),a._v(" 1.4 Task 任务调度")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/spark%2Fcore%2Fspark_core_task.png",alt:""}})]),a._v(" "),t("h3",{attrs:{id:"_1-5-shuffle-原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-shuffle-原理"}},[a._v("#")]),a._v(" 1.5 Shuffle 原理")]),a._v(" "),t("p",[a._v("HashShuffle流程")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/spark%2Fcore%2Fspark_shuffle.png",alt:""}})]),a._v(" "),t("p",[a._v("优化后的HashShuffle流程")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/spark%2Fcore%2Fspark_shuffle_optm.png",alt:""}})]),a._v(" "),t("p",[a._v("SortShuffle流程")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/spark%2Fcore%2Fspark_sortShuffle.png",alt:""}})]),a._v(" "),t("p",[a._v("bypassShuffle流程")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/spark%2Fcore%2Fspark_bypassShuffle.png",alt:""}})]),a._v(" "),t("h2",{attrs:{id:"_2-环境准备及提交流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-环境准备及提交流程"}},[a._v("#")]),a._v(" 2. 环境准备及提交流程")]),a._v(" "),t("h3",{attrs:{id:"_2-1-程序起点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-程序起点"}},[a._v("#")]),a._v(" 2.1 程序起点")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("spark-3.0.0-bin-hadoop3.2\\bin\\spark-submit.cmd")]),a._v(" "),t("ul",[t("li",[a._v('cmd /V /E /C ""%~dp0spark-submit2.cmd" %*"')])])]),a._v(" "),t("li",[t("p",[a._v("spark-submit2.cmd")]),a._v(" "),t("ul",[t("li",[a._v('set CLASS=org.apache.spark.deploy.SparkSubmit\n"%~dp0spark-class2.cmd" %CLASS% %*')])])]),a._v(" "),t("li",[t("p",[a._v("spark-class2.cmd")]),a._v(" "),t("ul",[t("li",[a._v("%SPARK_CMD%")])])]),a._v(" "),t("li",[t("p",[a._v("在spark-class2.cmd文件中增加打印%SPARK_CMD%语句")]),a._v(" "),t("ul",[t("li",[a._v("echo %SPARK_CMD%\n%SPARK_CMD%")])])]),a._v(" "),t("li",[t("p",[a._v("在spark-3.0.0-bin-hadoop3.2\\bin目录上执行cmd命令")]),a._v(" "),t("ul",[t("li",[a._v("进入命令行，输入：spark-submit --class org.apache.spark.examples.SparkPi --master local[2] ../examples/jars/spark-examples_2.12-3.0.0.jar 10")]),a._v(" "),t("li",[a._v("实际执行的是："),t("strong",[a._v('"C:\\Program Files\\Java\\jdk1.8.0_111\\bin\\java" -cp')]),a._v(' "E:\\blog\\spark\\spark-3.0.0-bin-hadoop3.2\\bin..\\conf;E:\\blog\\spark\\spark-3.0.0-bin-hadoop3.2\\bin..\\jars*" -Xmx1g '),t("strong",[a._v("org.apache.spark.deploy.SparkSubmit")]),a._v(" --master local[2] --class org.apache.spark.examples.SparkPi ../examples/jars/spark-examples_2.12-3.0.0.jar 10")]),a._v(" "),t("li",[a._v("说明：java -cp和 -classpath一样，是指定类运行所依赖其他类的路径。")])])]),a._v(" "),t("li",[t("p",[a._v("执行java -cp 就会开启JVM虚拟机，在虚拟机上开启SparkSubmit进程，然后开始执行main方法")]),a._v(" "),t("ul",[t("li",[a._v("java -cp =》开启JVM虚拟机 =》开启Process（SparkSubmit）=》程序入口SparkSubmit.main")])])]),a._v(" "),t("li",[t("p",[a._v("在IDEA中全局查找（ctrl + n）：org.apache.spark.deploy.SparkSubmit，找到SparkSubmit的伴生对象，并找到main方法 (大概946行)")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("override def "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("args"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Array")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Unit")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    val submit "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("SparkSubmit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br")])])])])])}),[],!1,null,null,null);s.default=p.exports}}]);