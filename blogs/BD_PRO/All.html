<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>sumup | Awaken&#39;s blogs</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/wtw.jpg">
    <meta name="description" content="Awaken's blogs">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.dfeb017d.css" as="style"><link rel="preload" href="/assets/js/app.03646987.js" as="script"><link rel="preload" href="/assets/js/3.a8134f0a.js" as="script"><link rel="preload" href="/assets/js/1.a394b090.js" as="script"><link rel="preload" href="/assets/js/11.38bfbf06.js" as="script"><link rel="prefetch" href="/assets/js/10.0aed174e.js"><link rel="prefetch" href="/assets/js/100.02914097.js"><link rel="prefetch" href="/assets/js/101.95f6c81a.js"><link rel="prefetch" href="/assets/js/102.48df0133.js"><link rel="prefetch" href="/assets/js/103.200f5642.js"><link rel="prefetch" href="/assets/js/104.080c910a.js"><link rel="prefetch" href="/assets/js/105.943605b5.js"><link rel="prefetch" href="/assets/js/106.55d2b7c0.js"><link rel="prefetch" href="/assets/js/107.dbf3105f.js"><link rel="prefetch" href="/assets/js/108.3a747b28.js"><link rel="prefetch" href="/assets/js/109.e9453b81.js"><link rel="prefetch" href="/assets/js/110.15ce5269.js"><link rel="prefetch" href="/assets/js/111.e2a2b309.js"><link rel="prefetch" href="/assets/js/112.83e22ec5.js"><link rel="prefetch" href="/assets/js/113.4c53e21e.js"><link rel="prefetch" href="/assets/js/114.3fdb14e5.js"><link rel="prefetch" href="/assets/js/115.24fd8b47.js"><link rel="prefetch" href="/assets/js/116.fa4af7d3.js"><link rel="prefetch" href="/assets/js/117.c5bc84c0.js"><link rel="prefetch" href="/assets/js/118.6ad3d598.js"><link rel="prefetch" href="/assets/js/119.fd9eb4ba.js"><link rel="prefetch" href="/assets/js/12.088628ed.js"><link rel="prefetch" href="/assets/js/120.36824fa8.js"><link rel="prefetch" href="/assets/js/121.6edd4478.js"><link rel="prefetch" href="/assets/js/122.228b556b.js"><link rel="prefetch" href="/assets/js/123.a51f4b7b.js"><link rel="prefetch" href="/assets/js/124.32fa9997.js"><link rel="prefetch" href="/assets/js/125.29138718.js"><link rel="prefetch" href="/assets/js/126.bfeae404.js"><link rel="prefetch" href="/assets/js/127.bbe78f94.js"><link rel="prefetch" href="/assets/js/128.6a9fd1ab.js"><link rel="prefetch" href="/assets/js/129.a26030ce.js"><link rel="prefetch" href="/assets/js/13.50987128.js"><link rel="prefetch" href="/assets/js/130.5a29c5e3.js"><link rel="prefetch" href="/assets/js/131.83dd6a40.js"><link rel="prefetch" href="/assets/js/132.31961e3b.js"><link rel="prefetch" href="/assets/js/133.12379872.js"><link rel="prefetch" href="/assets/js/134.2f630670.js"><link rel="prefetch" href="/assets/js/135.516248e9.js"><link rel="prefetch" href="/assets/js/136.c9fb3676.js"><link rel="prefetch" href="/assets/js/137.0d58b935.js"><link rel="prefetch" href="/assets/js/138.106b8051.js"><link rel="prefetch" href="/assets/js/139.3a4177bb.js"><link rel="prefetch" href="/assets/js/14.d98ee26c.js"><link rel="prefetch" href="/assets/js/140.cf104912.js"><link rel="prefetch" href="/assets/js/141.917d5919.js"><link rel="prefetch" href="/assets/js/142.d0c49c8f.js"><link rel="prefetch" href="/assets/js/143.e5647fcb.js"><link rel="prefetch" href="/assets/js/144.42362cf2.js"><link rel="prefetch" href="/assets/js/145.9f603000.js"><link rel="prefetch" href="/assets/js/146.9b30f1cd.js"><link rel="prefetch" href="/assets/js/147.00acaf92.js"><link rel="prefetch" href="/assets/js/148.0c69b088.js"><link rel="prefetch" href="/assets/js/149.2f219e93.js"><link rel="prefetch" href="/assets/js/15.d642d730.js"><link rel="prefetch" href="/assets/js/150.375474c6.js"><link rel="prefetch" href="/assets/js/151.66a582d5.js"><link rel="prefetch" href="/assets/js/152.1665682e.js"><link rel="prefetch" href="/assets/js/153.5a97da8e.js"><link rel="prefetch" href="/assets/js/154.3b76b78d.js"><link rel="prefetch" href="/assets/js/155.c92a6111.js"><link rel="prefetch" href="/assets/js/156.a247cd62.js"><link rel="prefetch" href="/assets/js/16.172153f0.js"><link rel="prefetch" href="/assets/js/17.ca69a778.js"><link rel="prefetch" href="/assets/js/18.3be7ba8f.js"><link rel="prefetch" href="/assets/js/19.4f66b5d8.js"><link rel="prefetch" href="/assets/js/20.8f0cd2cb.js"><link rel="prefetch" href="/assets/js/21.20681ba8.js"><link rel="prefetch" href="/assets/js/22.53b5baea.js"><link rel="prefetch" href="/assets/js/23.8b55cb0e.js"><link rel="prefetch" href="/assets/js/24.3328372c.js"><link rel="prefetch" href="/assets/js/25.ec23edd8.js"><link rel="prefetch" href="/assets/js/26.76e210a5.js"><link rel="prefetch" href="/assets/js/27.29b300ec.js"><link rel="prefetch" href="/assets/js/28.682ad17a.js"><link rel="prefetch" href="/assets/js/29.e1db4b89.js"><link rel="prefetch" href="/assets/js/30.796c2e36.js"><link rel="prefetch" href="/assets/js/31.912d2fae.js"><link rel="prefetch" href="/assets/js/32.60a749df.js"><link rel="prefetch" href="/assets/js/33.d87002b1.js"><link rel="prefetch" href="/assets/js/34.40a8b3f6.js"><link rel="prefetch" href="/assets/js/35.670ac802.js"><link rel="prefetch" href="/assets/js/36.e9f74d88.js"><link rel="prefetch" href="/assets/js/37.6d6f43d0.js"><link rel="prefetch" href="/assets/js/38.ef496ae1.js"><link rel="prefetch" href="/assets/js/39.fc216f43.js"><link rel="prefetch" href="/assets/js/4.01043612.js"><link rel="prefetch" href="/assets/js/40.3bd13625.js"><link rel="prefetch" href="/assets/js/41.3f331b95.js"><link rel="prefetch" href="/assets/js/42.3b26f469.js"><link rel="prefetch" href="/assets/js/43.744d42da.js"><link rel="prefetch" href="/assets/js/44.8b9a8908.js"><link rel="prefetch" href="/assets/js/45.19c8ed8e.js"><link rel="prefetch" href="/assets/js/46.29927647.js"><link rel="prefetch" href="/assets/js/47.e4f53070.js"><link rel="prefetch" href="/assets/js/48.108272d7.js"><link rel="prefetch" href="/assets/js/49.c1e35862.js"><link rel="prefetch" href="/assets/js/5.80b3dd9d.js"><link rel="prefetch" href="/assets/js/50.8af695e4.js"><link rel="prefetch" href="/assets/js/51.33ef3df2.js"><link rel="prefetch" href="/assets/js/52.58bb8f89.js"><link rel="prefetch" href="/assets/js/53.4c6b5e8a.js"><link rel="prefetch" href="/assets/js/54.5763a55d.js"><link rel="prefetch" href="/assets/js/55.15295e7d.js"><link rel="prefetch" href="/assets/js/56.61c94966.js"><link rel="prefetch" href="/assets/js/57.46def60f.js"><link rel="prefetch" href="/assets/js/58.119434b5.js"><link rel="prefetch" href="/assets/js/59.f712c9c5.js"><link rel="prefetch" href="/assets/js/6.a702a72d.js"><link rel="prefetch" href="/assets/js/60.2072c323.js"><link rel="prefetch" href="/assets/js/61.09518814.js"><link rel="prefetch" href="/assets/js/62.35a494eb.js"><link rel="prefetch" href="/assets/js/63.d31876c6.js"><link rel="prefetch" href="/assets/js/64.8f68a737.js"><link rel="prefetch" href="/assets/js/65.6b094c4b.js"><link rel="prefetch" href="/assets/js/66.7c5599cd.js"><link rel="prefetch" href="/assets/js/67.625cd24c.js"><link rel="prefetch" href="/assets/js/68.371f4f22.js"><link rel="prefetch" href="/assets/js/69.c45293ee.js"><link rel="prefetch" href="/assets/js/7.076cee01.js"><link rel="prefetch" href="/assets/js/70.7a22bd02.js"><link rel="prefetch" href="/assets/js/71.729213ff.js"><link rel="prefetch" href="/assets/js/72.0f07bfbc.js"><link rel="prefetch" href="/assets/js/73.4d0355d4.js"><link rel="prefetch" href="/assets/js/74.0f47f56e.js"><link rel="prefetch" href="/assets/js/75.d11ecf15.js"><link rel="prefetch" href="/assets/js/76.727f8a27.js"><link rel="prefetch" href="/assets/js/77.f71a8653.js"><link rel="prefetch" href="/assets/js/78.cb1a43c1.js"><link rel="prefetch" href="/assets/js/79.9e83573b.js"><link rel="prefetch" href="/assets/js/8.d5f02645.js"><link rel="prefetch" href="/assets/js/80.ffafa3ff.js"><link rel="prefetch" href="/assets/js/81.30de8c9b.js"><link rel="prefetch" href="/assets/js/82.4cb0a9a6.js"><link rel="prefetch" href="/assets/js/83.6bf25e9a.js"><link rel="prefetch" href="/assets/js/84.984a50d8.js"><link rel="prefetch" href="/assets/js/85.81009c16.js"><link rel="prefetch" href="/assets/js/86.3325dd7c.js"><link rel="prefetch" href="/assets/js/87.d9dea564.js"><link rel="prefetch" href="/assets/js/88.620d3c46.js"><link rel="prefetch" href="/assets/js/89.414375c4.js"><link rel="prefetch" href="/assets/js/9.f9048235.js"><link rel="prefetch" href="/assets/js/90.07be05fd.js"><link rel="prefetch" href="/assets/js/91.5b6132ee.js"><link rel="prefetch" href="/assets/js/92.efd68e29.js"><link rel="prefetch" href="/assets/js/93.4e37aebc.js"><link rel="prefetch" href="/assets/js/94.a306e6d9.js"><link rel="prefetch" href="/assets/js/95.ddbaa2e0.js"><link rel="prefetch" href="/assets/js/96.b4c98c12.js"><link rel="prefetch" href="/assets/js/97.3bca48ba.js"><link rel="prefetch" href="/assets/js/98.f52f497a.js"><link rel="prefetch" href="/assets/js/99.588f017d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.dfeb017d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>Awaken's blogs</h3> <p class="description" data-v-4e82dffc data-v-4e82dffc>Awaken's blogs</p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>Awaken</span>
            
          <!---->
          2024
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/wtw.jpg" alt="Awaken's blogs" class="logo"> <span class="site-name">Awaken's blogs</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/BigData/" class="nav-link"><i class="undefined"></i>
  BigData
</a></li><li class="dropdown-item"><!----> <a href="/categories/DAG/" class="nav-link"><i class="undefined"></i>
  DAG
</a></li><li class="dropdown-item"><!----> <a href="/categories/ES/" class="nav-link"><i class="undefined"></i>
  ES
</a></li><li class="dropdown-item"><!----> <a href="/categories/Flink/" class="nav-link"><i class="undefined"></i>
  Flink
</a></li><li class="dropdown-item"><!----> <a href="/categories/JUC/" class="nav-link"><i class="undefined"></i>
  JUC
</a></li><li class="dropdown-item"><!----> <a href="/categories/JVM/" class="nav-link"><i class="undefined"></i>
  JVM
</a></li><li class="dropdown-item"><!----> <a href="/categories/JavaSE/" class="nav-link"><i class="undefined"></i>
  JavaSE
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/LeetCode/" class="nav-link"><i class="undefined"></i>
  LeetCode
</a></li><li class="dropdown-item"><!----> <a href="/categories/LINUX/" class="nav-link"><i class="undefined"></i>
  LINUX
</a></li><li class="dropdown-item"><!----> <a href="/categories/Linux/" class="nav-link"><i class="undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/categories/DB/" class="nav-link"><i class="undefined"></i>
  DB
</a></li><li class="dropdown-item"><!----> <a href="/categories/SSM/" class="nav-link"><i class="undefined"></i>
  SSM
</a></li><li class="dropdown-item"><!----> <a href="/categories/RK/" class="nav-link"><i class="undefined"></i>
  RK
</a></li><li class="dropdown-item"><!----> <a href="/categories/MQ/" class="nav-link"><i class="undefined"></i>
  MQ
</a></li><li class="dropdown-item"><!----> <a href="/categories/redis/" class="nav-link"><i class="undefined"></i>
  redis
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spark/" class="nav-link"><i class="undefined"></i>
  Spark
</a></li><li class="dropdown-item"><!----> <a href="/categories/SpringBoot/" class="nav-link"><i class="undefined"></i>
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/categories/projects/" class="nav-link"><i class="undefined"></i>
  projects
</a></li><li class="dropdown-item"><!----> <a href="/categories/SpringCloud/" class="nav-link"><i class="undefined"></i>
  SpringCloud
</a></li><li class="dropdown-item"><!----> <a href="/categories/project1/" class="nav-link"><i class="undefined"></i>
  project1
</a></li><li class="dropdown-item"><!----> <a href="/categories/Tools/" class="nav-link"><i class="undefined"></i>
  Tools
</a></li><li class="dropdown-item"><!----> <a href="/categories/arthas/" class="nav-link"><i class="undefined"></i>
  arthas
</a></li><li class="dropdown-item"><!----> <a href="/categories/deploy/" class="nav-link"><i class="undefined"></i>
  deploy
</a></li><li class="dropdown-item"><!----> <a href="/categories/k8s/" class="nav-link"><i class="undefined"></i>
  k8s
</a></li><li class="dropdown-item"><!----> <a href="/categories/mall/" class="nav-link"><i class="undefined"></i>
  mall
</a></li><li class="dropdown-item"><!----> <a href="/categories/Python/" class="nav-link"><i class="undefined"></i>
  Python
</a></li><li class="dropdown-item"><!----> <a href="/categories/others/" class="nav-link"><i class="undefined"></i>
  others
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/documents/" class="nav-link"><i class="undefined"></i>
  documents
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/recoluan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><img src="/wtw.jpg" alt="author-avatar" class="personal-img" data-v-828910c6> <h3 class="name" data-v-828910c6>
    Awaken
  </h3> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>144</h3> <h6 data-v-828910c6>Articles</h6></div> <div data-v-828910c6><h3 data-v-828910c6>78</h3> <h6 data-v-828910c6>Tags</h6></div></div> <ul class="social-links" data-v-828910c6></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/BigData/" class="nav-link"><i class="undefined"></i>
  BigData
</a></li><li class="dropdown-item"><!----> <a href="/categories/DAG/" class="nav-link"><i class="undefined"></i>
  DAG
</a></li><li class="dropdown-item"><!----> <a href="/categories/ES/" class="nav-link"><i class="undefined"></i>
  ES
</a></li><li class="dropdown-item"><!----> <a href="/categories/Flink/" class="nav-link"><i class="undefined"></i>
  Flink
</a></li><li class="dropdown-item"><!----> <a href="/categories/JUC/" class="nav-link"><i class="undefined"></i>
  JUC
</a></li><li class="dropdown-item"><!----> <a href="/categories/JVM/" class="nav-link"><i class="undefined"></i>
  JVM
</a></li><li class="dropdown-item"><!----> <a href="/categories/JavaSE/" class="nav-link"><i class="undefined"></i>
  JavaSE
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/LeetCode/" class="nav-link"><i class="undefined"></i>
  LeetCode
</a></li><li class="dropdown-item"><!----> <a href="/categories/LINUX/" class="nav-link"><i class="undefined"></i>
  LINUX
</a></li><li class="dropdown-item"><!----> <a href="/categories/Linux/" class="nav-link"><i class="undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/categories/DB/" class="nav-link"><i class="undefined"></i>
  DB
</a></li><li class="dropdown-item"><!----> <a href="/categories/SSM/" class="nav-link"><i class="undefined"></i>
  SSM
</a></li><li class="dropdown-item"><!----> <a href="/categories/RK/" class="nav-link"><i class="undefined"></i>
  RK
</a></li><li class="dropdown-item"><!----> <a href="/categories/MQ/" class="nav-link"><i class="undefined"></i>
  MQ
</a></li><li class="dropdown-item"><!----> <a href="/categories/redis/" class="nav-link"><i class="undefined"></i>
  redis
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spark/" class="nav-link"><i class="undefined"></i>
  Spark
</a></li><li class="dropdown-item"><!----> <a href="/categories/SpringBoot/" class="nav-link"><i class="undefined"></i>
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/categories/projects/" class="nav-link"><i class="undefined"></i>
  projects
</a></li><li class="dropdown-item"><!----> <a href="/categories/SpringCloud/" class="nav-link"><i class="undefined"></i>
  SpringCloud
</a></li><li class="dropdown-item"><!----> <a href="/categories/project1/" class="nav-link"><i class="undefined"></i>
  project1
</a></li><li class="dropdown-item"><!----> <a href="/categories/Tools/" class="nav-link"><i class="undefined"></i>
  Tools
</a></li><li class="dropdown-item"><!----> <a href="/categories/arthas/" class="nav-link"><i class="undefined"></i>
  arthas
</a></li><li class="dropdown-item"><!----> <a href="/categories/deploy/" class="nav-link"><i class="undefined"></i>
  deploy
</a></li><li class="dropdown-item"><!----> <a href="/categories/k8s/" class="nav-link"><i class="undefined"></i>
  k8s
</a></li><li class="dropdown-item"><!----> <a href="/categories/mall/" class="nav-link"><i class="undefined"></i>
  mall
</a></li><li class="dropdown-item"><!----> <a href="/categories/Python/" class="nav-link"><i class="undefined"></i>
  Python
</a></li><li class="dropdown-item"><!----> <a href="/categories/others/" class="nav-link"><i class="undefined"></i>
  others
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/documents/" class="nav-link"><i class="undefined"></i>
  documents
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/recoluan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>sumup</h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>Awaken</span>
            
          <!---->
          2024
        </a></span></div></div> <div data-v-1156296a><main class="page"><section><div class="page-title"><h1 class="title">sumup</h1> <div data-v-1ff7123e><i class="iconfont reco-account" data-v-1ff7123e><span data-v-1ff7123e>Awaken</span></i> <i class="iconfont reco-date" data-v-1ff7123e><span data-v-1ff7123e>2/1/2023</span></i> <!----> <i class="tags iconfont reco-tag" data-v-1ff7123e><span class="tag-item" data-v-1ff7123e>sumup</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="_1-linux命令"><a href="#_1-linux命令" class="header-anchor">#</a> 1. Linux命令</h2> <p>高级命令：</p> <p><code>ps -ef|grep java</code></p> <p>ps
作用： 主要是查看服务器的进程信息
选项含义：
-e：等价于 ‘-A’ ，表示列出全部的进程
-f：显示全部的列（显示全字段）</p> <p><code>netstat</code></p> <p>命令用于显示网络状态</p> <p><code>top</code></p> <p>即时显示 process 的动态</p> <p><code>iotop</code></p> <p>-o：只显示有io操作的进程
-b：批量显示，无交互，主要用作记录到文件。
-n NUM：显示NUM次，主要用于非交互式模式。
-d SEC：间隔SEC秒显示一次。
-p PID：监控的进程pid。
-u USER：监控的进程用户。</p> <p><code>free</code></p> <p>free是指查看当前系统内存的使用情况，它显示系统中剩余及已用的物理内存和交换内存，以及共享内存和被核心使用的缓冲区。</p> <p><code>df</code></p> <p>df -a：显示所有文件系统的磁盘使用情况，包括0块（block）的文件系统。</p> <p>df -h：以容易理解的格式输出文件系统大小，例如124KB、345MB、46GB。</p> <p>df -i：显示i节点信息，而不是磁盘块。</p> <p>df -t：显示各指定类型的文件系统的磁盘空间使用情况。</p> <p>df -x：列出不是某一指定类型文件系统的磁盘空间使用情况。</p> <p>df -T：显示文件系统类型。</p> <p>df 以512字节为单位</p> <p>df –k 以1024字节为单位.</p> <p><code>grep -lr xxxx *</code></p> <p>查询当前目录下面的日志中是否包含 xxxx 字符</p> <h2 id="_2-shell"><a href="#_2-shell" class="header-anchor">#</a> 2. Shell</h2> <p>常用工具：awk  cut  sed  sorts</p> <h3 id="_2-1-群启-关脚本"><a href="#_2-1-群启-关脚本" class="header-anchor">#</a> 2.1 群启/关脚本</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span>
<span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> hadoop102 hadoop103 hadoop104
<span class="token keyword">do</span>
	<span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">&quot;start&quot;</span>
<span class="token keyword">done</span>
<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token string">&quot;stop&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> hadoop102 hadoop103 hadoop104
<span class="token keyword">do</span>
	<span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">&quot;stop&quot;</span>
<span class="token keyword">done</span>
<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_2-2-分发脚本"><a href="#_2-2-分发脚本" class="header-anchor">#</a> 2.2 分发脚本</h3> <h3 id="_2-3-sqoop脚本"><a href="#_2-3-sqoop脚本" class="header-anchor">#</a> 2.3 Sqoop脚本</h3> <p>导入(同步策略)</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>-query <span class="token string">&quot;select * from t where 1 = 1 &amp; $&quot;</span>
-query <span class="token string">&quot;select * from t where create_time = <span class="token variable">$do_date</span> &amp; $&quot;</span>
-query <span class="token string">&quot;select * from t where create_time = <span class="token variable">$do_date</span> or op_time = <span class="token variable">$do_date</span> &amp; $&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>导出</p> <h3 id="_2-4-ods-dwd-dws-dwt"><a href="#_2-4-ods-dwd-dws-dwt" class="header-anchor">#</a> 2.4 ods -&gt; dwd -&gt; dws -&gt; dwt</h3> <h3 id="_2-5-和-的区别-嵌套时看最外层"><a href="#_2-5-和-的区别-嵌套时看最外层" class="header-anchor">#</a> 2.5 '' 和 &quot;&quot; 的区别，嵌套时看最外层</h3> <h2 id="_3-hadoop"><a href="#_3-hadoop" class="header-anchor">#</a> 3. Hadoop</h2> <h3 id="_3-1-入门"><a href="#_3-1-入门" class="header-anchor">#</a> 3.1 入门</h3> <p>常用端口号</p> <table><thead><tr><th></th> <th><strong>hadoop2.x</strong></th> <th><strong>hadoop3.x</strong></th></tr></thead> <tbody><tr><td><strong>访问HDFS端口</strong></td> <td>50070</td> <td>9870</td></tr> <tr><td><strong>访问MR执行情况端口</strong></td> <td>8088</td> <td>8088</td></tr> <tr><td><strong>历史服务器</strong></td> <td>19888</td> <td>19888</td></tr> <tr><td><strong>客户端访问集群端口</strong></td> <td>9000</td> <td>8020</td></tr></tbody></table> <p>端口号</p> <table><thead><tr><th>版本</th> <th>NN(外部访问/内部通信 )</th> <th>RM(外部访问/内部通信 )</th> <th>History(外部访问/内部通信 )</th></tr></thead> <tbody><tr><td>2.x</td> <td>50070/9000</td> <td>8088/8032</td> <td>19888/10020</td></tr> <tr><td>3.x</td> <td>9870/8020</td> <td>8088/8032</td> <td>19888/10020</td></tr></tbody></table> <p>配置文件</p> <table><thead><tr><th></th> <th></th> <th></th> <th></th> <th></th> <th></th></tr></thead> <tbody><tr><td>2.x</td> <td>core</td> <td>hdfs</td> <td>yarn</td> <td>mapred</td> <td>slaves</td></tr> <tr><td>3.x</td> <td>core</td> <td>hdfs</td> <td>yarn</td> <td>mapred</td> <td>workers</td></tr></tbody></table> <h3 id="_3-2-hdfs"><a href="#_3-2-hdfs" class="header-anchor">#</a> 3.2 HDFS</h3> <blockquote><p>注意：HDFS写入流程时候，某台dataNode挂掉如何运行？</p> <p>​	当DataNode突然挂掉了，客户端接收不到这个DataNode发送的ack确认，客户端会通知NameNode，</p> <p>NameNode检查并确认该块的副本与规定的不符，NameNode会通知闲置的DataNode去复制副本，并将挂掉的</p> <p>DataNode作下线处理。等挂掉的DataNode节点恢复后, 删除该节点中曾经拷贝的不完整副本数据。</p></blockquote> <ol><li>读写流程
<ol><li>写流程
<ol><li>客户端通过Distributed FileSystem模块向NameNode请求上传文件，NN 检查文件和父目录是否存在</li> <li>NN 返回是否可以上传</li> <li>客户端请求第一个 Block ，向 NN 请求返回 DataNode</li> <li>NN 返回 3 个 DataNode 节点，dn1,dn2,dn3</li> <li>客户端通过 FSDataOutPutStream 模块请求 dn1 上传数据，dn1收到请求会继续调用dn2，然后dn2调用 dn3，将这个管道建立完毕</li> <li>dn1、dn2、dn3 逐级应答客户端</li> <li>客户端开始往dn1上传第一个Block（先从磁盘读取数据放到一个本地内存缓存），以Packet为单位，dn1收到一个 packet 就会传给 dn2，dn2 传给 dn3，dn1每传一个packet会放入一个应答队列等待应答</li> <li>当一个Block传输完成之后，客户端再次请求 NN 上传第二个 Block的服务器</li></ol></li> <li>读流程
<ol><li>客户端通过Distributed FileSystem请求下载文件，NN 通过查询元数据，找到文件所在的 DN地址</li> <li>挑选一台 DN （就近原则，然后随机）服务器，请求读取数据</li> <li>DN 开始传输数据给客户端（从磁盘里面读取数据输入流，以 Packet为单位来做校验）</li> <li>客户端以 Packet 为单位接收，先在本地缓存，然后写入目标文件</li></ol></li></ol></li> <li>小文件问题
<ol><li>危害
<ol><li>NN的存储效率低，小文件都会占用一个元数据</li> <li>计算：每个小文件会单独开启一个 任务 (MapTask)，一个MapTask默认内存 1G</li></ol></li> <li>解决办法
<ol><li>Flume的HDFSSink从源头解决小文件问题、Map任务合并、HAR归档解决已经产生的小文件</li> <li>采用CombineInputFormat、</li> <li>自己写一个MR程序将产生的小文件合并成一个大文件。如果是Hive或者Spark有merge功能自动帮助我们合并。</li> <li>有小文件场景开启JVM重用；如果没有小文件，不要开启JVM重用，因为会一直占用使用到的Task卡槽，直到任务完成才释放。JVM重用(MR引擎可用/Spark引擎不可用)</li></ol></li></ol></li></ol> <blockquote><p>JVM重用可以使得JVM实例在同一个job中重新使用N次，N的值可以在Hadoop的mapred-site.xml文件中进行配置。通常在10-20之间。</p></blockquote> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>mapreduce.job.jvm.numtasks<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>How many tasks to run per jvm,if set to -1 ,there is  no limit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="3"><li><strong>块大小</strong> <ol><li>1.x：64M</li> <li>2.x：128M</li> <li>3.x：128M</li> <li>local：32M</li> <li>Hive：256M</li> <li>大厂：256M及以上</li></ol></li></ol> <p>根据：磁盘的读取速度</p> <ul><li>如果寻址时间为 10ms，即查找目标block的时间为10ms</li> <li>寻址时间为传输时间的 1% 时，即为最佳状态。因此传输时间 = 10ms * 100 = 1s</li> <li>而目前磁盘的传输速率普遍为 100MB/s</li> <li>block 大小 = 1s * 100MB/s = 100MB</li></ul> <blockquote><p>如果HDFS的块设置太小，会增加寻址时间，程序一直在找块的开始位置</p> <p>如果块设置太大，从磁盘传输数据的时间会明显大于定位这个块开始位置所需的时间。导致程序在处理这块数据时，会非常慢。</p></blockquote> <h3 id="_3-3-mr"><a href="#_3-3-mr" class="header-anchor">#</a> 3.3 MR</h3> <p>Shuffle：Map方法之后到Reduce方法之前 (PPT 01)</p> <h3 id="_3-4-yarn"><a href="#_3-4-yarn" class="header-anchor">#</a> 3.4 Yarn</h3> <p>调度器：FIFO、容量、公平</p> <p>FIFO：单队列、先进先出（几乎不用）</p> <p>容量：多队列、队列内部先进先出、可以使用其他队列的资源（大部分公司）</p> <p>公平：多队列、队列内部按照缺额、可以使用其他队列的资源（大厂、并发度要求高）</p> <p>队列：默认</p> <p>按照什么分？</p> <p>​	业务：hive/spark/flink 每个框架的任务放入指定的队列（企业用的不是特别多）</p> <p>​	框架：登录注册、购物车、下单、业务部门1、业务部门2</p> <p>​	个人：防止菜鸟</p> <p>提交流程(工作机制)</p> <h2 id="_4-zookeeper"><a href="#_4-zookeeper" class="header-anchor">#</a> 4. Zookeeper</h2> <h3 id="_4-1-选举机制"><a href="#_4-1-选举机制" class="header-anchor">#</a> 4.1 选举机制</h3> <p>多数机制</p> <h3 id="_4-2-机器台数"><a href="#_4-2-机器台数" class="header-anchor">#</a> 4.2 机器台数</h3> <p>奇数台</p> <p>10台服务器	3台</p> <p>20台服务器	5台</p> <p>50台服务器	7台</p> <p>100台服务器	11台</p> <p>200台服务器	11台</p> <p>台数多，好处：提高可靠性；坏处：影响通信延时。</p> <h3 id="_4-3-常用命令"><a href="#_4-3-常用命令" class="header-anchor">#</a> 4.3 常用命令</h3> <p>create	ls	get	delete	deleteall</p> <h3 id="_4-4-zk的cap"><a href="#_4-4-zk的cap" class="header-anchor">#</a> 4.4 Zk的CAP</h3> <ul><li>一致性 (Consistency)
<ul><li>在分布式环境中，一致性是指数据在多个副本之间是否能够保证数据一致的特性</li></ul></li> <li>可用性 (Available)
<ul><li>可用性是指系统提供服务必须一直处于不可用的状态，对于用户的每一个操作请求总是能够在有限的时间内返回结果</li></ul></li> <li>分区容错性 (Partition Tolerance)
<ul><li>分布式系统在遇到任何网络分区故障的时候，仍然需要能够保证对外提供满足一致性和可用性的服务，除非是整个网络环境都发生了故障</li></ul></li></ul> <p>Zk保证的是 CP，</p> <ol><li>Zk 不能保证每次服务请求的可用性。（注：在极端环境下，Zk可能会丢弃一些请求，消费者程序需要重新请求才能获得结果）。所以说，Zk不能保证服务可用性</li> <li>进行 Leader 选举时集群都是不可用的</li></ol> <h3 id="_4-5-zk脑裂"><a href="#_4-5-zk脑裂" class="header-anchor">#</a> 4.5 Zk脑裂</h3> <p>Zookeeper 采用过半选举机制，防止了脑裂</p> <h2 id="_5-flume"><a href="#_5-flume" class="header-anchor">#</a> 5. Flume</h2> <h3 id="_5-1-基本组成"><a href="#_5-1-基本组成" class="header-anchor">#</a> 5.1 基本组成</h3> <ol><li>Source
<ol><li>tailDirSource：断点续传、多目录多文件监控</li> <li>KafkaSource</li> <li>netcat</li> <li>avro source</li></ol></li> <li>Channle
<ol><li>Memory</li> <li>File</li> <li>Kafka</li></ol></li> <li>Sink
<ol><li>HDFS  sink</li> <li>avro  sink</li></ol></li></ol> <p>tailDirSource：断点续传（保留上一次读取的位置信息）</p> <p>位置信息：[ 绝对路径+inode值 -&gt; position ]，inode(Linux在创建一个文件时生成的一个唯一值)</p> <p>数据重复问题：日志框架在对日志进行更名时，更名后的文件会被重新读取一次</p> <p>key = 绝对路径 + inode值，文件更名后绝对路径变了，Flume认为是一个新的文件，就会再次读取</p> <p>log4j：</p> <p>​	2023-02-09</p> <p>​	hive.log</p> <p>​	2023-02-10</p> <p>​	hive.log-2023-02-09</p> <p>​	hive.log</p> <p>解决：</p> <p>​	方案一：写死监控文件名		丢数据</p> <p>​			原因：中途任务挂了，重启之后，日志已经更名，就会有一部分数据丢失(例如 1.50分挂，2.05分重启)</p> <p>​	方案二：采用不更名的日志框架或者选择当前框架不更名的模式</p> <p>​			logback:</p> <p>​				2023-02-09</p> <p>​				hive.log-2023-02-09</p> <p>​				2023-02-10</p> <p>​				hive.log-2023-02-09</p> <p>​				hive.log-2023-02-10</p> <p>​	方案三：修改源码、去掉路径直接以 inode 值作为 key</p> <p>​			TailFile.class ， updatePos</p> <h3 id="_5-2-三个器-一个组"><a href="#_5-2-三个器-一个组" class="header-anchor">#</a> 5.2 三个器 + 一个组</h3> <ol><li>拦截器
<ol><li>ETL拦截器：过滤掉非JSON格式的数据 (logger)</li> <li>时间戳拦截器：零点漂移</li> <li>自定义步骤：静态内部类构建拦截器对象</li></ol></li> <li>Channel选择器
<ol><li>副本：默认</li> <li>多路复用：结合拦截器</li></ol></li> <li>监控器
<ol><li>尝试 Put 的条数、成功 Put 条数</li> <li>尝试 Take 的条数、成功 Task 条数</li> <li>Channel 中现有数据条数</li></ol></li> <li>Sink组
<ol><li>默认：只允许一个 Sink</li> <li>负载均衡：轮询</li> <li>故障转移：优先级</li></ol></li></ol> <h3 id="_5-3-数据丢失"><a href="#_5-3-数据丢失" class="header-anchor">#</a> 5.3 数据丢失</h3> <p>​	首先，我们采用Ganglia监控Flume任务，发现</p> <p>​	成功 Put 条数 = 成功 Take 条数 + Channel 中现有数据条数，说明没有丢失数据。</p> <p>​	 我们采用的是(组件说明)，同时 Source与 Channel 以及 Channel 与 Sink 之间传输有事务保证</p> <h3 id="_5-4-优化"><a href="#_5-4-优化" class="header-anchor">#</a> 5.4 优化</h3> <ol><li>调整内存
<ol><li>flume-env.sh     4-6G</li></ol></li> <li>HDFS  Sink 小文件
<ol><li>滚动文件条件：时间(1h)、大小(128M)、事件的条数(0)</li> <li>压缩</li></ol></li> <li>file channel 优化
<ol><li>能多目录（多磁盘）配置多目录，能提高吞吐量</li></ol></li></ol> <p>Flume参数调优：</p> <p>Source：增加Source个数和batchSize</p> <p>Channel ：增大Capacity</p> <p>Sink ：增加Sink的个数和batciSize</p> <h3 id="_5-5-taildir底层原理"><a href="#_5-5-taildir底层原理" class="header-anchor">#</a> 5.5 taildir底层原理</h3> <p><img src="https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/shuffle%2Ftaildir.png" alt=""></p> <h2 id="_6-kafka"><a href="#_6-kafka" class="header-anchor">#</a> 6. Kafka*</h2> <blockquote><p>生产者、Broker、消费者、Zookeeper。
注意：Zookeeper中保存Broker id和controller等信息，但是没有生产者信息。</p></blockquote> <h3 id="_6-1-组成"><a href="#_6-1-组成" class="header-anchor">#</a> 6.1 组成</h3> <ol><li>生产者
<ol><li>发送流程    两个线程(主线程和Sender线程)    三个器(拦截器、序列化器、分区器)</li> <li>ACK   (0  1  -1)</li> <li>分区规则</li> <li>幂等性    事务</li></ol></li> <li>集群(ZK)
<ol><li>topic：分类数据
<ol><li>分区：
<ol><li>服务端：负载均衡</li> <li>客户端：提高效率</li></ol></li> <li>副本：提高可靠性
<ol><li>ISR：同步副本队列</li> <li>AR  =  ISR + OSR</li> <li>LEO：当前副本最大的 Offset</li> <li>HW：同一个分区最小的 LEO，消费者可见的最大的 Offset
<ol><li>作用：保证了消费数据的一致性、保证了存储数据的一致性</li></ol></li></ol></li></ol></li></ol></li> <li>消费者(ZK)
<ol><li>消费者组：分区分配规则</li> <li>Offset的维护：Zookeeper、__consumer_offsets、手动维护</li></ol></li> <li>数据量    峰值速度
<ol><li>100万日活   *   100条数据   =  1亿</li> <li>每条数据 ：1k</li> <li>每天的数据量 ：100 G</li> <li>平均每秒数据量：1 亿 / 24 * 60 * 60 = 1150 条 / s</li> <li>峰值速度：20 M / s</li></ol></li> <li>集群规模
<ol><li>经验公式：2 * (峰值速度 * 副本数 / 100) + 1  =  3 台</li></ol></li> <li>分区数
<ol><li>一台服务器 2 ~ 3 个分区 （3 * 2 = 6）</li></ol></li> <li>副本数
<ol><li>2 - 3</li></ol></li> <li>压测
<ol><li>自带脚本：生产和消费的速率</li> <li>生产速度  &gt;  峰值速度</li> <li>消费速度  &gt;  生产速度</li></ol></li> <li>监控
<ol><li>Eagle</li></ol></li></ol> <h3 id="_6-2-挂了"><a href="#_6-2-挂了" class="header-anchor">#</a> 6.2 挂了</h3> <p>​	副本、Flume、日志服务器的磁盘</p> <p>​	重启</p> <h3 id="_6-3-丢了"><a href="#_6-3-丢了" class="header-anchor">#</a> 6.3 丢了</h3> <ol><li>生产者：ACK   0   1
<ol><li>解决：ACK  设置  -1</li></ol></li> <li>消费者：先保存 Offset、后保存数据
<ol><li>解决：先保存数据、后保存 Offset</li> <li>解决：事务</li></ol></li></ol> <h3 id="_6-4-重复了"><a href="#_6-4-重复了" class="header-anchor">#</a> 6.4 重复了</h3> <ol><li>生产者：ACK 设置为 -1
<ol><li>解决：幂等性、事务</li></ol></li> <li>消费者：先保存数据、后保存 Offset
<ol><li>解决：下游框架幂等性</li> <li>解决：事务</li></ol></li></ol> <h3 id="_6-5-积压了"><a href="#_6-5-积压了" class="header-anchor">#</a> 6.5 积压了</h3> <ol><li>提高单次消费的数据量，同时提高处理数据程序的资源！</li> <li>提高主题的分区数(不可逆)，同时提高下游程序的并行度</li></ol> <h3 id="_6-6-优化"><a href="#_6-6-优化" class="header-anchor">#</a> 6.6 优化</h3> <ol><li>内存：4 - 6 G</li> <li>副本：2 - 3</li> <li>存储：默认保留 7 天，改为 3 天</li></ol> <h3 id="_6-7-其他"><a href="#_6-7-其他" class="header-anchor">#</a> 6.7 其他</h3> <ol><li>高效率的原因
<ol><li>分区</li> <li>顺序写磁盘</li> <li>零拷贝</li></ol></li> <li>来了一条 2 M 的数据，会发生什么事
<ol><li>会挂掉，最大值参数限制 （replica.fetch.max.bytes、message.max.bytes，fetch.message.max.bytes）</li></ol></li> <li>有序性问题，单分区有序
<ol><li>按照表名做 Key，保证同一张表进同一个分区，以保证同一张表是有序的</li></ol></li> <li>Epoch （解决丢数据问题）
<ol><li>一个单调递增的版本号，Leader变更会增加版本号。小版本号的Leader被认为是过期的Leader，不能再行使Leader的权力。</li> <li>Start Offset：起始位移，Leader副本在该Epoch上写入的首条消息的位移。</li></ol></li></ol> <h3 id="_6-8-面试题"><a href="#_6-8-面试题" class="header-anchor">#</a> 6.8 面试题</h3> <h2 id="_7-hive"><a href="#_7-hive" class="header-anchor">#</a> 7. Hive*</h2> <h3 id="_7-1-组成-架构-hql翻译成mr的过程"><a href="#_7-1-组成-架构-hql翻译成mr的过程" class="header-anchor">#</a> 7.1 组成/架构&amp;HQL翻译成MR的过程</h3> <h3 id="_7-2-与mysql区别"><a href="#_7-2-与mysql区别" class="header-anchor">#</a> 7.2 与MySQL区别</h3> <ol><li>相同点：SQL语法</li> <li>不同点：OLAP、OLTP
<ol><li>数据量</li></ol></li></ol> <h3 id="_7-3-内外部表的区别"><a href="#_7-3-内外部表的区别" class="header-anchor">#</a> 7.3 内外部表的区别</h3> <ol><li>删除数据
<ol><li>内部表：数据与元数据都删除</li> <li>外部表：只删除元数据   （绝大部分使用）</li> <li>可以互相转换</li></ol></li></ol> <h3 id="_7-4-4个by对比"><a href="#_7-4-4个by对比" class="header-anchor">#</a> 7.4 4个By对比</h3> <ol><li>order by：全局排序，只有一个Reducer（严格模式不能直接用，需要加 limit ）</li> <li>sort by：分区内排序，结合distribute  by 使用</li> <li>distribute by：分区</li> <li>cluster by：当distribute by 和 sort by字段相同且增序</li></ol> <h3 id="_7-5-函数"><a href="#_7-5-函数" class="header-anchor">#</a> 7.5 函数</h3> <ol><li>系统函数
<ol><li>日期：date_add、date_sub、date_format、datediff、next_day、last_day</li> <li>窗口函数：over()
<ol><li>lead、lag、rank、dense_rank、row_number</li> <li>partition by、order by、rows、between</li></ol></li> <li>扩展：first_value(开窗取第一条)、last_value
<ol><li>grouping sets((A,B,C),(A,B),(C),(B,C))、with cube、with rollup</li></ol></li></ol></li> <li>自定义函数
<ol><li>UDF</li> <li>UDTF</li></ol></li></ol> <h3 id="_7-6-优化"><a href="#_7-6-优化" class="header-anchor">#</a> 7.6 优化</h3> <ol><li>DDL
<ol><li>分区表</li> <li>分桶表</li> <li>文件格式：ORC/parquet</li> <li>压缩</li></ol></li> <li>DML
<ol><li>单表
<ol><li>行列过滤(少用 select *)</li> <li>​</li></ol></li> <li>多表
<ol><li>谓词下推</li> <li>Map  Join（大表和小表）</li> <li>SMB  Join（大表和大表）</li></ol></li></ol></li> <li>引擎
<ol><li>Spark</li> <li>Tez</li></ol></li> <li>HiveJob整体优化
<ol><li>本地模式，严格模式...</li></ol></li></ol> <h3 id="_7-7-数据倾斜-重点"><a href="#_7-7-数据倾斜-重点" class="header-anchor">#</a> 7.7 数据倾斜（重点）</h3> <p>产生原因：</p> <ol><li><p>单表查询时使用  GroupBy  字段</p> <ol><li><p>原因：某一组的数据过多</p></li> <li><p>解决：</p> <ol><li><p>先抽样判断是单个Key还是多个Key造成的数据倾斜</p></li> <li><p>解决：加随机数双重聚合</p> <ol><li><p>自动：设置参数即可解决（set hive.groupby.skewindata = true;）</p></li> <li><p>手动：根据 id 聚合时加上：concat (id, '-', 随机数)</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> a<span class="token punctuation">.</span>user_id<span class="token punctuation">,</span> a<span class="token punctuation">.</span>order_id<span class="token punctuation">,</span> b<span class="token punctuation">.</span>user_id
	<span class="token keyword">from</span> table_a a <span class="token keyword">join</span> table_b b
	<span class="token keyword">on</span> <span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> a<span class="token punctuation">.</span>user_is <span class="token operator">is</span> <span class="token boolean">null</span> <span class="token keyword">then</span> concat<span class="token punctuation">(</span><span class="token string">'hive'</span><span class="token punctuation">,</span> rand<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">else</span> a<span class="token punctuation">.</span>user_id <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token operator">=</span> b<span class="token punctuation">.</span>user_id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Hive 已对此进行了优化，只需要设置参数skewinfo和skewjoin参数，不修改SQL代码，例如，由于table_B的值“0” 和“1”引起了倾斜，值需要做如下设置：即 1.自动</p> <p><code>set hive.optimize.skewinfo=table_B:(selleer_id) [ (&quot;0&quot;) (&quot;1&quot;) ]</code></p> <p><code>set hive.optimize.skewjoin = true;</code></p></li></ol></li> <li><p>如果是：count()   sum() 不影响业务逻辑的时候</p> <ol><li>使用Combiner组件   预聚合</li></ol></li> <li><p>如果是求 平均数：使用 Combiner组件就不合适了</p></li> <li><p>多个Key造成的数据倾斜，增加Reducer的个数，可以缓解数据倾斜。</p></li></ol></li></ol></li> <li><p>多表关联时的  Join  字段</p> <ol><li><p>解决：</p> <ol><li><p>大表和小表    MapJoin (无 Reducer 阶段，则没有数据倾斜问题)</p></li> <li><p>大表和大表    扩容 Join</p> <ol><li><p>A、B两张表关联字段：id，添加随机数：concat(id, '-', 随机数)</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>A：concat<span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
B：concat<span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
         <span class="token keyword">union</span> <span class="token keyword">all</span>
   concat<span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
         <span class="token keyword">union</span> <span class="token keyword">all</span>
   concat<span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ol></li></ol></li></ol></li> <li><p>具体描述</p> <ol><li><p>做过哪些优化？解决过哪些问题？</p> <ol><li>公司给某些城市做活动，活动之后想要统计活动收益，按照城市计算各种指标！各个城市数据量不均，发现执行当前活动相关任务时，绝大部分Task正常执行完，只有 1 个或者 2 个任务特别慢，甚至有的任务内存溢出！排查发现是数据倾斜问题</li> <li>A表为一个汇总表，汇总的是卖家买家最近N天交易汇总信息，即对于每个卖家最近N天，其每个买家共成交了多少单，总金额是多少，假设N取90天，汇总值仅取成交单数。
<ol><li>A表的字段有：buyer_id、seller_id、pay_cnt_90day。</li> <li>B表为卖家基本信息表，其字段有seller_id、sale_level，其中sale_levels是卖家的一个分层评级信息，比如吧卖家分为6个级别：S0、S1、S2、S3、S4和S5。</li> <li>要获得的结果是每个买家在各个级别的卖家的成交比例信息，比如：</li></ol></li></ol> <p>某买家：S0:10%；S1:20%；S2:20%；S3:10%；S4:20%；S5:10%。</p></li></ol> <p>问题2：</p> <p>问题SQL</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
　　m<span class="token punctuation">.</span>buyer_id<span class="token punctuation">,</span>
　　<span class="token function">sum</span><span class="token punctuation">(</span> pay_cnt_90day <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day<span class="token punctuation">,</span>
　　<span class="token function">sum</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> m<span class="token punctuation">.</span>sale_level <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">THEN</span> pay_cnt_90day <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day_s0<span class="token punctuation">,</span>
　　<span class="token function">sum</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> m<span class="token punctuation">.</span>sale_level <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">THEN</span> pay_cnt_90day <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day_s1<span class="token punctuation">,</span>
　　<span class="token function">sum</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> m<span class="token punctuation">.</span>sale_level <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">THEN</span> pay_cnt_90day <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day_s2<span class="token punctuation">,</span>
　　<span class="token function">sum</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> m<span class="token punctuation">.</span>sale_level <span class="token operator">=</span> <span class="token number">3</span> <span class="token keyword">THEN</span> pay_cnt_90day <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day_s3<span class="token punctuation">,</span>
　　<span class="token function">sum</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> m<span class="token punctuation">.</span>sale_level <span class="token operator">=</span> <span class="token number">4</span> <span class="token keyword">THEN</span> pay_cnt_90day <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day_s4<span class="token punctuation">,</span>
　　<span class="token function">sum</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> m<span class="token punctuation">.</span>sale_level <span class="token operator">=</span> <span class="token number">5</span> <span class="token keyword">THEN</span> pay_cnt_90day <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day_s5
<span class="token keyword">FROM</span>
<span class="token punctuation">(</span>
	<span class="token keyword">SELECT</span>
		a<span class="token punctuation">.</span>buer_id<span class="token punctuation">,</span>
		a<span class="token punctuation">.</span>seller_id<span class="token punctuation">,</span>
		b<span class="token punctuation">.</span>sale_level<span class="token punctuation">,</span>
		a<span class="token punctuation">.</span>pay_cnt_90day 
	<span class="token keyword">FROM</span>
		<span class="token punctuation">(</span> <span class="token keyword">SELECT</span> buyer_id<span class="token punctuation">,</span> seller_id<span class="token punctuation">,</span> pay_cnt_90day <span class="token keyword">FROM</span> table_A <span class="token punctuation">)</span> a
			<span class="token keyword">JOIN</span> 
		<span class="token punctuation">(</span> <span class="token keyword">SELECT</span> seller_id<span class="token punctuation">,</span> sale_level <span class="token keyword">FROM</span> table_B <span class="token punctuation">)</span> b 
			<span class="token keyword">ON</span> a<span class="token punctuation">.</span>seller_id <span class="token operator">=</span> b<span class="token punctuation">.</span>seller_id 
<span class="token punctuation">)</span> m
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span>
m<span class="token punctuation">.</span>buyer_id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><blockquote><p>​	此SQL会引起数据倾斜，原因在于卖家的二八准则，某些卖家90天内会有几百万甚至上千万的买家，但是大部分的卖家90天内买家的数目并不多，join table_A和table_B的时候，</p> <p>​	ODPS会按照seller_id进行分发，table_A的大卖家引起了数据倾斜。</p> <p>​	但是数据本身无法用mapjoin table_B解决，因为卖家超过千万条，文件大小有几个GB，超过了1GB的限制。</p></blockquote> <p>扩容 join：</p> <ol><li>通用方案</li></ol> <blockquote><p>建立一个numbers表，其值只有一列int 行，比如从1到10（具体值可根据倾斜程度确定），然后放大B表10倍，再取模join。代码如下：</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
	　m<span class="token punctuation">.</span>buyer_id<span class="token punctuation">,</span>
	　<span class="token function">sum</span><span class="token punctuation">(</span> pay_cnt_90day <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day<span class="token punctuation">,</span>
	　<span class="token function">sum</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> m<span class="token punctuation">.</span>sale_level <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">THEN</span> pay_cnt_90day <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day_s0<span class="token punctuation">,</span>
	　<span class="token function">sum</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> m<span class="token punctuation">.</span>sale_level <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">THEN</span> pay_cnt_90day <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day_s1<span class="token punctuation">,</span>
	　<span class="token function">sum</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> m<span class="token punctuation">.</span>sale_level <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">THEN</span> pay_cnt_90day <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day_s2<span class="token punctuation">,</span>
	　<span class="token function">sum</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> m<span class="token punctuation">.</span>sale_level <span class="token operator">=</span> <span class="token number">3</span> <span class="token keyword">THEN</span> pay_cnt_90day <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day_s3<span class="token punctuation">,</span>
	　<span class="token function">sum</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> m<span class="token punctuation">.</span>sale_level <span class="token operator">=</span> <span class="token number">4</span> <span class="token keyword">THEN</span> pay_cnt_90day <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day_s4<span class="token punctuation">,</span>
	　<span class="token function">sum</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> m<span class="token punctuation">.</span>sale_level <span class="token operator">=</span> <span class="token number">5</span> <span class="token keyword">THEN</span> pay_cnt_90day <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day_s5
<span class="token keyword">FROM</span>
	<span class="token punctuation">(</span>
		<span class="token keyword">SELECT</span>
		a<span class="token punctuation">.</span>buer_id<span class="token punctuation">,</span>
		a<span class="token punctuation">.</span>seller_id<span class="token punctuation">,</span>
		b<span class="token punctuation">.</span>sale_level<span class="token punctuation">,</span>
		a<span class="token punctuation">.</span>pay_cnt_90day
	<span class="token keyword">FROM</span>
		<span class="token punctuation">(</span> <span class="token keyword">SELECT</span> buyer_id<span class="token punctuation">,</span> seller_id<span class="token punctuation">,</span> pay_cnt_90day <span class="token keyword">FROM</span> table_A <span class="token punctuation">)</span> a
			<span class="token keyword">JOIN</span>
				<span class="token punctuation">(</span>
					<span class="token keyword">SELECT</span> <span class="token comment">/*+mapjoin(members)*/</span>seller_id<span class="token punctuation">,</span> sale_level<span class="token punctuation">,</span> member
					<span class="token keyword">FROM</span> table_B
					<span class="token keyword">JOIN</span> members
				<span class="token punctuation">)</span> b 
		<span class="token keyword">ON</span> a<span class="token punctuation">.</span>seller_id <span class="token operator">=</span> b<span class="token punctuation">.</span>seller_id
		<span class="token operator">AND</span> <span class="token function">MOD</span> <span class="token punctuation">(</span> a<span class="token punctuation">.</span>pay_cnt_90day<span class="token punctuation">,</span> <span class="token number">10</span> <span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">=</span> b<span class="token punctuation">.</span>number
		<span class="token punctuation">)</span> m
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span>
m<span class="token punctuation">.</span>buyer_id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><blockquote><p>mod(a, b) ：返回 a 除以 b 的余数</p> <p>​	此思路的核心在于，既然按照seller_id分发会倾斜，那么再人工增加一列进行分发，这样之前倾斜的值的倾斜程度会减少到原来的1/10，可以通过配置numbers表改放大倍数来降低倾斜程度，但这样做的一个弊端是B表也会膨胀N倍。</p></blockquote> <ol start="2"><li>专用方案</li></ol> <blockquote><p>通用方案的思路把B表的每条数据都放大了相同的倍数，实际上这是不需要的，只需要把大卖家放大倍数即可：需要首先知道大卖家的名单，即先建立一个临时表动态存放每天最新的大卖家（比如dim_big_seller）,同时此表的大卖家要膨胀预先设定的倍数（1000倍）。</p> <p>在A表和B表分别新建一个join列，其逻辑为：如果是大卖家，那么concat一个随机分配正整数（0到预定义的倍数之间，本例为0~1000）；如果不是，保持不变。</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
	m<span class="token punctuation">.</span>buyer_id<span class="token punctuation">,</span>
	<span class="token function">sum</span><span class="token punctuation">(</span> pay_cnt_90day <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day<span class="token punctuation">,</span>
	<span class="token function">sum</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> m<span class="token punctuation">.</span>sale_level <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">THEN</span> pay_cnt_90day <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day_s0<span class="token punctuation">,</span>
	<span class="token function">sum</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> m<span class="token punctuation">.</span>sale_level <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">THEN</span> pay_cnt_90day <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day_s1<span class="token punctuation">,</span>
	<span class="token function">sum</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> m<span class="token punctuation">.</span>sale_level <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">THEN</span> pay_cnt_90day <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day_s2<span class="token punctuation">,</span>
	<span class="token function">sum</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> m<span class="token punctuation">.</span>sale_level <span class="token operator">=</span> <span class="token number">3</span> <span class="token keyword">THEN</span> pay_cnt_90day <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day_s3<span class="token punctuation">,</span>
	<span class="token function">sum</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> m<span class="token punctuation">.</span>sale_level <span class="token operator">=</span> <span class="token number">4</span> <span class="token keyword">THEN</span> pay_cnt_90day <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day_s4<span class="token punctuation">,</span>
	<span class="token function">sum</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> m<span class="token punctuation">.</span>sale_level <span class="token operator">=</span> <span class="token number">5</span> <span class="token keyword">THEN</span> pay_cnt_90day <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day_s5 
<span class="token keyword">FROM</span>
	<span class="token punctuation">(</span>
	<span class="token keyword">SELECT</span>
		a<span class="token punctuation">.</span>buer_id<span class="token punctuation">,</span>
		a<span class="token punctuation">.</span>seller_id<span class="token punctuation">,</span>
		b<span class="token punctuation">.</span>sale_level<span class="token punctuation">,</span>
		a<span class="token punctuation">.</span>pay_cnt_90day 
	<span class="token keyword">FROM</span>
		<span class="token punctuation">(</span>
			<span class="token keyword">SELECT</span> <span class="token comment">/*+mapjoin(big)*/</span> buyer_id<span class="token punctuation">,</span> seller_id<span class="token punctuation">,</span> pay_cnt_90day<span class="token punctuation">,</span><span class="token keyword">IF</span><span class="token punctuation">(</span>big<span class="token punctuation">.</span>seller_id <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span>table_A<span class="token punctuation">.</span>seller_id<span class="token punctuation">,</span><span class="token string">'rnd'</span><span class="token punctuation">,</span>cast<span class="token punctuation">(</span> rand<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token keyword">AS</span> <span class="token keyword">BIGINT</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>table_A<span class="token punctuation">.</span>seller_id<span class="token punctuation">)</span> <span class="token keyword">AS</span> seller_id_joinkey 
			<span class="token keyword">FROM</span> table_A
			<span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> 
<span class="token comment">/*big表seller_id有重复，请注意一定要 GROUP BY 后再 JOIN,保证 table_A的行数保持不变*/</span>
			<span class="token punctuation">(</span><span class="token keyword">SELECT</span> seller_id <span class="token keyword">FROM</span> dim_big_seller <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> seller_id<span class="token punctuation">)</span>big
			<span class="token keyword">ON</span> table_A<span class="token punctuation">.</span>seller_id <span class="token operator">=</span> big<span class="token punctuation">.</span>seller_id
		<span class="token punctuation">)</span> a
		<span class="token keyword">JOIN</span> 
		<span class="token punctuation">(</span>
				<span class="token keyword">SELECT</span> <span class="token comment">/*+mapjoin(big)*/</span>seller_id<span class="token punctuation">,</span>sale_level<span class="token punctuation">,</span>
							<span class="token comment">/*big表的seller_id_joinkey生成逻辑和上面的生成逻辑一样*/</span>
							<span class="token keyword">COALESCE</span> <span class="token punctuation">(</span> seller_id_joinkey<span class="token punctuation">,</span> table_B<span class="token punctuation">.</span>seller_id <span class="token punctuation">)</span> <span class="token keyword">AS</span> seller_id_joinkey 　　　　<span class="token keyword">FROM</span> table_B
				<span class="token keyword">LEFT</span> <span class="token keyword">OUT</span> <span class="token keyword">JOIN</span>
				<span class="token comment">/*table_B表 JOIN大卖家表后大卖家行数扩大 1000倍,其它卖家行数保持不变*/</span>
				<span class="token punctuation">(</span><span class="token keyword">SELECT</span> seller_id<span class="token punctuation">,</span> seller_id_joinkey <span class="token keyword">FROM</span> dim_big_seller <span class="token punctuation">)</span> big 
				<span class="token keyword">ON</span> table_B<span class="token punctuation">.</span>seller_id <span class="token operator">=</span> big<span class="token punctuation">.</span>seller_id
		<span class="token punctuation">)</span> b 
		<span class="token keyword">ON</span> a<span class="token punctuation">.</span>seller_id_joinkey <span class="token operator">=</span> b<span class="token punctuation">.</span>seller_id_joinkey <span class="token operator">AND</span> <span class="token function">MOD</span> <span class="token punctuation">(</span> a<span class="token punctuation">.</span>pay_cnt_90day<span class="token punctuation">,</span> <span class="token number">10</span> <span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">=</span> b<span class="token punctuation">.</span>number
	<span class="token punctuation">)</span> m
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span>
m<span class="token punctuation">.</span>buyer_id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><blockquote><p>相比通用方案，专用方案的运行效率明细好了许多，因为只是将B表中大卖家的行数放大了1000倍，其它卖家的行数保持不变，但同时代码复杂了很多，而且必须首先建立大数据表。</p></blockquote> <ol start="3"><li>动态一分为二</li></ol> <blockquote><p>实际上方案2和3都用了一分为二的思想，但是都不彻底，对于mapjoin不能解决的问题，终极解决方案是动态一分为二，即对倾斜的键值和不倾斜的键值分开处理，不倾斜的正常join即可，倾斜的把他们找出来做mapjoin，最后union all其结果即可。</p> <p>但是此种解决方案比较麻烦，代码复杂而且需要一个临时表存放倾斜的键值。</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">/*由于数据倾斜,先找出 90天买家超过10000的卖家*/</span>
<span class="token keyword">INSERT</span> overwrite <span class="token keyword">TABLE</span> temp_table_B
<span class="token keyword">SELECT</span> m<span class="token punctuation">.</span>seller_id<span class="token punctuation">,</span> n<span class="token punctuation">.</span>sale_level
<span class="token keyword">FROM</span> <span class="token punctuation">(</span> <span class="token keyword">SELECT</span> seller_id <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> seller_id<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span>buyer_id<span class="token punctuation">)</span> <span class="token keyword">AS</span> byr_cnt <span class="token keyword">FROM</span> table_A <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> seller_id<span class="token punctuation">)</span> a <span class="token keyword">WHERE</span> a<span class="token punctuation">.</span>byr_cnt <span class="token operator">&gt;</span> <span class="token number">10000</span> <span class="token punctuation">)</span> m
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span> <span class="token keyword">SELECT</span> seller_id<span class="token punctuation">,</span> sale_level <span class="token keyword">FROM</span> table_B <span class="token punctuation">)</span> n <span class="token keyword">ON</span> m<span class="token punctuation">.</span>seller_id <span class="token operator">=</span> n<span class="token punctuation">.</span>seller_id<span class="token punctuation">;</span>
<span class="token comment">/*对于 90天买家超过10000的卖家直接 mapjoin,对其它卖家直接正常 JOIN即可。*/</span>
<span class="token keyword">SELECT</span>
　　m<span class="token punctuation">.</span>buyer_id<span class="token punctuation">,</span>
　　<span class="token function">sum</span><span class="token punctuation">(</span> pay_cnt_90day <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day<span class="token punctuation">,</span>
　　<span class="token function">sum</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> m<span class="token punctuation">.</span>sale_level <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">THEN</span> pay_cnt_90day <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day_s0<span class="token punctuation">,</span>
　　<span class="token function">sum</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> m<span class="token punctuation">.</span>sale_level <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">THEN</span> pay_cnt_90day <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day_s1<span class="token punctuation">,</span>
　　<span class="token function">sum</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> m<span class="token punctuation">.</span>sale_level <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">THEN</span> pay_cnt_90day <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day_s2<span class="token punctuation">,</span>
　　<span class="token function">sum</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> m<span class="token punctuation">.</span>sale_level <span class="token operator">=</span> <span class="token number">3</span> <span class="token keyword">THEN</span> pay_cnt_90day <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day_s3<span class="token punctuation">,</span>
　　<span class="token function">sum</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> m<span class="token punctuation">.</span>sale_level <span class="token operator">=</span> <span class="token number">4</span> <span class="token keyword">THEN</span> pay_cnt_90day <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day_s4<span class="token punctuation">,</span>
　　<span class="token function">sum</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> m<span class="token punctuation">.</span>sale_level <span class="token operator">=</span> <span class="token number">5</span> <span class="token keyword">THEN</span> pay_cnt_90day <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> pay_cnt_90day_s5
<span class="token keyword">FROM</span>
	<span class="token punctuation">(</span><span class="token keyword">SELECT</span>
		a<span class="token punctuation">.</span>buer_id<span class="token punctuation">,</span>
		a<span class="token punctuation">.</span>seller_id<span class="token punctuation">,</span>
		b<span class="token punctuation">.</span>sale_level<span class="token punctuation">,</span>
		a<span class="token punctuation">.</span>pay_cnt_90day
	 <span class="token keyword">FROM</span>
		<span class="token punctuation">(</span> <span class="token keyword">SELECT</span> buyer_id<span class="token punctuation">,</span> seller_id<span class="token punctuation">,</span> pay_cnt_90day <span class="token keyword">FROM</span> table_A <span class="token punctuation">)</span> a 
		  <span class="token keyword">JOIN</span>
			<span class="token punctuation">(</span> <span class="token keyword">SELECT</span> seller_id<span class="token punctuation">,</span> a<span class="token punctuation">.</span>sale_level <span class="token keyword">FROM</span> table_A a 
				<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> temp_table_B b <span class="token keyword">ON</span> a<span class="token punctuation">.</span>seller_id <span class="token operator">=</span> b<span class="token punctuation">.</span>seller_id
				<span class="token keyword">WHERE</span> b<span class="token punctuation">.</span>seller_id <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
		  <span class="token punctuation">)</span> b <span class="token keyword">ON</span> a<span class="token punctuation">.</span>seller_id <span class="token operator">=</span> b<span class="token punctuation">.</span>seller_id 
	 <span class="token keyword">UNION</span> <span class="token keyword">ALL</span> 
	 <span class="token keyword">SELECT</span> <span class="token comment">/*+mapjoin(b)*/</span> a<span class="token punctuation">.</span>buer_id<span class="token punctuation">,</span>a<span class="token punctuation">.</span>seller_id<span class="token punctuation">,</span> b<span class="token punctuation">.</span>sale_level<span class="token punctuation">,</span> a<span class="token punctuation">.</span>pay_cnt_90day
	 <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> buyer_id<span class="token punctuation">,</span> seller_id<span class="token punctuation">,</span> pay_cnt_90day <span class="token keyword">FROM</span> table_A <span class="token punctuation">)</span> a
	 <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> seller_id<span class="token punctuation">,</span> sale_level <span class="token keyword">FROM</span> table_B <span class="token punctuation">)</span> b <span class="token keyword">ON</span> a<span class="token punctuation">.</span>seller_id <span class="token operator">=</span> b<span class="token punctuation">.</span>seller_id
	<span class="token punctuation">)</span> m 
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span>
	m<span class="token punctuation">.</span>buyer_id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><blockquote><p><strong>总结：方案1、2以及方案3中的同用方案不能保证解决大表join大表问题，因为它们都存在种种不同的限制和特定使用场景。而方案3的专用方案和方案4是推荐的优化方案，但是它们都需要新建一个临时表来存储每日动态变化的大卖家。相对方案4来说，方案3的专用方案不需要对代码框架进行修改，但是B表会被放大，所以一定要是是维度表，不然统计结果会是错误的。方案4最通用，自由度最高，但是对代码的更改也最大，甚至修改更难代码框架，可以作为终极方案使用。</strong></p></blockquote></li></ol> <h3 id="_7-8-其他-hql"><a href="#_7-8-其他-hql" class="header-anchor">#</a> 7.8 其他（HQL）</h3> <p>unoin 与 union all 的区别</p> <ol><li>union会对两个子查询的结果去重合并</li> <li>union all 不会对子查询的结果去重处理</li></ol> <h2 id="_8-sqoop"><a href="#_8-sqoop" class="header-anchor">#</a> 8. Sqoop</h2> <blockquote><p>​	关系型数据库的数据与非关系型数据库中 (hdfs) 大量数据的迁移</p> <p>​	Sqoop是一个在结构化数据和Hadoop之间进行批量数据迁移的工具，结构化数据可以是MySQL、Oracle等RDBMS。Sqoop底层用MapReduce程序实现抽取、转换、加载，在翻译出的MapReduce 中主要是对InputFormat和OutputFormat进行定制。MapReduce天生的特性保证了并行化和高容错率。
  如果要用Sqoop，必须正确安装并配置Hadoop，因依赖于本地的Hadoop环境启动MR程序；MySQL、Oracle等数据库的JDBC驱动也要放到Sqoop的lib目录下。</p></blockquote> <h3 id="_8-1-原理"><a href="#_8-1-原理" class="header-anchor">#</a> 8.1 原理</h3> <h4 id="_8-1-1-数据导入"><a href="#_8-1-1-数据导入" class="header-anchor">#</a> 8.1.1 数据导入</h4> <ol><li>sqoop会通过jdbc来获取需要的数据库的元数据信息，例如：导入的表的列名，数据类型。</li> <li>这些数据库的数据类型会被映射成为java的数据类型，根据这些信息，sqoop会生成一个与表名相同的类用来完成序列化工作，保存表中的每一行记录。</li> <li>sqoop开启MapReduce作业</li> <li>启动的作业在input的过程中，会通过jdbc读取数据表中的内容，这时，会使用sqoop生成的类进行序列化。</li> <li>最后将这些记录写到hdfs上，在写入hdfs的过程中，同样会使用sqoop生成的类进行反序列化。</li></ol> <h4 id="_8-1-2-数据导出"><a href="#_8-1-2-数据导出" class="header-anchor">#</a> 8.1.2 数据导出</h4> <ol><li>首先sqoop通过jdbc访问关系型数据库获取需要导出的信息的元数据信息</li> <li>根据获取的元数据信息，sqoop生成一个Java类，用来承载数据的传输，该类必须实现序列化</li> <li>启动MapReduce程序</li> <li>sqoop利用生成的这个类，并行从hdfs中获取数据</li> <li>每个map作业都会根据读取到的导出表的元数据信息和读取到的数据，生成一批insert 语句，然后多个map作业会并行的向MySQL中插入数据。</li></ol> <h3 id="_8-2-遇到过哪些问题"><a href="#_8-2-遇到过哪些问题" class="header-anchor">#</a> 8.2 遇到过哪些问题</h3> <h4 id="_8-2-1-导入的坑"><a href="#_8-2-1-导入的坑" class="header-anchor">#</a> 8.2.1 导入的坑</h4> <p>问题1：mysql中的 NULL 导入到 hdfs 后变成 'null' 字符串</p> <p>解决：导入时加上参数 -null-string '\N'  -null-non-string '\N'</p> <p>在hive里面。NULL是用\N来表示的。你可以自己做个实验 insert overwrite table tb select NULL from tb1 limit 1;</p> <p>然后在去查看原文件就可以发现了。</p> <p>如果在导入后发现数据错位了，或者有好多原来有值的字段都变成了NULL, 这是因为你原表varchar类型的字段中可能含有\n\r等一些特殊字符。</p> <p>可以加上  –hive-drop-import-delims</p> <h3 id="_8-3-数据量"><a href="#_8-3-数据量" class="header-anchor">#</a> 8.3 数据量</h3> <h2 id="_9-azkaban"><a href="#_9-azkaban" class="header-anchor">#</a> 9. Azkaban</h2> <h2 id="_10-hbase"><a href="#_10-hbase" class="header-anchor">#</a> 10. HBase</h2> <h3 id="_10-1-架构"><a href="#_10-1-架构" class="header-anchor">#</a> 10.1 架构</h3> <ul><li>ZK、HDFS</li> <li>Master</li> <li>RegionServer：
<ul><li>Hlog（WAL）：预写日志，防止RegionServer故障，导致MemStore中的数据丢失</li> <li>Region：
<ul><li>Store：
<ul><li>memoryStore：写缓存，K-V在MemStore中排序，达到阈值才会Flush到StoreFile，每次Flush生成一个新的StoreFile</li> <li>storeFile：存储有序的K-V文件，存储在HDFS上，每个Store会有一个或多个StoreFile（HFile），数据在每个StoreFile中都是有序的。</li></ul></li></ul></li> <li>BlockCache：读缓存，每次新查询的数据会缓存在BlockCache中。</li></ul></li></ul> <h3 id="_10-2-数据流程"><a href="#_10-2-数据流程" class="header-anchor">#</a> 10.2 数据流程</h3> <blockquote><p>读比写慢</p></blockquote> <ol><li><p>写</p> <ol><li>Client先访问 zookeeper，获取 hbase:meta表位于哪个Region Server。</li> <li>访问对应的Region Server，获取hbase:meta表，根据写请求的namespace:table/rowkey，查询出目标数据位于哪个Region Server中的哪个 Region中。并将该 table 的 region 信息以及 meta 表的位置信息缓存在客户端的 meta cache，方便下次访问。</li> <li>与目标Region Server 进行通讯</li> <li>将数据顺序写入（追加）到 WAL</li> <li>将数据写入对应的 MemStore，数据会在 MemStore 进行排序</li> <li>向客户端发送 ack</li> <li>等达到 MemStore 的刷写时机后<strong>hbase.hregion.memstore.flush.size（默认值128M）</strong>,将数据刷写到 storeFile （HFile）。</li></ol></li> <li><p>读</p> <ol><li>Client先访问zookeeper，获取 hbase:meta表位于哪个Region Server。</li> <li>访问对应的 Region Server，获取 hbase:meta 表，根据读请求的 namespace:table/rowkey，查询出目标数据位于哪个 Region Server中的哪个 Region 中。并将该 table 的 region 信息以及 meta 表的位置信息缓存在客户端的 meta cache，方便下次访问。</li> <li>与目标 Region Server进行通讯</li> <li>分别在 MemStore 和 Store File（HFile）中查询目标数据，并将查到的所有数据进行合并。此处所有数据是指同一条数据的不同版本（timestamp）或者不同的类型（Pub/Delete）</li> <li>将查询到的新的数据块（Block，HFile数据存储单元，默认大小为 64 KB）缓存到 Block Cache。</li> <li>将合并后的最终结果返回给客户端</li></ol></li> <li><p>刷写</p> <ol><li>regionserver：堆内存  0.4*0.95 = 0.38</li> <li>region：memstore  128M</li> <li>时间：1h (默认)  lastEdit</li></ol> <blockquote><p>MemStore刷写时机：</p> <ol><li><p>region ：当某个memstroe的大小达到了hbase.hregion.memstore.flush.size（默认值128M），其所在region的所有memstore都会刷写。</p> <p>当memstore的大小达到了
hbase.hregion.memstore.flush.size（默认值128M）</p> <p>hbase.hregion.memstore.block.multiplier（默认值4）
时，会阻止继续往该memstore写数据。</p></li> <li><p>当region server中memstore的总大小达到</p> <p><code>java_heapsize * hbase.regionserver.global.memstore.size（默认值0.4）* hbase.regionserver.global.memstore.size.lower.limit（默认值0.95）</code></p> <p>region会按照其所有memstore的大小顺序（由大到小）依次进行刷写。直到region server中所有memstore的总大小减小到上述值以下。</p> <p>当region 中memstore的总大小达到
<code>java_heapsize * hbase.regionserver.global.memstore.size（默认值0.4）</code>
时，会阻止继续往所有的memstore写数据。</p></li> <li><p>到达自动刷写的时间，也会触发memstore flush。自动刷新的时间间隔由该属性进行配置hbase.regionserver.optionalcacheflushinterval（默认1小时）。</p></li> <li><p>当WAL文件的数量超过hbase.regionserver.max.logs，region会按照时间顺序依次进行刷写，直到WAL文件数量减小到hbase.regionserver.max.log以下（该属性名已经废弃，现无需手动设置，最大值为32）。</p></li></ol></blockquote></li> <li><p>合并（StoreFile Compaction）</p> <ol><li>由于 memstore 每次刷写都会生成一个新的 HFile，且同一个字段的不同版本 (timestamp) 和不同类型(Put/Delete) 有可能会分布在不同的 HFile 中，因此查询时需要遍历所有的 HFile。为了减少 HFile 的个数，以及清理掉过期和删除的数据，会进行 StoreFile Compaction。</li> <li>Compaction 分为两种，分别是 Minor Compaction 和 Major Compaction。
<ol><li>Minor Compaction 会将临近的若干个较小的 HFile 合并成一个较大的 HFile，并清理掉部分过期和删除的数据。</li> <li>Major Compaction 会将一个 Store 下的所有的 HFile 合并成一个大 HFile，并且会清理掉所有过期和删除的数据。</li></ol></li></ol></li> <li><p>切分（Region Split）</p> <ol><li>默认情况下，每个Table起初只有一个Region，随着数据的不断写入，Region会自动进行拆分。刚拆分时，两个子Region都位于当前的Region Server，但处于负载均衡的考虑，HMaster有可能会将某个Region转移给其他的Region Server。</li> <li>时机：
<ol><li>当1个region中的某个Store下所有StoreFile的总大小超过hbase.hregion.max.filesize （10G），该Region就会进行拆分（0.94版本之前）</li> <li>当1个region中的某个Store下所有StoreFile的总大小超过Min(initialSize<em>R^3 ,hbase.hregion.max.filesize&quot;)，该Region就会进行拆分。其中initialSize的默认值为2</em>hbase.hregion.memstore.flush.size，R为当前Region Server中属于该Table的Region个数（0.94版本之后）</li> <li>具体的切分策略为：
第一次split：1^3 * 256 = 256MB
第二次split：2^3 * 256 = 2048MB
第三次split：3^3 * 256 = 6912MB
第四次split：4^3 * 256 = 16384MB &gt; 10GB，因此取较小的值10GB
后面每次split的size都是10GB了。</li> <li>Hbase 2.0引入了新的split策略：如果当前RegionServer上该表只有一个Region，按照2 * hbase.hregion.memstore.flush.size分裂，否则按照hbase.hregion.max.filesize分裂。</li></ol></li></ol></li></ol> <h3 id="_10-3-rowkey-设计"><a href="#_10-3-rowkey-设计" class="header-anchor">#</a> 10.3 RowKey 设计</h3> <blockquote><p>​	一条数据的唯一标识就是rowkey，那么这条数据存储于哪个分区，取决于rowkey处于哪个一个预分区的区间内，设计rowkey的主要目的 ，就是让数据均匀的分布于所有的region中，在一定程度上防止数据倾斜。接下来我们就谈一谈rowkey常用的设计方案。</p></blockquote> <ul><li>生成随机数、hash、散列值</li> <li>字符串反转</li> <li>字符串拼接</li></ul> <h3 id="_10-4-二级索引"><a href="#_10-4-二级索引" class="header-anchor">#</a> 10.4 二级索引</h3> <blockquote><p>一级索引：RowKey</p></blockquote> <p>原理：协处理器（Coprecessor）</p> <ol><li>二级索引配置文件</li></ol> <p>添加如下配置到 HBase 的 HRegionserver 节点的 hbase-site.xml</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- phoenix regionserver 配置参数--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hbase.regionserver.wal.codec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop.hbase.regionserver.wal.IndexedWALEditCodec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="2"><li><p>全局索引（global index）</p></li> <li><p>使用场景：读多写少</p></li></ol> <blockquote><p>Global Index是默认的索引格式，创建全局索引时，会在HBase中建立一张新表。也就是说索引数据和数据表是存放在不同的表中的。</p> <div class="language- extra-class"><pre><code>写数据的时候会消耗大量开销，因为索引表也要更新，而索引表是分布在不同的数据节点上的，跨节点的数据传输带来了较大的性能消耗。
</code></pre></div><p>​	在读数据的时候Phoenix会选择索引表来降低查询消耗的时间。</p></blockquote> <p>创建单字段全局索引：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> my_index <span class="token keyword">ON</span> my_table <span class="token punctuation">(</span>my_col<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">index</span> B <span class="token keyword">ON</span> A<span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 以上索引对下面查询不生效，因为索引必须包含所有列</span>
<span class="token keyword">select</span> id<span class="token punctuation">,</span>age<span class="token punctuation">,</span>name <span class="token keyword">from</span> A <span class="token keyword">where</span> age <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">;</span> 
<span class="token keyword">create</span> <span class="token keyword">index</span> B <span class="token keyword">ON</span> A<span class="token punctuation">(</span>age<span class="token punctuation">)</span> include <span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="3"><li>本地索引：直接将索引数据保存在原表中（原Region）
<ol><li>使用场景：写多读少</li></ol></li></ol> <h2 id="_11-spark"><a href="#_11-spark" class="header-anchor">#</a> 11. Spark</h2> <h3 id="_11-1-入门"><a href="#_11-1-入门" class="header-anchor">#</a> 11.1 入门</h3> <ol><li>端口号
<ol><li>Yarn   8032   8088   10020   19888   18080(Spark)</li> <li>7077  8080  4040</li></ol></li> <li>提交方式，参数，流程
<ol><li>Yark-Cluster</li></ol></li> <li>WordCount
<ol><li>sc.textFile(&quot;&quot;)</li> <li>.flatMap(_.split(&quot;&quot;))</li> <li>.map((_,1))</li> <li><code>.reduceByKey(_+_)</code></li> <li>.saveAsTextFile(&quot; &quot;)</li></ol></li></ol> <h3 id="_11-2-sparkcore-rdd"><a href="#_11-2-sparkcore-rdd" class="header-anchor">#</a> 11.2 SparkCore     RDD</h3> <ol><li>五大属性
<ol><li>一个分区列表</li> <li>对于每个切片有一个计算函数</li> <li>与其他RDD的依赖关系</li> <li>分区器 (非必须)</li> <li>优先计算位置     宁愿移动计算不愿移动数据</li></ol></li> <li>算子(面试问法)
<ol><li>直接法
<ol><li>常用的转换算子、行动算子、带有Shuffle操作的算子</li></ol></li> <li>比较法
<ol><li>map    mapPartitions</li> <li>groupByKey     reduceByKey</li> <li>aggregate    aggregateByKey</li></ol></li> <li>计算结果</li></ol></li> <li>任务切分(依赖关系)
<ol><li>宽依赖(shuffle)    窄依赖</li> <li>Application    SparkContext</li> <li>Job    行动算子</li> <li>Stage    宽依赖</li> <li>Task    当前Stage最后一个RDD的分区数</li></ol></li> <li>持久化
<ol><li>Cache    Checkpoint</li> <li>使用场景：
<ol><li>RDD的复用</li> <li>当任务联很长且中间有一个Shuffle操作，在Shuffle之后进行持久化</li></ol></li> <li>使用方式：结合使用</li></ol></li> <li>序列化    Kryo</li> <li>共享变量
<ol><li>累加器			共享写操作</li> <li>广播变量      共享读操作</li> <li>变量过大，借用第三方框架</li></ol></li></ol> <h3 id="_11-3-sparksql-df、ds"><a href="#_11-3-sparksql-df、ds" class="header-anchor">#</a> 11.3 SparkSQL     DF、DS</h3> <p><strong>SQL</strong>	读写数据    SparkSession		DF、DS</p> <p>默认文件格式：Parquet</p> <p>读：</p> <p>SparkSession.read.json(&quot;&quot;)</p> <p>SparkSession.read.format(&quot;json&quot;).load(&quot;&quot;)</p> <p>SparkSession.read[.format(&quot;parquet&quot;)].load(&quot;&quot;)：默认格式</p> <p>写：</p> <p>df.write().json(&quot;&quot;)</p> <p>df.write().format(&quot;json&quot;).save(&quot;&quot;)</p> <p>df.write()[.format(&quot;parquet&quot;)].save(&quot;&quot;)</p> <p>转换：</p> <p>RDD &lt;=&gt; DF &lt;=&gt; DS      区别于互相转换</p> <h3 id="_11-4-sparkstreamingdstream"><a href="#_11-4-sparkstreamingdstream" class="header-anchor">#</a> 11.4 SparkStreaming		DStream</h3> <ol><li><p>反压     背压</p></li> <li><p>读取 Kafka 数据的方式</p> <ol><li>Receiver</li> <li>Direct</li></ol></li> <li><p>有状态的算子：updateStateByKey()  不推荐使用</p></li> <li><p>优雅的关闭</p> <ol><li>Yarn模式：yarn命令  kill</li> <li>监控外部系统</li></ol></li> <li><p>开窗</p> <ol><li>滑动窗口：窗口大小，滑动步长；两者必须是批次大小的整数倍</li></ol></li> <li><p>写库操作</p> <p><code>foreachRDD(rdd-&gt; {</code></p> <p>​	<code>rdd.foreachPartition(iter -&gt; {</code></p> <p>​		<code>// 1.获取连接</code></p> <p>​		<code>// 2.写出数据</code></p> <p>​		<code>iter.foreach(line -&gt; {</code></p> <p>​			<code>TODO 使用连接</code></p> <p>​			<code>// 3.释放连接</code></p> <p>​		<code>})</code></p> <p>​	<code>})</code></p> <p><code>})</code></p></li></ol> <h3 id="_11-5-内核"><a href="#_11-5-内核" class="header-anchor">#</a> 11.5 内核</h3> <p>​	内核文档  第 0 章  PPT</p> <h3 id="_11-6-优化"><a href="#_11-6-优化" class="header-anchor">#</a> 11.6 优化</h3> <h3 id="_11-7-shuffle"><a href="#_11-7-shuffle" class="header-anchor">#</a> 11.7 shuffle</h3> <blockquote><p>Spark的Shuffle有 Hash Shuffle和 Sort Shuffle两种。</p></blockquote> <p>在 Spark 1.2 以前，默认的 shuffle 计算引擎是 HashShuffleManager。</p> <p>​	HashShuffleManager有着一个非常严重的弊端，就是会产生大量的中间磁盘文件，进而由大量的磁盘IO操作影响了性能。因此在 Spark 1.2 以后的版本中，默认的 ShuffleManager 改成了 SortShuffleManager。</p> <p>​	SortShuffleManager相较于前者来说，有了一定的改进。主要就在于，每个 Task 在进行Shuffle操作时，虽然也会产生较多的临时磁盘文件，但是最后会将所有的临时文件合并 (merge) 成一个磁盘文件，因此每个 Task 就只有一个磁盘文件。在下一个 stage 的 shuffle read task 拉取自己的数据时，只要根据索引读取每个磁盘文件中的部分数据即可。</p> <h2 id="_12-flink"><a href="#_12-flink" class="header-anchor">#</a> 12. Flink</h2> <h3 id="_12-1-flink与sparkstreaming之间的区别"><a href="#_12-1-flink与sparkstreaming之间的区别" class="header-anchor">#</a> 12.1 Flink与SparkStreaming之间的区别</h3> <p>本质上：Flink基于事件触发的计算，真正意义上的流式计算框架；SparkStreaming基于时间触发的计算，微批次的计算框架。</p> <p>状态：Flink有状态的计算框架</p> <p>CheckPoint：Flink只存储状态数据，SparkStreaming存储计算逻辑</p> <p><code>StreamingContext.getActiveOrCreate(()=&gt;StreamingContext, &quot;ck路径&quot;)</code></p> <p>时间语义：Flink有事件时间</p> <p>窗口：Flink窗口种类更多</p> <p>StreamingContext优点：微批次，吞吐量大</p> <h3 id="_12-2-提交方式"><a href="#_12-2-提交方式" class="header-anchor">#</a> 12.2 提交方式</h3> <p>Yarn-per-job模式，脚本提交</p> <p>任务链：合并不同算子的 subTask，合并成一个 subTask</p> <p>​	要求： one-to-one、并行度相同、共享组相同</p> <p>Slot 共享组：没有指定其他共享组，所有算子均为“default”组，所需的 Slot 数量为最大并行度指定有不同共享组，任务所需的Slot数量为各组最大并行度之和</p> <h3 id="_12-3-算子"><a href="#_12-3-算子" class="header-anchor">#</a> 12.3 算子</h3> <ol><li><p>分层</p> <ol><li>TableAPI/FlinkSQL</li> <li>DataStream
<ol><li>基础函数：</li> <li>富函数：运行时上下文(状态编程)、生命周期方法</li></ol></li> <li>ProcessAPI：侧输出流、定时器(窗口函数不能定义定时器)</li></ol> <p>基本算子：Map、faltMap、filter</p> <p>聚合算子：sum、max、maxBy、min、minBy、reduce</p></li> <li><p>重分区</p> <p>keyBy    shuffle    Rebalance    rescale    global   broadcast   forward</p></li></ol> <h3 id="_12-4-窗口"><a href="#_12-4-窗口" class="header-anchor">#</a> 12.4 窗口*</h3> <ol><li>时间语义
<ol><li>处理时间</li> <li>进入系统时间</li> <li>事件时间：WaterMark
<ol><li>本质：在流中传输一种特殊的数据，时间戳</li> <li>作用：处理乱序数据</li> <li>如何产生作用：通过延迟关窗实现</li> <li>生成：周期性、断点式</li> <li>传递：广播传递、比上一次WM大才会向下游发送，下游的WM取决于上游最小的WM</li></ol></li></ol></li> <li>窗口的分类
<ol><li>事件个数
<ol><li>滚动</li> <li>滑动</li></ol></li> <li>时间
<ol><li>滚动</li> <li>滑动</li> <li>会话</li></ol></li></ol></li></ol> <h3 id="_12-5-状态编程"><a href="#_12-5-状态编程" class="header-anchor">#</a> 12.5 状态编程*</h3> <ol><li><p>种类</p> <ol><li>Raw</li> <li>Managered
<ol><li>算子状态
<ol><li>List、BroadCase、UnionList</li></ol></li> <li>键控状态
<ol><li>Value、List、Map、Reduce、Aggregate</li></ol></li></ol></li></ol></li> <li><p>用法</p> <ol><li>运行时上下文</li> <li>增删改查</li> <li>TTL</li></ol></li> <li><p>状态后端</p> <ol><li><p>种类</p> <ol><li>Memory</li> <li>FS</li> <li>RocksDB</li></ol></li> <li><p>CheckPoint一致性</p> <p>分布式快照算法：必须是在所有的任务处理完同一条数据之后保存状态</p></li> <li><p>端到端的一致性</p> <p>整个流的一致性取决于最弱环节</p></li> <li><p>两阶段提交</p></li></ol></li></ol> <h3 id="_12-6-cep"><a href="#_12-6-cep" class="header-anchor">#</a> 12.6 CEP</h3> <ol><li><p>定义模式序列</p> <ol><li><p>单例模式：单个、循环</p> <p>判断条件</p></li> <li><p>模式序列：严格近邻、宽松近邻、非确定性宽松近邻</p></li> <li><p>within()：限定匹配时间</p></li></ol></li> <li><p>将模式序列作用到流上</p></li> <li><p>提取事件(超时事件 --&gt;  侧输出流)</p></li></ol> <h3 id="_12-7-flinksql-tableapi"><a href="#_12-7-flinksql-tableapi" class="header-anchor">#</a> 12.7 FlinkSQL&amp;TableAPI</h3> <p>事件时间的提取、开窗</p> <p>UDF、UDAF、UDTF、UDATF(不能在FlinkSQL中使用)</p> <h2 id="_13-0-1"><a href="#_13-0-1" class="header-anchor">#</a> 13. 0 -&gt; 1</h2> <h2 id="_14-实时"><a href="#_14-实时" class="header-anchor">#</a> 14. 实时</h2> <h3 id="_14-1-ods-原始数据"><a href="#_14-1-ods-原始数据" class="header-anchor">#</a> 14.1 ODS (原始数据)</h3> <ol><li><p>行为数据：Flume  -&gt;  Kafka(Pulsar)</p></li> <li><p>业务数据：FlinkCDC</p> <table><thead><tr><th>FlinkCDC</th> <th>MaxWell</th> <th>Canal</th></tr></thead> <tbody><tr><td>初始化(多库多表)</td> <td>初始化(单表)</td> <td></td></tr> <tr><td>自定义反序列化方式(单条)</td> <td>JSON(单条)</td> <td>JSON(单条SQL)</td></tr></tbody></table></li></ol> <p>FlinkCDC2.x 在初始化阶段可以不加锁，同时可以多并行度读取数据</p> <h3 id="_14-2-dwd-数据分流-状态识别"><a href="#_14-2-dwd-数据分流-状态识别" class="header-anchor">#</a> 14.2 DWD (数据分流/状态识别)</h3> <ol><li><p>行为数据：</p> <p>新老用户校验；</p> <p>分流，使用侧输出流</p></li> <li><p>业务数据：动态分流</p> <p>FlinkCDC、广播流、自定义 PhoenixSink、自定义Kafka序列化器</p> <p>HBase：查询明细数据	行存	RowKey设计</p></li></ol> <h3 id="_14-3-dwm"><a href="#_14-3-dwm" class="header-anchor">#</a> 14.3 DWM</h3> <p>​	日活明细：状态编程  +  状态的TTL</p> <p>​	跳出明细：CEP</p> <p>​	订单宽表：双流 join、关联维度表、旁路缓存、异步IO</p> <p>​	支付宽表：双流 join</p> <h3 id="_14-4-dws"><a href="#_14-4-dws" class="header-anchor">#</a> 14.4 DWS</h3> <p>​	访客主题：UNION</p> <p>​	商品主题：构造者设计模式、订单ID去重、关联维度表</p> <p>​	地区主题：FlinkSQL</p> <p>​	关键词主题：FlinkSQL</p></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">6 months ago</span></div></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-70334359><li class="level-2" data-v-70334359><a href="/blogs/BD_PRO/All.html#_1-linux命令" class="sidebar-link reco-side-_1-linux命令" data-v-70334359>1. Linux命令</a></li><li class="level-2" data-v-70334359><a href="/blogs/BD_PRO/All.html#_2-shell" class="sidebar-link reco-side-_2-shell" data-v-70334359>2. Shell</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_2-1-群启-关脚本" class="sidebar-link reco-side-_2-1-群启-关脚本" data-v-70334359>2.1 群启/关脚本</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_2-2-分发脚本" class="sidebar-link reco-side-_2-2-分发脚本" data-v-70334359>2.2 分发脚本</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_2-3-sqoop脚本" class="sidebar-link reco-side-_2-3-sqoop脚本" data-v-70334359>2.3 Sqoop脚本</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_2-4-ods-dwd-dws-dwt" class="sidebar-link reco-side-_2-4-ods-dwd-dws-dwt" data-v-70334359>2.4 ods -&gt; dwd -&gt; dws -&gt; dwt</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_2-5-和-的区别-嵌套时看最外层" class="sidebar-link reco-side-_2-5-和-的区别-嵌套时看最外层" data-v-70334359>2.5 '' 和 &quot;&quot; 的区别，嵌套时看最外层</a></li><li class="level-2" data-v-70334359><a href="/blogs/BD_PRO/All.html#_3-hadoop" class="sidebar-link reco-side-_3-hadoop" data-v-70334359>3. Hadoop</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_3-1-入门" class="sidebar-link reco-side-_3-1-入门" data-v-70334359>3.1 入门</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_3-2-hdfs" class="sidebar-link reco-side-_3-2-hdfs" data-v-70334359>3.2 HDFS</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_3-3-mr" class="sidebar-link reco-side-_3-3-mr" data-v-70334359>3.3 MR</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_3-4-yarn" class="sidebar-link reco-side-_3-4-yarn" data-v-70334359>3.4 Yarn</a></li><li class="level-2" data-v-70334359><a href="/blogs/BD_PRO/All.html#_4-zookeeper" class="sidebar-link reco-side-_4-zookeeper" data-v-70334359>4. Zookeeper</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_4-1-选举机制" class="sidebar-link reco-side-_4-1-选举机制" data-v-70334359>4.1 选举机制</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_4-2-机器台数" class="sidebar-link reco-side-_4-2-机器台数" data-v-70334359>4.2 机器台数</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_4-3-常用命令" class="sidebar-link reco-side-_4-3-常用命令" data-v-70334359>4.3 常用命令</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_4-4-zk的cap" class="sidebar-link reco-side-_4-4-zk的cap" data-v-70334359>4.4 Zk的CAP</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_4-5-zk脑裂" class="sidebar-link reco-side-_4-5-zk脑裂" data-v-70334359>4.5 Zk脑裂</a></li><li class="level-2" data-v-70334359><a href="/blogs/BD_PRO/All.html#_5-flume" class="sidebar-link reco-side-_5-flume" data-v-70334359>5. Flume</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_5-1-基本组成" class="sidebar-link reco-side-_5-1-基本组成" data-v-70334359>5.1 基本组成</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_5-2-三个器-一个组" class="sidebar-link reco-side-_5-2-三个器-一个组" data-v-70334359>5.2 三个器 + 一个组</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_5-3-数据丢失" class="sidebar-link reco-side-_5-3-数据丢失" data-v-70334359>5.3 数据丢失</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_5-4-优化" class="sidebar-link reco-side-_5-4-优化" data-v-70334359>5.4 优化</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_5-5-taildir底层原理" class="sidebar-link reco-side-_5-5-taildir底层原理" data-v-70334359>5.5 taildir底层原理</a></li><li class="level-2" data-v-70334359><a href="/blogs/BD_PRO/All.html#_6-kafka" class="sidebar-link reco-side-_6-kafka" data-v-70334359>6. Kafka*</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_6-1-组成" class="sidebar-link reco-side-_6-1-组成" data-v-70334359>6.1 组成</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_6-2-挂了" class="sidebar-link reco-side-_6-2-挂了" data-v-70334359>6.2 挂了</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_6-3-丢了" class="sidebar-link reco-side-_6-3-丢了" data-v-70334359>6.3 丢了</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_6-4-重复了" class="sidebar-link reco-side-_6-4-重复了" data-v-70334359>6.4 重复了</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_6-5-积压了" class="sidebar-link reco-side-_6-5-积压了" data-v-70334359>6.5 积压了</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_6-6-优化" class="sidebar-link reco-side-_6-6-优化" data-v-70334359>6.6 优化</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_6-7-其他" class="sidebar-link reco-side-_6-7-其他" data-v-70334359>6.7 其他</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_6-8-面试题" class="sidebar-link reco-side-_6-8-面试题" data-v-70334359>6.8 面试题</a></li><li class="level-2" data-v-70334359><a href="/blogs/BD_PRO/All.html#_7-hive" class="sidebar-link reco-side-_7-hive" data-v-70334359>7. Hive*</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_7-1-组成-架构-hql翻译成mr的过程" class="sidebar-link reco-side-_7-1-组成-架构-hql翻译成mr的过程" data-v-70334359>7.1 组成/架构&amp;HQL翻译成MR的过程</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_7-2-与mysql区别" class="sidebar-link reco-side-_7-2-与mysql区别" data-v-70334359>7.2 与MySQL区别</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_7-3-内外部表的区别" class="sidebar-link reco-side-_7-3-内外部表的区别" data-v-70334359>7.3 内外部表的区别</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_7-4-4个by对比" class="sidebar-link reco-side-_7-4-4个by对比" data-v-70334359>7.4 4个By对比</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_7-5-函数" class="sidebar-link reco-side-_7-5-函数" data-v-70334359>7.5 函数</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_7-6-优化" class="sidebar-link reco-side-_7-6-优化" data-v-70334359>7.6 优化</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_7-7-数据倾斜-重点" class="sidebar-link reco-side-_7-7-数据倾斜-重点" data-v-70334359>7.7 数据倾斜（重点）</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_7-8-其他-hql" class="sidebar-link reco-side-_7-8-其他-hql" data-v-70334359>7.8 其他（HQL）</a></li><li class="level-2" data-v-70334359><a href="/blogs/BD_PRO/All.html#_8-sqoop" class="sidebar-link reco-side-_8-sqoop" data-v-70334359>8. Sqoop</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_8-1-原理" class="sidebar-link reco-side-_8-1-原理" data-v-70334359>8.1 原理</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_8-2-遇到过哪些问题" class="sidebar-link reco-side-_8-2-遇到过哪些问题" data-v-70334359>8.2 遇到过哪些问题</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_8-3-数据量" class="sidebar-link reco-side-_8-3-数据量" data-v-70334359>8.3 数据量</a></li><li class="level-2" data-v-70334359><a href="/blogs/BD_PRO/All.html#_9-azkaban" class="sidebar-link reco-side-_9-azkaban" data-v-70334359>9. Azkaban</a></li><li class="level-2" data-v-70334359><a href="/blogs/BD_PRO/All.html#_10-hbase" class="sidebar-link reco-side-_10-hbase" data-v-70334359>10. HBase</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_10-1-架构" class="sidebar-link reco-side-_10-1-架构" data-v-70334359>10.1 架构</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_10-2-数据流程" class="sidebar-link reco-side-_10-2-数据流程" data-v-70334359>10.2 数据流程</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_10-3-rowkey-设计" class="sidebar-link reco-side-_10-3-rowkey-设计" data-v-70334359>10.3 RowKey 设计</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_10-4-二级索引" class="sidebar-link reco-side-_10-4-二级索引" data-v-70334359>10.4 二级索引</a></li><li class="level-2" data-v-70334359><a href="/blogs/BD_PRO/All.html#_11-spark" class="sidebar-link reco-side-_11-spark" data-v-70334359>11. Spark</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_11-1-入门" class="sidebar-link reco-side-_11-1-入门" data-v-70334359>11.1 入门</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_11-2-sparkcore-rdd" class="sidebar-link reco-side-_11-2-sparkcore-rdd" data-v-70334359>11.2 SparkCore     RDD</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_11-3-sparksql-df、ds" class="sidebar-link reco-side-_11-3-sparksql-df、ds" data-v-70334359>11.3 SparkSQL     DF、DS</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_11-4-sparkstreamingdstream" class="sidebar-link reco-side-_11-4-sparkstreamingdstream" data-v-70334359>11.4 SparkStreaming		DStream</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_11-5-内核" class="sidebar-link reco-side-_11-5-内核" data-v-70334359>11.5 内核</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_11-6-优化" class="sidebar-link reco-side-_11-6-优化" data-v-70334359>11.6 优化</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_11-7-shuffle" class="sidebar-link reco-side-_11-7-shuffle" data-v-70334359>11.7 shuffle</a></li><li class="level-2" data-v-70334359><a href="/blogs/BD_PRO/All.html#_12-flink" class="sidebar-link reco-side-_12-flink" data-v-70334359>12. Flink</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_12-1-flink与sparkstreaming之间的区别" class="sidebar-link reco-side-_12-1-flink与sparkstreaming之间的区别" data-v-70334359>12.1 Flink与SparkStreaming之间的区别</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_12-2-提交方式" class="sidebar-link reco-side-_12-2-提交方式" data-v-70334359>12.2 提交方式</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_12-3-算子" class="sidebar-link reco-side-_12-3-算子" data-v-70334359>12.3 算子</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_12-4-窗口" class="sidebar-link reco-side-_12-4-窗口" data-v-70334359>12.4 窗口*</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_12-5-状态编程" class="sidebar-link reco-side-_12-5-状态编程" data-v-70334359>12.5 状态编程*</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_12-6-cep" class="sidebar-link reco-side-_12-6-cep" data-v-70334359>12.6 CEP</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_12-7-flinksql-tableapi" class="sidebar-link reco-side-_12-7-flinksql-tableapi" data-v-70334359>12.7 FlinkSQL&amp;TableAPI</a></li><li class="level-2" data-v-70334359><a href="/blogs/BD_PRO/All.html#_13-0-1" class="sidebar-link reco-side-_13-0-1" data-v-70334359>13. 0 -&gt; 1</a></li><li class="level-2" data-v-70334359><a href="/blogs/BD_PRO/All.html#_14-实时" class="sidebar-link reco-side-_14-实时" data-v-70334359>14. 实时</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_14-1-ods-原始数据" class="sidebar-link reco-side-_14-1-ods-原始数据" data-v-70334359>14.1 ODS (原始数据)</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_14-2-dwd-数据分流-状态识别" class="sidebar-link reco-side-_14-2-dwd-数据分流-状态识别" data-v-70334359>14.2 DWD (数据分流/状态识别)</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_14-3-dwm" class="sidebar-link reco-side-_14-3-dwm" data-v-70334359>14.3 DWM</a></li><li class="level-3" data-v-70334359><a href="/blogs/BD_PRO/All.html#_14-4-dws" class="sidebar-link reco-side-_14-4-dws" data-v-70334359>14.4 DWS</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div></div><APlayer audio="" fixed="true" mini="true" theme="#f9bcdd" loop="loop" order="random" preload="auto" volume="0.3" mutex="true" lrc-type="0" list-folded="true" list-max-height="250" storage-name="vuepress-plugin-meting" id="aplayer-fixed"></APlayer></div></div>
    <script src="/assets/js/app.03646987.js" defer></script><script src="/assets/js/3.a8134f0a.js" defer></script><script src="/assets/js/1.a394b090.js" defer></script><script src="/assets/js/11.38bfbf06.js" defer></script>
  </body>
</html>
