<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>实时数仓-ClickHouse | Awaken&#39;s blogs</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/wtw.jpg">
    <meta name="description" content="Awaken's blogs">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.dfeb017d.css" as="style"><link rel="preload" href="/assets/js/app.03646987.js" as="script"><link rel="preload" href="/assets/js/3.a8134f0a.js" as="script"><link rel="preload" href="/assets/js/1.a394b090.js" as="script"><link rel="preload" href="/assets/js/38.ef496ae1.js" as="script"><link rel="prefetch" href="/assets/js/10.0aed174e.js"><link rel="prefetch" href="/assets/js/100.02914097.js"><link rel="prefetch" href="/assets/js/101.95f6c81a.js"><link rel="prefetch" href="/assets/js/102.48df0133.js"><link rel="prefetch" href="/assets/js/103.200f5642.js"><link rel="prefetch" href="/assets/js/104.080c910a.js"><link rel="prefetch" href="/assets/js/105.943605b5.js"><link rel="prefetch" href="/assets/js/106.55d2b7c0.js"><link rel="prefetch" href="/assets/js/107.dbf3105f.js"><link rel="prefetch" href="/assets/js/108.3a747b28.js"><link rel="prefetch" href="/assets/js/109.e9453b81.js"><link rel="prefetch" href="/assets/js/11.38bfbf06.js"><link rel="prefetch" href="/assets/js/110.15ce5269.js"><link rel="prefetch" href="/assets/js/111.e2a2b309.js"><link rel="prefetch" href="/assets/js/112.83e22ec5.js"><link rel="prefetch" href="/assets/js/113.4c53e21e.js"><link rel="prefetch" href="/assets/js/114.3fdb14e5.js"><link rel="prefetch" href="/assets/js/115.24fd8b47.js"><link rel="prefetch" href="/assets/js/116.fa4af7d3.js"><link rel="prefetch" href="/assets/js/117.c5bc84c0.js"><link rel="prefetch" href="/assets/js/118.6ad3d598.js"><link rel="prefetch" href="/assets/js/119.fd9eb4ba.js"><link rel="prefetch" href="/assets/js/12.088628ed.js"><link rel="prefetch" href="/assets/js/120.36824fa8.js"><link rel="prefetch" href="/assets/js/121.6edd4478.js"><link rel="prefetch" href="/assets/js/122.228b556b.js"><link rel="prefetch" href="/assets/js/123.a51f4b7b.js"><link rel="prefetch" href="/assets/js/124.32fa9997.js"><link rel="prefetch" href="/assets/js/125.29138718.js"><link rel="prefetch" href="/assets/js/126.bfeae404.js"><link rel="prefetch" href="/assets/js/127.bbe78f94.js"><link rel="prefetch" href="/assets/js/128.6a9fd1ab.js"><link rel="prefetch" href="/assets/js/129.a26030ce.js"><link rel="prefetch" href="/assets/js/13.50987128.js"><link rel="prefetch" href="/assets/js/130.5a29c5e3.js"><link rel="prefetch" href="/assets/js/131.83dd6a40.js"><link rel="prefetch" href="/assets/js/132.31961e3b.js"><link rel="prefetch" href="/assets/js/133.12379872.js"><link rel="prefetch" href="/assets/js/134.2f630670.js"><link rel="prefetch" href="/assets/js/135.516248e9.js"><link rel="prefetch" href="/assets/js/136.c9fb3676.js"><link rel="prefetch" href="/assets/js/137.0d58b935.js"><link rel="prefetch" href="/assets/js/138.106b8051.js"><link rel="prefetch" href="/assets/js/139.3a4177bb.js"><link rel="prefetch" href="/assets/js/14.d98ee26c.js"><link rel="prefetch" href="/assets/js/140.cf104912.js"><link rel="prefetch" href="/assets/js/141.917d5919.js"><link rel="prefetch" href="/assets/js/142.d0c49c8f.js"><link rel="prefetch" href="/assets/js/143.e5647fcb.js"><link rel="prefetch" href="/assets/js/144.42362cf2.js"><link rel="prefetch" href="/assets/js/145.9f603000.js"><link rel="prefetch" href="/assets/js/146.9b30f1cd.js"><link rel="prefetch" href="/assets/js/147.00acaf92.js"><link rel="prefetch" href="/assets/js/148.0c69b088.js"><link rel="prefetch" href="/assets/js/149.2f219e93.js"><link rel="prefetch" href="/assets/js/15.d642d730.js"><link rel="prefetch" href="/assets/js/150.375474c6.js"><link rel="prefetch" href="/assets/js/151.66a582d5.js"><link rel="prefetch" href="/assets/js/152.1665682e.js"><link rel="prefetch" href="/assets/js/153.5a97da8e.js"><link rel="prefetch" href="/assets/js/154.3b76b78d.js"><link rel="prefetch" href="/assets/js/155.c92a6111.js"><link rel="prefetch" href="/assets/js/156.a247cd62.js"><link rel="prefetch" href="/assets/js/16.172153f0.js"><link rel="prefetch" href="/assets/js/17.ca69a778.js"><link rel="prefetch" href="/assets/js/18.3be7ba8f.js"><link rel="prefetch" href="/assets/js/19.4f66b5d8.js"><link rel="prefetch" href="/assets/js/20.8f0cd2cb.js"><link rel="prefetch" href="/assets/js/21.20681ba8.js"><link rel="prefetch" href="/assets/js/22.53b5baea.js"><link rel="prefetch" href="/assets/js/23.8b55cb0e.js"><link rel="prefetch" href="/assets/js/24.3328372c.js"><link rel="prefetch" href="/assets/js/25.ec23edd8.js"><link rel="prefetch" href="/assets/js/26.76e210a5.js"><link rel="prefetch" href="/assets/js/27.29b300ec.js"><link rel="prefetch" href="/assets/js/28.682ad17a.js"><link rel="prefetch" href="/assets/js/29.e1db4b89.js"><link rel="prefetch" href="/assets/js/30.796c2e36.js"><link rel="prefetch" href="/assets/js/31.912d2fae.js"><link rel="prefetch" href="/assets/js/32.60a749df.js"><link rel="prefetch" href="/assets/js/33.d87002b1.js"><link rel="prefetch" href="/assets/js/34.40a8b3f6.js"><link rel="prefetch" href="/assets/js/35.670ac802.js"><link rel="prefetch" href="/assets/js/36.e9f74d88.js"><link rel="prefetch" href="/assets/js/37.6d6f43d0.js"><link rel="prefetch" href="/assets/js/39.fc216f43.js"><link rel="prefetch" href="/assets/js/4.01043612.js"><link rel="prefetch" href="/assets/js/40.3bd13625.js"><link rel="prefetch" href="/assets/js/41.3f331b95.js"><link rel="prefetch" href="/assets/js/42.3b26f469.js"><link rel="prefetch" href="/assets/js/43.744d42da.js"><link rel="prefetch" href="/assets/js/44.8b9a8908.js"><link rel="prefetch" href="/assets/js/45.19c8ed8e.js"><link rel="prefetch" href="/assets/js/46.29927647.js"><link rel="prefetch" href="/assets/js/47.e4f53070.js"><link rel="prefetch" href="/assets/js/48.108272d7.js"><link rel="prefetch" href="/assets/js/49.c1e35862.js"><link rel="prefetch" href="/assets/js/5.80b3dd9d.js"><link rel="prefetch" href="/assets/js/50.8af695e4.js"><link rel="prefetch" href="/assets/js/51.33ef3df2.js"><link rel="prefetch" href="/assets/js/52.58bb8f89.js"><link rel="prefetch" href="/assets/js/53.4c6b5e8a.js"><link rel="prefetch" href="/assets/js/54.5763a55d.js"><link rel="prefetch" href="/assets/js/55.15295e7d.js"><link rel="prefetch" href="/assets/js/56.61c94966.js"><link rel="prefetch" href="/assets/js/57.46def60f.js"><link rel="prefetch" href="/assets/js/58.119434b5.js"><link rel="prefetch" href="/assets/js/59.f712c9c5.js"><link rel="prefetch" href="/assets/js/6.a702a72d.js"><link rel="prefetch" href="/assets/js/60.2072c323.js"><link rel="prefetch" href="/assets/js/61.09518814.js"><link rel="prefetch" href="/assets/js/62.35a494eb.js"><link rel="prefetch" href="/assets/js/63.d31876c6.js"><link rel="prefetch" href="/assets/js/64.8f68a737.js"><link rel="prefetch" href="/assets/js/65.6b094c4b.js"><link rel="prefetch" href="/assets/js/66.7c5599cd.js"><link rel="prefetch" href="/assets/js/67.625cd24c.js"><link rel="prefetch" href="/assets/js/68.371f4f22.js"><link rel="prefetch" href="/assets/js/69.c45293ee.js"><link rel="prefetch" href="/assets/js/7.076cee01.js"><link rel="prefetch" href="/assets/js/70.7a22bd02.js"><link rel="prefetch" href="/assets/js/71.729213ff.js"><link rel="prefetch" href="/assets/js/72.0f07bfbc.js"><link rel="prefetch" href="/assets/js/73.4d0355d4.js"><link rel="prefetch" href="/assets/js/74.0f47f56e.js"><link rel="prefetch" href="/assets/js/75.d11ecf15.js"><link rel="prefetch" href="/assets/js/76.727f8a27.js"><link rel="prefetch" href="/assets/js/77.f71a8653.js"><link rel="prefetch" href="/assets/js/78.cb1a43c1.js"><link rel="prefetch" href="/assets/js/79.9e83573b.js"><link rel="prefetch" href="/assets/js/8.d5f02645.js"><link rel="prefetch" href="/assets/js/80.ffafa3ff.js"><link rel="prefetch" href="/assets/js/81.30de8c9b.js"><link rel="prefetch" href="/assets/js/82.4cb0a9a6.js"><link rel="prefetch" href="/assets/js/83.6bf25e9a.js"><link rel="prefetch" href="/assets/js/84.984a50d8.js"><link rel="prefetch" href="/assets/js/85.81009c16.js"><link rel="prefetch" href="/assets/js/86.3325dd7c.js"><link rel="prefetch" href="/assets/js/87.d9dea564.js"><link rel="prefetch" href="/assets/js/88.620d3c46.js"><link rel="prefetch" href="/assets/js/89.414375c4.js"><link rel="prefetch" href="/assets/js/9.f9048235.js"><link rel="prefetch" href="/assets/js/90.07be05fd.js"><link rel="prefetch" href="/assets/js/91.5b6132ee.js"><link rel="prefetch" href="/assets/js/92.efd68e29.js"><link rel="prefetch" href="/assets/js/93.4e37aebc.js"><link rel="prefetch" href="/assets/js/94.a306e6d9.js"><link rel="prefetch" href="/assets/js/95.ddbaa2e0.js"><link rel="prefetch" href="/assets/js/96.b4c98c12.js"><link rel="prefetch" href="/assets/js/97.3bca48ba.js"><link rel="prefetch" href="/assets/js/98.f52f497a.js"><link rel="prefetch" href="/assets/js/99.588f017d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.dfeb017d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>Awaken's blogs</h3> <p class="description" data-v-4e82dffc data-v-4e82dffc>Awaken's blogs</p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>Awaken</span>
            
          <!---->
          2024
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/wtw.jpg" alt="Awaken's blogs" class="logo"> <span class="site-name">Awaken's blogs</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/BigData/" class="nav-link"><i class="undefined"></i>
  BigData
</a></li><li class="dropdown-item"><!----> <a href="/categories/DAG/" class="nav-link"><i class="undefined"></i>
  DAG
</a></li><li class="dropdown-item"><!----> <a href="/categories/ES/" class="nav-link"><i class="undefined"></i>
  ES
</a></li><li class="dropdown-item"><!----> <a href="/categories/Flink/" class="nav-link"><i class="undefined"></i>
  Flink
</a></li><li class="dropdown-item"><!----> <a href="/categories/JUC/" class="nav-link"><i class="undefined"></i>
  JUC
</a></li><li class="dropdown-item"><!----> <a href="/categories/JVM/" class="nav-link"><i class="undefined"></i>
  JVM
</a></li><li class="dropdown-item"><!----> <a href="/categories/JavaSE/" class="nav-link"><i class="undefined"></i>
  JavaSE
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/LeetCode/" class="nav-link"><i class="undefined"></i>
  LeetCode
</a></li><li class="dropdown-item"><!----> <a href="/categories/LINUX/" class="nav-link"><i class="undefined"></i>
  LINUX
</a></li><li class="dropdown-item"><!----> <a href="/categories/Linux/" class="nav-link"><i class="undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/categories/DB/" class="nav-link"><i class="undefined"></i>
  DB
</a></li><li class="dropdown-item"><!----> <a href="/categories/SSM/" class="nav-link"><i class="undefined"></i>
  SSM
</a></li><li class="dropdown-item"><!----> <a href="/categories/RK/" class="nav-link"><i class="undefined"></i>
  RK
</a></li><li class="dropdown-item"><!----> <a href="/categories/MQ/" class="nav-link"><i class="undefined"></i>
  MQ
</a></li><li class="dropdown-item"><!----> <a href="/categories/redis/" class="nav-link"><i class="undefined"></i>
  redis
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spark/" class="nav-link"><i class="undefined"></i>
  Spark
</a></li><li class="dropdown-item"><!----> <a href="/categories/SpringBoot/" class="nav-link"><i class="undefined"></i>
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/categories/projects/" class="nav-link"><i class="undefined"></i>
  projects
</a></li><li class="dropdown-item"><!----> <a href="/categories/SpringCloud/" class="nav-link"><i class="undefined"></i>
  SpringCloud
</a></li><li class="dropdown-item"><!----> <a href="/categories/project1/" class="nav-link"><i class="undefined"></i>
  project1
</a></li><li class="dropdown-item"><!----> <a href="/categories/Tools/" class="nav-link"><i class="undefined"></i>
  Tools
</a></li><li class="dropdown-item"><!----> <a href="/categories/arthas/" class="nav-link"><i class="undefined"></i>
  arthas
</a></li><li class="dropdown-item"><!----> <a href="/categories/deploy/" class="nav-link"><i class="undefined"></i>
  deploy
</a></li><li class="dropdown-item"><!----> <a href="/categories/k8s/" class="nav-link"><i class="undefined"></i>
  k8s
</a></li><li class="dropdown-item"><!----> <a href="/categories/mall/" class="nav-link"><i class="undefined"></i>
  mall
</a></li><li class="dropdown-item"><!----> <a href="/categories/Python/" class="nav-link"><i class="undefined"></i>
  Python
</a></li><li class="dropdown-item"><!----> <a href="/categories/others/" class="nav-link"><i class="undefined"></i>
  others
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/documents/" class="nav-link"><i class="undefined"></i>
  documents
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/recoluan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><img src="/wtw.jpg" alt="author-avatar" class="personal-img" data-v-828910c6> <h3 class="name" data-v-828910c6>
    Awaken
  </h3> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>144</h3> <h6 data-v-828910c6>Articles</h6></div> <div data-v-828910c6><h3 data-v-828910c6>78</h3> <h6 data-v-828910c6>Tags</h6></div></div> <ul class="social-links" data-v-828910c6></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/BigData/" class="nav-link"><i class="undefined"></i>
  BigData
</a></li><li class="dropdown-item"><!----> <a href="/categories/DAG/" class="nav-link"><i class="undefined"></i>
  DAG
</a></li><li class="dropdown-item"><!----> <a href="/categories/ES/" class="nav-link"><i class="undefined"></i>
  ES
</a></li><li class="dropdown-item"><!----> <a href="/categories/Flink/" class="nav-link"><i class="undefined"></i>
  Flink
</a></li><li class="dropdown-item"><!----> <a href="/categories/JUC/" class="nav-link"><i class="undefined"></i>
  JUC
</a></li><li class="dropdown-item"><!----> <a href="/categories/JVM/" class="nav-link"><i class="undefined"></i>
  JVM
</a></li><li class="dropdown-item"><!----> <a href="/categories/JavaSE/" class="nav-link"><i class="undefined"></i>
  JavaSE
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/LeetCode/" class="nav-link"><i class="undefined"></i>
  LeetCode
</a></li><li class="dropdown-item"><!----> <a href="/categories/LINUX/" class="nav-link"><i class="undefined"></i>
  LINUX
</a></li><li class="dropdown-item"><!----> <a href="/categories/Linux/" class="nav-link"><i class="undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/categories/DB/" class="nav-link"><i class="undefined"></i>
  DB
</a></li><li class="dropdown-item"><!----> <a href="/categories/SSM/" class="nav-link"><i class="undefined"></i>
  SSM
</a></li><li class="dropdown-item"><!----> <a href="/categories/RK/" class="nav-link"><i class="undefined"></i>
  RK
</a></li><li class="dropdown-item"><!----> <a href="/categories/MQ/" class="nav-link"><i class="undefined"></i>
  MQ
</a></li><li class="dropdown-item"><!----> <a href="/categories/redis/" class="nav-link"><i class="undefined"></i>
  redis
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spark/" class="nav-link"><i class="undefined"></i>
  Spark
</a></li><li class="dropdown-item"><!----> <a href="/categories/SpringBoot/" class="nav-link"><i class="undefined"></i>
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/categories/projects/" class="nav-link"><i class="undefined"></i>
  projects
</a></li><li class="dropdown-item"><!----> <a href="/categories/SpringCloud/" class="nav-link"><i class="undefined"></i>
  SpringCloud
</a></li><li class="dropdown-item"><!----> <a href="/categories/project1/" class="nav-link"><i class="undefined"></i>
  project1
</a></li><li class="dropdown-item"><!----> <a href="/categories/Tools/" class="nav-link"><i class="undefined"></i>
  Tools
</a></li><li class="dropdown-item"><!----> <a href="/categories/arthas/" class="nav-link"><i class="undefined"></i>
  arthas
</a></li><li class="dropdown-item"><!----> <a href="/categories/deploy/" class="nav-link"><i class="undefined"></i>
  deploy
</a></li><li class="dropdown-item"><!----> <a href="/categories/k8s/" class="nav-link"><i class="undefined"></i>
  k8s
</a></li><li class="dropdown-item"><!----> <a href="/categories/mall/" class="nav-link"><i class="undefined"></i>
  mall
</a></li><li class="dropdown-item"><!----> <a href="/categories/Python/" class="nav-link"><i class="undefined"></i>
  Python
</a></li><li class="dropdown-item"><!----> <a href="/categories/others/" class="nav-link"><i class="undefined"></i>
  others
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/documents/" class="nav-link"><i class="undefined"></i>
  documents
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/recoluan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>实时数仓-ClickHouse</h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>Awaken</span>
            
          <!---->
          2024
        </a></span></div></div> <div data-v-1156296a><main class="page"><section><div class="page-title"><h1 class="title">实时数仓-ClickHouse</h1> <div data-v-1ff7123e><i class="iconfont reco-account" data-v-1ff7123e><span data-v-1ff7123e>Awaken</span></i> <i class="iconfont reco-date" data-v-1ff7123e><span data-v-1ff7123e>9/24/2022</span></i> <!----> <i class="tags iconfont reco-tag" data-v-1ff7123e><span class="tag-item" data-v-1ff7123e>实时数仓</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="_1-特点"><a href="#_1-特点" class="header-anchor">#</a> 1. 特点</h2> <h3 id="_1-1-列式存储"><a href="#_1-1-列式存储" class="header-anchor">#</a> 1.1 列式存储</h3> <table><thead><tr><th><strong>Id</strong></th> <th><strong>Name</strong></th> <th><strong>Age</strong></th></tr></thead> <tbody><tr><td>1</td> <td>张三</td> <td>18</td></tr> <tr><td>2</td> <td>李四</td> <td>22</td></tr> <tr><td>3</td> <td>王五</td> <td>34</td></tr></tbody></table> <ul><li><p>采用行式存储时，数据在磁盘上的组织结构为：</p> <p>1张三	18	2	李四	22	3	王五	34</p></li></ul> <p>好处是想查某个人所有的属性时，可以通过一次磁盘查找加顺序读取就可以。但是当想查所有人的年龄时，需要不停的查找，或者全表扫描才行，遍历的很多数据都是不需要的。</p> <ul><li><p>采用列式存储时，数据在磁盘上的组织结构为：</p> <p>12	3	张三	李四	王五	18	22	34</p></li></ul> <p>这时想查所有人的年龄只需把年龄那一列拿出来就可以了</p> <ul><li>列式储存的好处：
<ul><li>对于列的聚合，计数，求和等统计操作原因优于行式存储。</li> <li>由于某一列的数据类型都是相同的，针对于数据存储更容易进行数据压缩，每一列选择更优的数据压缩算法，大大提高了数据的压缩比重。</li> <li>由于数据压缩比更好，一方面节省了磁盘空间，另一方面对于cache也有了更大的发挥空间。</li></ul></li></ul> <h3 id="_1-2-dbms的功能"><a href="#_1-2-dbms的功能" class="header-anchor">#</a> 1.2 DBMS的功能</h3> <p>​	几乎覆盖了标准SQL的大部分语法，包括 DDL和 DML，以及配套的各种函数，用户管理及权限管理，数据的备份与恢复。</p> <h3 id="_1-3-多样化引擎"><a href="#_1-3-多样化引擎" class="header-anchor">#</a> 1.3 多样化引擎</h3> <p>​	ClickHouse和MySQL类似，把表级的存储引擎插件化，根据表的不同需求可以设定不同的存储引擎。目前包括合并树、日志、接口和其他四大类20多种引擎。</p> <h3 id="_1-4-高吞吐写入能力"><a href="#_1-4-高吞吐写入能力" class="header-anchor">#</a> 1.4 高吞吐写入能力</h3> <p>​	ClickHouse采用类LSM Tree的结构，数据写入后定期在后台Compaction。通过类LSM tree的结构，ClickHouse在数据导入时全部是顺序append写，写入后数据段不可更改，在后台compaction时也是多个段merge sort后顺序写回磁盘。顺序写的特性，充分利用了磁盘的吞吐能力，即便在HDD上也有着优异的写入性能。
​	官方公开benchmark测试显示能够达到50MB-200MB/s的写入吞吐能力，按照每行100Byte估算，大约相当于50W-200W条/s的写入速度。</p> <h3 id="_1-5-数据分区与线程级并行"><a href="#_1-5-数据分区与线程级并行" class="header-anchor">#</a> 1.5 数据分区与线程级并行</h3> <p>​	ClickHouse将数据划分为多个partition，每个partition再进一步划分为多个index granularity(索引粒度)，然后通过多个CPU核心分别处理其中的一部分来实现并行数据处理。在这种设计下，单条Query就能利用整机所有CPU。极致的并行处理能力，极大的降低了查询延时。
​	所以，ClickHouse即使对于大量数据的查询也能够化整为零平行处理。但是有一个弊端就是对于单条查询使用多cpu，就不利于同时并发多条查询。所以对于高 qps 的查询业务，ClickHouse并不是强项。</p> <h2 id="_2-安装"><a href="#_2-安装" class="header-anchor">#</a> 2. 安装</h2> <h3 id="_2-1-准备"><a href="#_2-1-准备" class="header-anchor">#</a> 2.1 准备</h3> <p>关闭防火墙</p> <p>CentOS取消打开文件数限制</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> <span class="token function">vim</span> /etc/security/limits.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>加入以下内容</p> <div class="language-txt line-numbers-mode"><pre class="language-txt"><code>* soft nofile 65536
* hard nofile 65536
* soft nproc 131072
* hard nproc 131072
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> <span class="token function">vim</span> /etc/security/limits.d/20-nproc.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-txt line-numbers-mode"><pre class="language-txt"><code>* soft nofile 65536
* hard nofile 65536
* soft nproc 131072
* hard nproc 131072
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>同步到集群其他机器</p> <h3 id="_2-2-安装依赖"><a href="#_2-2-安装依赖" class="header-anchor">#</a> 2.2 安装依赖</h3> <p>集群所有机器均需执行</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> yum <span class="token function">install</span> -y libtool

<span class="token function">sudo</span> yum <span class="token function">install</span> -y *unixODBC*	
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_2-3-centos-取消-selinux"><a href="#_2-3-centos-取消-selinux" class="header-anchor">#</a> 2.3 CentOS 取消 SELINUX</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> <span class="token function">vim</span> /etc/selinux/config
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-txt line-numbers-mode"><pre class="language-txt"><code>SELINUX=disabled
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>同步集群其他机器</p> <h3 id="_2-4-安装"><a href="#_2-4-安装" class="header-anchor">#</a> 2.4 安装</h3> <p>官网：https://clickhouse.yandex/
下载地址：http://repo.red-soft.biz/repos/clickhouse/stable/el6/</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">mkdir</span> clickhouse
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/RTDW%2Fclickhouse_rpm.png" alt=""></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>xsync clickhouse

<span class="token function">sudo</span> <span class="token function">rpm</span> -ivh *.rpm

<span class="token comment"># 查看安装情况</span>
<span class="token function">sudo</span> <span class="token function">rpm</span> -qa<span class="token operator">|</span><span class="token function">grep</span> clickhouse
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>修改配置文件</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> <span class="token function">vim</span> /etc/clickhouse-server/config.xml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>把<code>&lt;listen_host&gt;::&lt;/listen_host&gt;</code>的注释打开，这样的话才能让ClickHouse被除本机以外的服务器访问</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>xsync config.xml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在这个文件中，有ClickHouse的一些默认路径配置，比较重要的
数据文件路径：<code>&lt;path&gt;/var/lib/clickhouse/&lt;/path&gt;</code>
日志文件路径：<code>&lt;log&gt;/var/log/clickhouse-server/clickhouse-server.log&lt;/log&gt;</code></p> <p>启动 Server</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> systemctl start clickhouse-server
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>关闭开机自启</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> systemctl disable clickhouse-server
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>客户端</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>clickhouse-client -m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>-m :可以在命令窗口输入多行命令</p> <h2 id="_3-类型"><a href="#_3-类型" class="header-anchor">#</a> 3. 类型</h2> <h3 id="_3-1-整型"><a href="#_3-1-整型" class="header-anchor">#</a> 3.1 整型</h3> <h3 id="_3-2-浮点型"><a href="#_3-2-浮点型" class="header-anchor">#</a> 3.2 浮点型</h3> <h3 id="_3-3-布尔型"><a href="#_3-3-布尔型" class="header-anchor">#</a> 3.3 布尔型</h3> <h3 id="_3-4-decimal型"><a href="#_3-4-decimal型" class="header-anchor">#</a> 3.4 Decimal型</h3> <h3 id="_3-5-字符串"><a href="#_3-5-字符串" class="header-anchor">#</a> 3.5 字符串</h3> <h3 id="_3-6-枚举类型"><a href="#_3-6-枚举类型" class="header-anchor">#</a> 3.6 枚举类型</h3> <h3 id="_3-7-时间类型"><a href="#_3-7-时间类型" class="header-anchor">#</a> 3.7 时间类型</h3> <h3 id="_3-8-数组"><a href="#_3-8-数组" class="header-anchor">#</a> 3.8 数组</h3> <h2 id="_4-表引擎"><a href="#_4-表引擎" class="header-anchor">#</a> 4. 表引擎</h2> <h3 id="_4-1-表引擎的使用"><a href="#_4-1-表引擎的使用" class="header-anchor">#</a> 4.1 表引擎的使用</h3> <p>表引擎是ClickHouse的一大特色。可以说， 表引擎决定了如何存储表的数据。包括：</p> <ul><li><p>数据的存储方式和位置，写到哪里以及从哪里读取数据。</p></li> <li><p>支持哪些查询以及如何支持。</p></li> <li><p>并发数据访问。</p></li> <li><p>索引的使用（如果存在）。</p></li> <li><p>是否可以执行多线程请求。</p></li> <li><p>数据复制参数。</p></li></ul> <p>表引擎的使用方式就是必须显式在创建表时定义该表使用的引擎，以及引擎使用的相关参数。
特别注意：<strong>引擎的名称大小写敏感</strong></p> <h3 id="_4-2-tinylog"><a href="#_4-2-tinylog" class="header-anchor">#</a> 4.2 TinyLog</h3> <p>​	以列文件的形式保存在磁盘上，不支持索引，没有并发控制。一般保存少量数据的小表，生产环境上作用有限。可以用于平时练习测试用。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> t_tinylog <span class="token punctuation">(</span> id String<span class="token punctuation">,</span> name String<span class="token punctuation">)</span> <span class="token keyword">engine</span><span class="token operator">=</span>TinyLog<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_4-3-memory"><a href="#_4-3-memory" class="header-anchor">#</a> 4.3 Memory</h3> <p>​	内存引擎，数据以未压缩的原始形式直接保存在内存当中，服务器重启数据就会消失。读写操作不会相互阻塞，不支持索引。简单查询下有非常非常高的性能表现（超过10G/s）。
​	一般用到它的地方不多，除了用来测试，就是在需要非常高的性能，同时数据量又不太大（上限大概 1 亿行）的场景。</p> <h3 id="_4-4-mergetree"><a href="#_4-4-mergetree" class="header-anchor">#</a> 4.4 MergeTree*</h3> <p>​	ClickHouse中最强大的表引擎当属MergeTree（合并树）引擎及该系列（*MergeTree）中的其他引擎，支持索引和分区，<strong>地位可以相当于innodb之于Mysql</strong>。 而且基于MergeTree，还衍生除了很多小弟，也是非常有特色的引擎。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> t_order_mt<span class="token punctuation">(</span>
    id UInt32<span class="token punctuation">,</span>
    sku_id String<span class="token punctuation">,</span>
    total_amount <span class="token keyword">Decimal</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    create_time <span class="token keyword">Datetime</span>
 <span class="token punctuation">)</span> <span class="token keyword">engine</span> <span class="token operator">=</span>MergeTree
   <span class="token keyword">partition</span> <span class="token keyword">by</span> toYYYYMMDD<span class="token punctuation">(</span>create_time<span class="token punctuation">)</span>
   <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
   <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token punctuation">(</span>id<span class="token punctuation">,</span>sku_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> t_order_mt <span class="token keyword">values</span>
<span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token string">'sku_001'</span><span class="token punctuation">,</span><span class="token number">1000.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-01 12:00:00'</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">'sku_002'</span><span class="token punctuation">,</span><span class="token number">2000.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-01 11:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">'sku_004'</span><span class="token punctuation">,</span><span class="token number">2500.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-01 12:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">'sku_002'</span><span class="token punctuation">,</span><span class="token number">2000.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-01 13:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">'sku_002'</span><span class="token punctuation">,</span><span class="token number">12000.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-01 13:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">'sku_002'</span><span class="token punctuation">,</span><span class="token number">600.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-02 12:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>​	MergeTree其实还有很多参数(绝大多数用默认值即可)，但是三个参数是更加重要的，也涉及了关于MergeTree的很多概念。</p> <h4 id="partition-by-分区-可选"><a href="#partition-by-分区-可选" class="header-anchor">#</a> partition by 分区(可选)</h4> <ul><li>作用
<ul><li>分区的目的主要是降低扫描的范围，优化查询速度</li></ul></li> <li>如果不填
<ul><li>只会使用一个分区</li></ul></li> <li>分区目录
<ul><li>MergeTree 是以列文件+索引文件+表定义文件组成的，但是如果设定了分区那么这些文件就会保存到不同的分区目录中。</li></ul></li> <li>并行
<ul><li>分区后，面对涉及跨分区的查询统计，ClickHouse会以分区为单位并行处理</li></ul></li> <li>数据写入与分区合并
<ul><li>任何一个批次的数据写入都会产生一个临时分区，不会纳入任何一个已有的分区。写入后的某个时刻（大概10-15分钟后），ClickHouse会自动执行合并操作（等不及也可以手动通过optimize执行），把临时分区的数据，合并到已有分区中。</li> <li><code>optimize table xxxx final;</code></li></ul></li></ul> <h4 id="primary-key主键-可选"><a href="#primary-key主键-可选" class="header-anchor">#</a> primary key主键(可选)</h4> <ul><li><p>ClickHouse中的主键，和其他数据库不太一样，它只提供了数据的一级索引，但是却不是唯一约束。这就意味着是可以存在相同primary key的数据的。</p></li> <li><p>主键的设定主要依据是查询语句中的where 条件。</p></li> <li><p>根据条件通过对主键进行某种形式的二分查找，能够定位到对应的index granularity,避免了全表扫描。·</p></li> <li><p>index granularity： 直接翻译的话就是索引粒度，指在稀疏索引中两个相邻索引对应数据的间隔。ClickHouse中的MergeTree默认是8192。官方不建议修改这个值，除非该列存在大量重复值，比如在一个分区中几万行才有一个不同数据。</p></li></ul> <p>稀疏索引：</p> <p><img src="https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/clickhouse%2Fsparse_index.png" alt=""></p> <p>​	稀疏索引的好处就是可以用很少的索引数据，定位更多的数据，代价就是只能定位到索引粒度的第一行，然后再进行进行一点扫描。</p> <h4 id="order-by-必选"><a href="#order-by-必选" class="header-anchor">#</a> order by (必选)</h4> <ul><li>order by 设定了分区内的数据按照哪些字段顺序进行有序保存。</li> <li>order by是MergeTree中唯一一个必填项，甚至比primary key 还重要，因为当用户不设置主键的情况，很多处理会依照order by的字段进行处理。</li> <li>要求：主键必须是order by字段的前缀字段。
<ul><li>比如order by 字段是 (id,sku_id)  那么主键必须是id 或者(id,sku_id)</li></ul></li></ul> <h4 id="二级索引"><a href="#二级索引" class="header-anchor">#</a> 二级索引</h4> <p>目前在ClickHouse的官网上二级索引的功能是被标注为实验性的。</p> <ol><li>使用二级索引前需要增加设置</li></ol> <p><code>set allow_experimental_data_skipping_indices=1;</code></p> <ol start="2"><li>创建测试表</li></ol> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> t_order_mt2<span class="token punctuation">(</span>
    id UInt32<span class="token punctuation">,</span>
    sku_id String<span class="token punctuation">,</span>
    total_amount <span class="token keyword">Decimal</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    create_time  <span class="token keyword">Datetime</span><span class="token punctuation">,</span>
	<span class="token keyword">INDEX</span> a total_amount <span class="token keyword">TYPE</span> minmax GRANULARITY <span class="token number">5</span>
 <span class="token punctuation">)</span> <span class="token keyword">engine</span> <span class="token operator">=</span>MergeTree
   <span class="token keyword">partition</span> <span class="token keyword">by</span> toYYYYMMDD<span class="token punctuation">(</span>create_time<span class="token punctuation">)</span>
   <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
   <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token punctuation">(</span>id<span class="token punctuation">,</span> sku_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>其中<strong>GRANULARITY</strong> N 是设定二级索引对于一级索引粒度的粒度。</p> <ol start="3"><li>插入数据</li></ol> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span>  t_order_mt2 <span class="token keyword">values</span>
<span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token string">'sku_001'</span><span class="token punctuation">,</span><span class="token number">1000.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-01 12:00:00'</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">'sku_002'</span><span class="token punctuation">,</span><span class="token number">2000.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-01 11:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">'sku_004'</span><span class="token punctuation">,</span><span class="token number">2500.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-01 12:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">'sku_002'</span><span class="token punctuation">,</span><span class="token number">2000.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-01 13:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">'sku_002'</span><span class="token punctuation">,</span><span class="token number">12000.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-01 13:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">'sku_002'</span><span class="token punctuation">,</span><span class="token number">600.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-02 12:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="4"><li>对比效果</li></ol> <p>在使用下面语句进行测试，可以看出二级索引能够为非主键字段的查询发挥作用。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>clickhouse<span class="token operator">-</span>client  <span class="token comment">--send_logs_level=trace &lt;&lt;&lt; 'select * from t_order_mt2  where total_amount &gt; toDecimal32(900., 2)';</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="数据-ttl"><a href="#数据-ttl" class="header-anchor">#</a> 数据 TTL</h4> <p>TTL即Time To Live，MergeTree提供了可以管理数据或者列的生命周期的功能。</p> <ol><li>列级别 TTL</li></ol> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> t_order_mt2<span class="token punctuation">(</span>
    id UInt32<span class="token punctuation">,</span>
    sku_id String<span class="token punctuation">,</span>
    total_amount <span class="token keyword">Decimal</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>  TTL create_time<span class="token operator">+</span><span class="token keyword">interval</span> <span class="token number">10</span> <span class="token keyword">SECOND</span><span class="token punctuation">,</span>
    create_time  <span class="token keyword">Datetime</span> 
 <span class="token punctuation">)</span> <span class="token keyword">engine</span> <span class="token operator">=</span>MergeTree
   <span class="token keyword">partition</span> <span class="token keyword">by</span> toYYYYMMDD<span class="token punctuation">(</span>create_time<span class="token punctuation">)</span>
   <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
   <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token punctuation">(</span>id<span class="token punctuation">,</span> sku_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>插入数据（注意：根据实际时间改变）</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span>  t_order_mt2 <span class="token keyword">values</span>
<span class="token punctuation">(</span><span class="token number">106</span><span class="token punctuation">,</span><span class="token string">'sku_001'</span><span class="token punctuation">,</span><span class="token number">1000.00</span><span class="token punctuation">,</span><span class="token string">'2023-06-12 22:52:30'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">107</span><span class="token punctuation">,</span><span class="token string">'sku_002'</span><span class="token punctuation">,</span><span class="token number">2000.00</span><span class="token punctuation">,</span><span class="token string">'2023-06-12 22:52:30'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">110</span><span class="token punctuation">,</span><span class="token string">'sku_003'</span><span class="token punctuation">,</span><span class="token number">600.00</span><span class="token punctuation">,</span><span class="token string">'2023-06-13 12:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>手动合并，查看效果  到期后，指定的字段数据归 0</p> <p><img src="https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/clickhouse%2Frow_ttl.png" alt=""></p> <ol start="2"><li>表级别 TTL</li></ol> <p>下面的这条语句是数据会在create_time 之后10秒丢失</p> <p><code>alter table t_order_mt3 MODIFY TTL create_time + INTERVAL 10 SECOND;</code></p> <p>涉及判断的字段必须是Date或者Datetime类型，推荐使用分区的日期字段。
能够使用的时间周期：</p> <ul><li>SECOND</li> <li>MINUTE</li> <li>HOUR</li> <li>DAY</li> <li>WEEK</li> <li>MONTH</li> <li>QUARTER</li> <li>YEAR</li></ul> <h4 id="replacingmergetree"><a href="#replacingmergetree" class="header-anchor">#</a> ReplacingMergeTree</h4> <p>​	ReplacingMergeTree是MergeTree的一个变种，它存储特性完全继承MergeTree，只是多了一个去重的功能。 尽管MergeTree可以设置主键，但是primary key其实没有唯一约束的功能。如果你想处理掉重复的数据，可以借助这个ReplacingMergeTree。</p> <ul><li>去重时机
<ul><li>数据的去重只会在合并的过程中出现。合并会在未知的时间在后台进行，所以你无法预先作出计划。有一些数据可能仍未被处理。</li></ul></li> <li>去重范围
<ul><li>如果表经过了分区，去重只会在分区内部进行去重，不能执行跨分区的去重。
所以ReplacingMergeTree能力有限， ReplacingMergeTree 适用于在后台清除重复的数据以节省空间，但是它不保证没有重复的数据出现。</li></ul></li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> t_order_rmt<span class="token punctuation">(</span>
    id UInt32<span class="token punctuation">,</span>
    sku_id String<span class="token punctuation">,</span>
    total_amount <span class="token keyword">Decimal</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
    create_time  <span class="token keyword">Datetime</span>
 <span class="token punctuation">)</span> <span class="token keyword">engine</span> <span class="token operator">=</span> ReplacingMergeTree<span class="token punctuation">(</span>create_time<span class="token punctuation">)</span>
   <span class="token keyword">partition</span> <span class="token keyword">by</span> toYYYYMMDD<span class="token punctuation">(</span>create_time<span class="token punctuation">)</span>
   <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
   <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token punctuation">(</span>id<span class="token punctuation">,</span> sku_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>ReplacingMergeTree() 填入的参数为版本字段，重复数据保留版本字段值最大的。如果不填版本字段，默认按照插入顺序保留最后一条。</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span>  t_order_rmt <span class="token keyword">values</span>
<span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token string">'sku_001'</span><span class="token punctuation">,</span><span class="token number">1000.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-01 12:00:00'</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">'sku_002'</span><span class="token punctuation">,</span><span class="token number">2000.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-01 11:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">'sku_004'</span><span class="token punctuation">,</span><span class="token number">2500.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-01 12:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">'sku_002'</span><span class="token punctuation">,</span><span class="token number">2000.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-01 13:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">'sku_002'</span><span class="token punctuation">,</span><span class="token number">12000.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-01 13:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">'sku_002'</span><span class="token punctuation">,</span><span class="token number">600.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-02 12:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>实际上是使用order by 字段作为唯一键</li> <li>去重不能跨分区</li> <li>只有合并才会进行去重</li> <li>认定重复的数据保留版本字段值最大的</li> <li>如果版本字段相同则按插入顺序保留最后一笔</li></ul> <h4 id="summingmergetree"><a href="#summingmergetree" class="header-anchor">#</a> SummingMergeTree</h4> <ul><li><p>对于不查询明细，只关心以维度进行汇总聚合结果的场景。如果只使用普通的MergeTree的话，无论是存储空间的开销，还是查询时临时聚合的开销都比较大。</p></li> <li><p>ClickHouse 为了这种场景，提供了一种能够“预聚合”的引擎SummingMergeTree</p></li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> t_order_smt<span class="token punctuation">(</span>
    id UInt32<span class="token punctuation">,</span>
    sku_id String<span class="token punctuation">,</span>
    total_amount <span class="token keyword">Decimal</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
    create_time <span class="token keyword">Datetime</span>
 <span class="token punctuation">)</span> <span class="token keyword">engine</span> <span class="token operator">=</span>SummingMergeTree<span class="token punctuation">(</span>total_amount<span class="token punctuation">)</span>
   <span class="token keyword">partition</span> <span class="token keyword">by</span> toYYYYMMDD<span class="token punctuation">(</span>create_time<span class="token punctuation">)</span>
   <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
   <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token punctuation">(</span>id<span class="token punctuation">,</span>sku_id <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> t_order_smt <span class="token keyword">values</span>
<span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token string">'sku_001'</span><span class="token punctuation">,</span><span class="token number">1000.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-01 12:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">'sku_002'</span><span class="token punctuation">,</span><span class="token number">2000.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-01 11:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">'sku_004'</span><span class="token punctuation">,</span><span class="token number">2500.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-01 12:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">'sku_002'</span><span class="token punctuation">,</span><span class="token number">2000.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-01 13:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">'sku_002'</span><span class="token punctuation">,</span><span class="token number">12000.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-01 13:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">'sku_002'</span><span class="token punctuation">,</span><span class="token number">600.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-02 12:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>手动合并</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t_order_smt<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/clickhouse%2Fsumming_tree.png" alt=""></p> <ul><li>以SummingMergeTree（）中指定的列作为汇总数据列</li> <li>可以填写多列必须数字列，如果不填，以所有非维度列且为数字列的字段为汇总数据列</li> <li>以order by 的列为准，作为维度列</li> <li>其他的列按插入顺序保留第一行</li> <li>不在一个分区的数据不会被聚合</li></ul> <p><strong>开发建议</strong></p> <p>设计聚合表的话，唯一键值、流水号可以去掉，所有字段全部是维度、度量或者时间戳。</p> <p>问题：</p> <p>能不能直接执行以下SQL得到汇总值</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> total_amount <span class="token keyword">from</span>  XXX <span class="token keyword">where</span> province_name<span class="token operator">=</span>’’ <span class="token operator">and</span> create_date<span class="token operator">=</span>’xxx’
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>不行，可能会包含一些还没来得及聚合的临时明细</p> <p>如果要是获取汇总值，还是需要使用sum进行聚合，这样效率会有一定的提高，但本身ClickHouse是列式存储的，效率提升有限，不会特别明显。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>total_amount<span class="token punctuation">)</span> <span class="token keyword">from</span> province_name<span class="token operator">=</span>’’ <span class="token operator">and</span> create_date<span class="token operator">=</span>‘xxx’
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_5-sql操作"><a href="#_5-sql操作" class="header-anchor">#</a> 5. SQL操作</h2> <p>此处之记录与MySQL的不同之处</p> <h3 id="_5-1-insert"><a href="#_5-1-insert" class="header-anchor">#</a> 5.1 Insert</h3> <p>从表到表的插入</p> <p>insert into [table_name] select a,b,c from [table_name_2]</p> <h3 id="_5-2-update-和-delete"><a href="#_5-2-update-和-delete" class="header-anchor">#</a> 5.2 Update 和 Delete</h3> <ul><li>ClickHouse提供了Delete和Update的能力，这类操作被称为Mutation查询，它可以看做Alter 的一种。</li> <li>虽然可以实现修改和删除，但是和一般的OLTP数据库不一样，<strong>Mutation语句是一种很“重”的操作，而且不支持事务。</strong></li> <li>“重”的原因主要是每次修改或者删除都会导致放弃目标数据的原有分区，重建新分区。所以尽量做批量的变更，不要进行频繁小数据的操作。</li></ul> <p>删除操作</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">alter</span> <span class="token keyword">table</span> t_order_smt <span class="token keyword">delete</span> <span class="token keyword">where</span> sku_id <span class="token operator">=</span><span class="token string">'sku_001'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>修改操作</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">alter</span> <span class="token keyword">table</span> t_order_smt <span class="token keyword">update</span> total_amount<span class="token operator">=</span>toDecimal32<span class="token punctuation">(</span><span class="token number">2000.00</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token number">102</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>​	由于操作比较“重”，所以 Mutation语句分两步执行，同步执行的部分其实只是进行新增数据新增分区和并把旧分区打上逻辑上的失效标记。直到触发分区合并的时候，才会删除旧数据释放磁盘空间，一般不会开放这样的功能给用户，由管理员完成。</p> <h3 id="_5-3-查询"><a href="#_5-3-查询" class="header-anchor">#</a> 5.3 查询</h3> <ul><li>支持子查询</li> <li>支持CTE(Common Table Expression 公用表表达式 with 子句)</li> <li>支持各种JOIN， 但是JOIN操作无法使用缓存，所以即使是两次相同的JOIN语句，ClickHouse也会视为两条新SQL</li> <li>窗口函数(官方正在测试中...)</li> <li>不支持自定义函数</li> <li>GROUP BY 操作增加了 with rollup\with cube\with total 用来计算小计和总计。</li></ul> <p>插入数据</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">alter</span> <span class="token keyword">table</span> t_order_mt <span class="token keyword">delete</span> <span class="token keyword">where</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span>  t_order_mt <span class="token keyword">values</span>
<span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token string">'sku_001'</span><span class="token punctuation">,</span><span class="token number">1000.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-01 12:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token string">'sku_002'</span><span class="token punctuation">,</span><span class="token number">2000.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-01 12:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">103</span><span class="token punctuation">,</span><span class="token string">'sku_004'</span><span class="token punctuation">,</span><span class="token number">2500.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-01 12:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">104</span><span class="token punctuation">,</span><span class="token string">'sku_002'</span><span class="token punctuation">,</span><span class="token number">2000.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-01 12:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token string">'sku_003'</span><span class="token punctuation">,</span><span class="token number">600.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-02 12:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">106</span><span class="token punctuation">,</span><span class="token string">'sku_001'</span><span class="token punctuation">,</span><span class="token number">1000.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-04 12:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">107</span><span class="token punctuation">,</span><span class="token string">'sku_002'</span><span class="token punctuation">,</span><span class="token number">2000.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-04 12:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">108</span><span class="token punctuation">,</span><span class="token string">'sku_004'</span><span class="token punctuation">,</span><span class="token number">2500.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-04 12:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">109</span><span class="token punctuation">,</span><span class="token string">'sku_002'</span><span class="token punctuation">,</span><span class="token number">2000.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-04 12:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">110</span><span class="token punctuation">,</span><span class="token string">'sku_003'</span><span class="token punctuation">,</span><span class="token number">600.00</span><span class="token punctuation">,</span><span class="token string">'2020-06-01 12:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>with rollup：从右至左去掉维度进行小计</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> id<span class="token punctuation">,</span>sku_id<span class="token punctuation">,</span><span class="token function">sum</span><span class="token punctuation">(</span>total_amount<span class="token punctuation">)</span> <span class="token keyword">from</span> t_order_mt <span class="token keyword">group</span> <span class="token keyword">by</span> id<span class="token punctuation">,</span>sku_id <span class="token keyword">with rollup</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/clickhouse%2Fselect_withrollup.png" alt=""></p> <ul><li>with cube : 从右至左去掉维度进行小计，再从左至右去掉维度进行小计</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> id <span class="token punctuation">,</span> sku_id<span class="token punctuation">,</span><span class="token function">sum</span><span class="token punctuation">(</span>total_amount<span class="token punctuation">)</span> <span class="token keyword">from</span>  t_order_mt <span class="token keyword">group</span> <span class="token keyword">by</span> id<span class="token punctuation">,</span>sku_id <span class="token keyword">with</span> cube<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/clickhouse%2Fselect_withcube.png" alt=""></p> <ul><li>with totals: 只计算合计</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> id<span class="token punctuation">,</span>sku_id<span class="token punctuation">,</span><span class="token function">sum</span><span class="token punctuation">(</span>total_amount<span class="token punctuation">)</span> <span class="token keyword">from</span> t_order_mt <span class="token keyword">group</span> <span class="token keyword">by</span> id<span class="token punctuation">,</span>sku_id <span class="token keyword">with</span> totals<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/clickhouse%2Fselect_withtotals.png" alt=""></p> <h3 id="_5-4-alter-操作"><a href="#_5-4-alter-操作" class="header-anchor">#</a> 5.4 alter 操作</h3> <h3 id="_5-5-导出数据"><a href="#_5-5-导出数据" class="header-anchor">#</a> 5.5 导出数据</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>clickhouse<span class="token operator">-</span>client <span class="token comment">--query &quot;select * from t_order_mt where create_time='2020-06-01 12:00:00'&quot; --format CSVWithNames&gt; /opt/module/data/rs1.csv1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>更多支持格式参照：
https://clickhouse.tech/docs/v19.14/en/interfaces/formats/#csvwithnames</p> <h2 id="_6-副本"><a href="#_6-副本" class="header-anchor">#</a> 6. 副本</h2> <p>​	副本的目的主要是保障数据的高可用性，即使一台ClickHouse节点宕机，那么也可以从其他服务器获得相同的数据。</p> <p>参考 excel</p> <h2 id="_7-clickhouse的优势"><a href="#_7-clickhouse的优势" class="header-anchor">#</a> 7. Clickhouse的优势</h2> <p>快：提供了丰富的表引擎，每个表引擎 都做了尽可能的优化。</p> <p>为什么快？</p> <p>（1）向量化</p> <p>（2）列式</p> <p>（3）尽可能使用本节点的 内存+cpu，不依赖其他组件，比如Hadoop</p> <p>（4）提供了sql化的语言</p> <p>（5）支持自定义函数</p> <p>（6）提供了丰富的表引擎，引擎都经过了优化</p> <h2 id="_8-clickhouse的引擎"><a href="#_8-clickhouse的引擎" class="header-anchor">#</a> 8. Clickhouse的引擎</h2> <p>（1）Log</p> <p>（2）Special：Memory、Distributed</p> <p>（3）MergeTree： replacingmergetree、summingmergetree、replicatedmergetree</p> <p>（4）集成引擎： 外部系统映射，如MySQL</p> <h2 id="_9-flink写入clickhouse一致性问题"><a href="#_9-flink写入clickhouse一致性问题" class="header-anchor">#</a> 9. Flink写入Clickhouse一致性问题</h2> <p>Clickhouse没有事务，Flink写入是至少一次语义。</p> <p>利用Clickhouse的ReplacingMergeTree引擎会根据主键去重，但只能保证最终一致性。查询时加上final关键字可以保证查询结果的一致性。</p> <h2 id="_10-clickhouse存储多少数据-几张表"><a href="#_10-clickhouse存储多少数据-几张表" class="header-anchor">#</a> 10. Clickhouse存储多少数据？几张表</h2> <p>10几张宽表，每天平均10来G，存储一年。</p> <p>需要磁盘 10G * 365天 * 2副本/0.7 = 约11T</p> <h2 id="_11-clickhouse使用本地表还是分布式表"><a href="#_11-clickhouse使用本地表还是分布式表" class="header-anchor">#</a> 11. Clickhouse使用本地表还是分布式表</h2> <p>1）我们用的本地表，2个副本</p> <p>2）分布式表写入存在的问题：</p> <p>​	假如现有一个2分片的集群，使用clickhouse插入分布式表。</p> <p>​	（1）资源消耗问题：在分片2的数据写入临时目录中会产生写放大现象，会大量消耗分片节点1的CPU和磁盘等资源。</p> <p>​	（2）数据准确性和一致性问题：在写入分片2的时候，节点1或节点2的不正常都会导致数据问题。（节点1挂了数据丢失、节点2挂了或者节点2表删了节点1会无限制重试，占用资源）。</p> <p>​	（3）part过多问题：每个节点每秒收到一个Insert Query，N个节点，分发N-1次，一共就是每秒生成Nx（N-1）个part目录。集群shard数越多，分发产生的小文件也会越多（如果写本地表就会相对集中些），最后会导致写入到MergeTree的Part的数会特别多，最后会拖垮整个文件的系统。</p> <h2 id="_12-clickhouse的物化视图"><a href="#_12-clickhouse的物化视图" class="header-anchor">#</a> 12. Clickhouse的物化视图</h2> <p>​	一种查询结果的持久化，记录了查询语句和对应的查询结果。</p> <p>​	优点：查询速度快，要是把物化视图这些规则全部写好，它比原数据查询快了很多，总的行数少了，因为都预计算好了。</p> <p>​	缺点：它的本质是一个流式数据的使用场景，是累加式的技术，所以要用历史数据做去重、去核这样的分析，在物化视图里面是不太好用的。在某些场景的使用也是有限的。而且如果一张表加了好多物化视图，在写这张表的时候，就会消耗很多机器的资源，比如数据带宽占满、存储一下子增加了很多。</p> <h2 id="_13-clickhouse优化"><a href="#_13-clickhouse优化" class="header-anchor">#</a> 13. Clickhouse优化</h2> <p>1）内存优化</p> <p>​	max_memory_usage： 单个查询的内存上限，128G内存的服务器==》 设为100G</p> <p>​	max_bytes_before_external_group_by：设为 一半，50G</p> <p>​	max_bytes_before_external_sort：设为一半，50G</p> <p>2）CPU</p> <p>​	max_concurrent_queries： 默认 100/s ===&gt; 300/s</p> <p>3）存储</p> <p>​	SSD更快</p> <p>4）物化视图</p> <p>5）写入时攒批，避免写入过快导致 too many parts</p> <h2 id="_14-clickhouse新特性"><a href="#_14-clickhouse新特性" class="header-anchor">#</a> 14. Clickhouse新特性</h2> <p>Projection：</p> <p>​	Projection 意指一组列的组合，可以按照与原表不同的排序存储，并且支持聚合函数的查询。ClickHouse Projection 可以看做是一种更加智能的物化视图，它有如下特点：</p> <p>1）part-level存储</p> <p>​	相比普通物化视图是一张独立的表，Projection 物化的数据就保存在原表的分区目录中，支持明细数据的普通Projection 和 预聚合Projection。</p> <p>2）无感使用，自动命中</p> <p>​	可以对一张 MergeTree 创建多个 Projection ，当执行 Select 语句的时候，能根据查询范围，自动匹配最优的 Projection 提供查询加速。如果没有命中 Projection , 就直接查询底表。</p> <p>3）数据同源、同生共死</p> <p>​	因为物化的数据保存在原表的分区，所以数据的更新、合并都是同源的，也就不会出现不一致的情况了。</p> <h2 id="_15-clickhouse索引与底层存储"><a href="#_15-clickhouse索引与底层存储" class="header-anchor">#</a> 15. Clickhouse索引与底层存储</h2> <p>1）索引</p> <p>（1）一级索引：稀疏索引（主键索引）粒度8192</p> <p>（2）二级索引：跳数索引  minmax、set、bloom_filter等</p> <p>2）底层存储</p> <p>​	Clickhouse默认数据目录在/var/lib/clickhouse/data目录中。所有的数据库都会在该目录中创建一个子文件夹。下图展示了Clickhouse对数据文件的组织。</p> <p><img src="https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/clickhouse%2Fclickhouse_stor.png" alt=""></p> <table><thead><tr><th><strong>202103_1_10_2</strong></th> <th><strong>目录</strong></th> <th><strong>分区目录，由分区+LSM生成的</strong></th></tr></thead> <tbody><tr><td><strong>detached</strong></td> <td>目录</td> <td>通过DETACH语句卸载后的表分区存放位置</td></tr> <tr><td><strong>format_version.txt</strong></td> <td>文本文件</td> <td>纯文本，记录存储的格式</td></tr></tbody></table> <p>​	分区目录命名 = 分区ID_最小数据块编号_最大数据块编号_层级构成。数据块编号从1开始自增，新创建的数据块最大和最小编号相同，当发生合并时会将其修改为合并的数据块编号。同时每次合并都会将层级增加1。</p></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">6 months ago</span></div></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-70334359><li class="level-2" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_1-特点" class="sidebar-link reco-side-_1-特点" data-v-70334359>1. 特点</a></li><li class="level-3" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_1-1-列式存储" class="sidebar-link reco-side-_1-1-列式存储" data-v-70334359>1.1 列式存储</a></li><li class="level-3" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_1-2-dbms的功能" class="sidebar-link reco-side-_1-2-dbms的功能" data-v-70334359>1.2 DBMS的功能</a></li><li class="level-3" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_1-3-多样化引擎" class="sidebar-link reco-side-_1-3-多样化引擎" data-v-70334359>1.3 多样化引擎</a></li><li class="level-3" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_1-4-高吞吐写入能力" class="sidebar-link reco-side-_1-4-高吞吐写入能力" data-v-70334359>1.4 高吞吐写入能力</a></li><li class="level-3" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_1-5-数据分区与线程级并行" class="sidebar-link reco-side-_1-5-数据分区与线程级并行" data-v-70334359>1.5 数据分区与线程级并行</a></li><li class="level-2" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_2-安装" class="sidebar-link reco-side-_2-安装" data-v-70334359>2. 安装</a></li><li class="level-3" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_2-1-准备" class="sidebar-link reco-side-_2-1-准备" data-v-70334359>2.1 准备</a></li><li class="level-3" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_2-2-安装依赖" class="sidebar-link reco-side-_2-2-安装依赖" data-v-70334359>2.2 安装依赖</a></li><li class="level-3" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_2-3-centos-取消-selinux" class="sidebar-link reco-side-_2-3-centos-取消-selinux" data-v-70334359>2.3 CentOS 取消 SELINUX</a></li><li class="level-3" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_2-4-安装" class="sidebar-link reco-side-_2-4-安装" data-v-70334359>2.4 安装</a></li><li class="level-2" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_3-类型" class="sidebar-link reco-side-_3-类型" data-v-70334359>3. 类型</a></li><li class="level-3" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_3-1-整型" class="sidebar-link reco-side-_3-1-整型" data-v-70334359>3.1 整型</a></li><li class="level-3" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_3-2-浮点型" class="sidebar-link reco-side-_3-2-浮点型" data-v-70334359>3.2 浮点型</a></li><li class="level-3" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_3-3-布尔型" class="sidebar-link reco-side-_3-3-布尔型" data-v-70334359>3.3 布尔型</a></li><li class="level-3" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_3-4-decimal型" class="sidebar-link reco-side-_3-4-decimal型" data-v-70334359>3.4 Decimal型</a></li><li class="level-3" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_3-5-字符串" class="sidebar-link reco-side-_3-5-字符串" data-v-70334359>3.5 字符串</a></li><li class="level-3" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_3-6-枚举类型" class="sidebar-link reco-side-_3-6-枚举类型" data-v-70334359>3.6 枚举类型</a></li><li class="level-3" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_3-7-时间类型" class="sidebar-link reco-side-_3-7-时间类型" data-v-70334359>3.7 时间类型</a></li><li class="level-3" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_3-8-数组" class="sidebar-link reco-side-_3-8-数组" data-v-70334359>3.8 数组</a></li><li class="level-2" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_4-表引擎" class="sidebar-link reco-side-_4-表引擎" data-v-70334359>4. 表引擎</a></li><li class="level-3" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_4-1-表引擎的使用" class="sidebar-link reco-side-_4-1-表引擎的使用" data-v-70334359>4.1 表引擎的使用</a></li><li class="level-3" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_4-2-tinylog" class="sidebar-link reco-side-_4-2-tinylog" data-v-70334359>4.2 TinyLog</a></li><li class="level-3" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_4-3-memory" class="sidebar-link reco-side-_4-3-memory" data-v-70334359>4.3 Memory</a></li><li class="level-3" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_4-4-mergetree" class="sidebar-link reco-side-_4-4-mergetree" data-v-70334359>4.4 MergeTree*</a></li><li class="level-2" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_5-sql操作" class="sidebar-link reco-side-_5-sql操作" data-v-70334359>5. SQL操作</a></li><li class="level-3" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_5-1-insert" class="sidebar-link reco-side-_5-1-insert" data-v-70334359>5.1 Insert</a></li><li class="level-3" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_5-2-update-和-delete" class="sidebar-link reco-side-_5-2-update-和-delete" data-v-70334359>5.2 Update 和 Delete</a></li><li class="level-3" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_5-3-查询" class="sidebar-link reco-side-_5-3-查询" data-v-70334359>5.3 查询</a></li><li class="level-3" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_5-4-alter-操作" class="sidebar-link reco-side-_5-4-alter-操作" data-v-70334359>5.4 alter 操作</a></li><li class="level-3" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_5-5-导出数据" class="sidebar-link reco-side-_5-5-导出数据" data-v-70334359>5.5 导出数据</a></li><li class="level-2" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_6-副本" class="sidebar-link reco-side-_6-副本" data-v-70334359>6. 副本</a></li><li class="level-2" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_7-clickhouse的优势" class="sidebar-link reco-side-_7-clickhouse的优势" data-v-70334359>7. Clickhouse的优势</a></li><li class="level-2" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_8-clickhouse的引擎" class="sidebar-link reco-side-_8-clickhouse的引擎" data-v-70334359>8. Clickhouse的引擎</a></li><li class="level-2" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_9-flink写入clickhouse一致性问题" class="sidebar-link reco-side-_9-flink写入clickhouse一致性问题" data-v-70334359>9. Flink写入Clickhouse一致性问题</a></li><li class="level-2" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_10-clickhouse存储多少数据-几张表" class="sidebar-link reco-side-_10-clickhouse存储多少数据-几张表" data-v-70334359>10. Clickhouse存储多少数据？几张表</a></li><li class="level-2" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_11-clickhouse使用本地表还是分布式表" class="sidebar-link reco-side-_11-clickhouse使用本地表还是分布式表" data-v-70334359>11. Clickhouse使用本地表还是分布式表</a></li><li class="level-2" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_12-clickhouse的物化视图" class="sidebar-link reco-side-_12-clickhouse的物化视图" data-v-70334359>12. Clickhouse的物化视图</a></li><li class="level-2" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_13-clickhouse优化" class="sidebar-link reco-side-_13-clickhouse优化" data-v-70334359>13. Clickhouse优化</a></li><li class="level-2" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_14-clickhouse新特性" class="sidebar-link reco-side-_14-clickhouse新特性" data-v-70334359>14. Clickhouse新特性</a></li><li class="level-2" data-v-70334359><a href="/blogs/BigData/RTDW-5-ClickHouse.html#_15-clickhouse索引与底层存储" class="sidebar-link reco-side-_15-clickhouse索引与底层存储" data-v-70334359>15. Clickhouse索引与底层存储</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div></div><APlayer audio="" fixed="true" mini="true" theme="#f9bcdd" loop="loop" order="random" preload="auto" volume="0.3" mutex="true" lrc-type="0" list-folded="true" list-max-height="250" storage-name="vuepress-plugin-meting" id="aplayer-fixed"></APlayer></div></div>
    <script src="/assets/js/app.03646987.js" defer></script><script src="/assets/js/3.a8134f0a.js" defer></script><script src="/assets/js/1.a394b090.js" defer></script><script src="/assets/js/38.ef496ae1.js" defer></script>
  </body>
</html>
