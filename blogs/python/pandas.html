<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Pandas | Awaken&#39;s blogs</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/wtw.jpg">
    <meta name="description" content="Awaken's blogs">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.dfeb017d.css" as="style"><link rel="preload" href="/assets/js/app.03646987.js" as="script"><link rel="preload" href="/assets/js/3.a8134f0a.js" as="script"><link rel="preload" href="/assets/js/1.a394b090.js" as="script"><link rel="preload" href="/assets/js/147.00acaf92.js" as="script"><link rel="prefetch" href="/assets/js/10.0aed174e.js"><link rel="prefetch" href="/assets/js/100.02914097.js"><link rel="prefetch" href="/assets/js/101.95f6c81a.js"><link rel="prefetch" href="/assets/js/102.48df0133.js"><link rel="prefetch" href="/assets/js/103.200f5642.js"><link rel="prefetch" href="/assets/js/104.080c910a.js"><link rel="prefetch" href="/assets/js/105.943605b5.js"><link rel="prefetch" href="/assets/js/106.55d2b7c0.js"><link rel="prefetch" href="/assets/js/107.dbf3105f.js"><link rel="prefetch" href="/assets/js/108.3a747b28.js"><link rel="prefetch" href="/assets/js/109.e9453b81.js"><link rel="prefetch" href="/assets/js/11.38bfbf06.js"><link rel="prefetch" href="/assets/js/110.15ce5269.js"><link rel="prefetch" href="/assets/js/111.e2a2b309.js"><link rel="prefetch" href="/assets/js/112.83e22ec5.js"><link rel="prefetch" href="/assets/js/113.4c53e21e.js"><link rel="prefetch" href="/assets/js/114.3fdb14e5.js"><link rel="prefetch" href="/assets/js/115.24fd8b47.js"><link rel="prefetch" href="/assets/js/116.fa4af7d3.js"><link rel="prefetch" href="/assets/js/117.c5bc84c0.js"><link rel="prefetch" href="/assets/js/118.6ad3d598.js"><link rel="prefetch" href="/assets/js/119.fd9eb4ba.js"><link rel="prefetch" href="/assets/js/12.088628ed.js"><link rel="prefetch" href="/assets/js/120.36824fa8.js"><link rel="prefetch" href="/assets/js/121.6edd4478.js"><link rel="prefetch" href="/assets/js/122.228b556b.js"><link rel="prefetch" href="/assets/js/123.a51f4b7b.js"><link rel="prefetch" href="/assets/js/124.32fa9997.js"><link rel="prefetch" href="/assets/js/125.29138718.js"><link rel="prefetch" href="/assets/js/126.bfeae404.js"><link rel="prefetch" href="/assets/js/127.bbe78f94.js"><link rel="prefetch" href="/assets/js/128.6a9fd1ab.js"><link rel="prefetch" href="/assets/js/129.a26030ce.js"><link rel="prefetch" href="/assets/js/13.50987128.js"><link rel="prefetch" href="/assets/js/130.5a29c5e3.js"><link rel="prefetch" href="/assets/js/131.83dd6a40.js"><link rel="prefetch" href="/assets/js/132.31961e3b.js"><link rel="prefetch" href="/assets/js/133.12379872.js"><link rel="prefetch" href="/assets/js/134.2f630670.js"><link rel="prefetch" href="/assets/js/135.516248e9.js"><link rel="prefetch" href="/assets/js/136.c9fb3676.js"><link rel="prefetch" href="/assets/js/137.0d58b935.js"><link rel="prefetch" href="/assets/js/138.106b8051.js"><link rel="prefetch" href="/assets/js/139.3a4177bb.js"><link rel="prefetch" href="/assets/js/14.d98ee26c.js"><link rel="prefetch" href="/assets/js/140.cf104912.js"><link rel="prefetch" href="/assets/js/141.917d5919.js"><link rel="prefetch" href="/assets/js/142.d0c49c8f.js"><link rel="prefetch" href="/assets/js/143.e5647fcb.js"><link rel="prefetch" href="/assets/js/144.42362cf2.js"><link rel="prefetch" href="/assets/js/145.9f603000.js"><link rel="prefetch" href="/assets/js/146.9b30f1cd.js"><link rel="prefetch" href="/assets/js/148.0c69b088.js"><link rel="prefetch" href="/assets/js/149.2f219e93.js"><link rel="prefetch" href="/assets/js/15.d642d730.js"><link rel="prefetch" href="/assets/js/150.375474c6.js"><link rel="prefetch" href="/assets/js/151.66a582d5.js"><link rel="prefetch" href="/assets/js/152.1665682e.js"><link rel="prefetch" href="/assets/js/153.5a97da8e.js"><link rel="prefetch" href="/assets/js/154.3b76b78d.js"><link rel="prefetch" href="/assets/js/155.c92a6111.js"><link rel="prefetch" href="/assets/js/156.a247cd62.js"><link rel="prefetch" href="/assets/js/16.172153f0.js"><link rel="prefetch" href="/assets/js/17.ca69a778.js"><link rel="prefetch" href="/assets/js/18.3be7ba8f.js"><link rel="prefetch" href="/assets/js/19.4f66b5d8.js"><link rel="prefetch" href="/assets/js/20.8f0cd2cb.js"><link rel="prefetch" href="/assets/js/21.20681ba8.js"><link rel="prefetch" href="/assets/js/22.53b5baea.js"><link rel="prefetch" href="/assets/js/23.8b55cb0e.js"><link rel="prefetch" href="/assets/js/24.3328372c.js"><link rel="prefetch" href="/assets/js/25.ec23edd8.js"><link rel="prefetch" href="/assets/js/26.76e210a5.js"><link rel="prefetch" href="/assets/js/27.29b300ec.js"><link rel="prefetch" href="/assets/js/28.682ad17a.js"><link rel="prefetch" href="/assets/js/29.e1db4b89.js"><link rel="prefetch" href="/assets/js/30.796c2e36.js"><link rel="prefetch" href="/assets/js/31.912d2fae.js"><link rel="prefetch" href="/assets/js/32.60a749df.js"><link rel="prefetch" href="/assets/js/33.d87002b1.js"><link rel="prefetch" href="/assets/js/34.40a8b3f6.js"><link rel="prefetch" href="/assets/js/35.670ac802.js"><link rel="prefetch" href="/assets/js/36.e9f74d88.js"><link rel="prefetch" href="/assets/js/37.6d6f43d0.js"><link rel="prefetch" href="/assets/js/38.ef496ae1.js"><link rel="prefetch" href="/assets/js/39.fc216f43.js"><link rel="prefetch" href="/assets/js/4.01043612.js"><link rel="prefetch" href="/assets/js/40.3bd13625.js"><link rel="prefetch" href="/assets/js/41.3f331b95.js"><link rel="prefetch" href="/assets/js/42.3b26f469.js"><link rel="prefetch" href="/assets/js/43.744d42da.js"><link rel="prefetch" href="/assets/js/44.8b9a8908.js"><link rel="prefetch" href="/assets/js/45.19c8ed8e.js"><link rel="prefetch" href="/assets/js/46.29927647.js"><link rel="prefetch" href="/assets/js/47.e4f53070.js"><link rel="prefetch" href="/assets/js/48.108272d7.js"><link rel="prefetch" href="/assets/js/49.c1e35862.js"><link rel="prefetch" href="/assets/js/5.80b3dd9d.js"><link rel="prefetch" href="/assets/js/50.8af695e4.js"><link rel="prefetch" href="/assets/js/51.33ef3df2.js"><link rel="prefetch" href="/assets/js/52.58bb8f89.js"><link rel="prefetch" href="/assets/js/53.4c6b5e8a.js"><link rel="prefetch" href="/assets/js/54.5763a55d.js"><link rel="prefetch" href="/assets/js/55.15295e7d.js"><link rel="prefetch" href="/assets/js/56.61c94966.js"><link rel="prefetch" href="/assets/js/57.46def60f.js"><link rel="prefetch" href="/assets/js/58.119434b5.js"><link rel="prefetch" href="/assets/js/59.f712c9c5.js"><link rel="prefetch" href="/assets/js/6.a702a72d.js"><link rel="prefetch" href="/assets/js/60.2072c323.js"><link rel="prefetch" href="/assets/js/61.09518814.js"><link rel="prefetch" href="/assets/js/62.35a494eb.js"><link rel="prefetch" href="/assets/js/63.d31876c6.js"><link rel="prefetch" href="/assets/js/64.8f68a737.js"><link rel="prefetch" href="/assets/js/65.6b094c4b.js"><link rel="prefetch" href="/assets/js/66.7c5599cd.js"><link rel="prefetch" href="/assets/js/67.625cd24c.js"><link rel="prefetch" href="/assets/js/68.371f4f22.js"><link rel="prefetch" href="/assets/js/69.c45293ee.js"><link rel="prefetch" href="/assets/js/7.076cee01.js"><link rel="prefetch" href="/assets/js/70.7a22bd02.js"><link rel="prefetch" href="/assets/js/71.729213ff.js"><link rel="prefetch" href="/assets/js/72.0f07bfbc.js"><link rel="prefetch" href="/assets/js/73.4d0355d4.js"><link rel="prefetch" href="/assets/js/74.0f47f56e.js"><link rel="prefetch" href="/assets/js/75.d11ecf15.js"><link rel="prefetch" href="/assets/js/76.727f8a27.js"><link rel="prefetch" href="/assets/js/77.f71a8653.js"><link rel="prefetch" href="/assets/js/78.cb1a43c1.js"><link rel="prefetch" href="/assets/js/79.9e83573b.js"><link rel="prefetch" href="/assets/js/8.d5f02645.js"><link rel="prefetch" href="/assets/js/80.ffafa3ff.js"><link rel="prefetch" href="/assets/js/81.30de8c9b.js"><link rel="prefetch" href="/assets/js/82.4cb0a9a6.js"><link rel="prefetch" href="/assets/js/83.6bf25e9a.js"><link rel="prefetch" href="/assets/js/84.984a50d8.js"><link rel="prefetch" href="/assets/js/85.81009c16.js"><link rel="prefetch" href="/assets/js/86.3325dd7c.js"><link rel="prefetch" href="/assets/js/87.d9dea564.js"><link rel="prefetch" href="/assets/js/88.620d3c46.js"><link rel="prefetch" href="/assets/js/89.414375c4.js"><link rel="prefetch" href="/assets/js/9.f9048235.js"><link rel="prefetch" href="/assets/js/90.07be05fd.js"><link rel="prefetch" href="/assets/js/91.5b6132ee.js"><link rel="prefetch" href="/assets/js/92.efd68e29.js"><link rel="prefetch" href="/assets/js/93.4e37aebc.js"><link rel="prefetch" href="/assets/js/94.a306e6d9.js"><link rel="prefetch" href="/assets/js/95.ddbaa2e0.js"><link rel="prefetch" href="/assets/js/96.b4c98c12.js"><link rel="prefetch" href="/assets/js/97.3bca48ba.js"><link rel="prefetch" href="/assets/js/98.f52f497a.js"><link rel="prefetch" href="/assets/js/99.588f017d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.dfeb017d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>Awaken's blogs</h3> <p class="description" data-v-4e82dffc data-v-4e82dffc>Awaken's blogs</p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>Awaken</span>
            
          <!---->
          2024
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/wtw.jpg" alt="Awaken's blogs" class="logo"> <span class="site-name">Awaken's blogs</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/BigData/" class="nav-link"><i class="undefined"></i>
  BigData
</a></li><li class="dropdown-item"><!----> <a href="/categories/DAG/" class="nav-link"><i class="undefined"></i>
  DAG
</a></li><li class="dropdown-item"><!----> <a href="/categories/ES/" class="nav-link"><i class="undefined"></i>
  ES
</a></li><li class="dropdown-item"><!----> <a href="/categories/Flink/" class="nav-link"><i class="undefined"></i>
  Flink
</a></li><li class="dropdown-item"><!----> <a href="/categories/JUC/" class="nav-link"><i class="undefined"></i>
  JUC
</a></li><li class="dropdown-item"><!----> <a href="/categories/JVM/" class="nav-link"><i class="undefined"></i>
  JVM
</a></li><li class="dropdown-item"><!----> <a href="/categories/JavaSE/" class="nav-link"><i class="undefined"></i>
  JavaSE
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/LeetCode/" class="nav-link"><i class="undefined"></i>
  LeetCode
</a></li><li class="dropdown-item"><!----> <a href="/categories/LINUX/" class="nav-link"><i class="undefined"></i>
  LINUX
</a></li><li class="dropdown-item"><!----> <a href="/categories/Linux/" class="nav-link"><i class="undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/categories/DB/" class="nav-link"><i class="undefined"></i>
  DB
</a></li><li class="dropdown-item"><!----> <a href="/categories/SSM/" class="nav-link"><i class="undefined"></i>
  SSM
</a></li><li class="dropdown-item"><!----> <a href="/categories/RK/" class="nav-link"><i class="undefined"></i>
  RK
</a></li><li class="dropdown-item"><!----> <a href="/categories/MQ/" class="nav-link"><i class="undefined"></i>
  MQ
</a></li><li class="dropdown-item"><!----> <a href="/categories/redis/" class="nav-link"><i class="undefined"></i>
  redis
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spark/" class="nav-link"><i class="undefined"></i>
  Spark
</a></li><li class="dropdown-item"><!----> <a href="/categories/SpringBoot/" class="nav-link"><i class="undefined"></i>
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/categories/projects/" class="nav-link"><i class="undefined"></i>
  projects
</a></li><li class="dropdown-item"><!----> <a href="/categories/SpringCloud/" class="nav-link"><i class="undefined"></i>
  SpringCloud
</a></li><li class="dropdown-item"><!----> <a href="/categories/project1/" class="nav-link"><i class="undefined"></i>
  project1
</a></li><li class="dropdown-item"><!----> <a href="/categories/Tools/" class="nav-link"><i class="undefined"></i>
  Tools
</a></li><li class="dropdown-item"><!----> <a href="/categories/arthas/" class="nav-link"><i class="undefined"></i>
  arthas
</a></li><li class="dropdown-item"><!----> <a href="/categories/deploy/" class="nav-link"><i class="undefined"></i>
  deploy
</a></li><li class="dropdown-item"><!----> <a href="/categories/k8s/" class="nav-link"><i class="undefined"></i>
  k8s
</a></li><li class="dropdown-item"><!----> <a href="/categories/mall/" class="nav-link"><i class="undefined"></i>
  mall
</a></li><li class="dropdown-item"><!----> <a href="/categories/Python/" class="nav-link"><i class="undefined"></i>
  Python
</a></li><li class="dropdown-item"><!----> <a href="/categories/others/" class="nav-link"><i class="undefined"></i>
  others
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/documents/" class="nav-link"><i class="undefined"></i>
  documents
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/recoluan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><img src="/wtw.jpg" alt="author-avatar" class="personal-img" data-v-828910c6> <h3 class="name" data-v-828910c6>
    Awaken
  </h3> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>144</h3> <h6 data-v-828910c6>Articles</h6></div> <div data-v-828910c6><h3 data-v-828910c6>78</h3> <h6 data-v-828910c6>Tags</h6></div></div> <ul class="social-links" data-v-828910c6></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/BigData/" class="nav-link"><i class="undefined"></i>
  BigData
</a></li><li class="dropdown-item"><!----> <a href="/categories/DAG/" class="nav-link"><i class="undefined"></i>
  DAG
</a></li><li class="dropdown-item"><!----> <a href="/categories/ES/" class="nav-link"><i class="undefined"></i>
  ES
</a></li><li class="dropdown-item"><!----> <a href="/categories/Flink/" class="nav-link"><i class="undefined"></i>
  Flink
</a></li><li class="dropdown-item"><!----> <a href="/categories/JUC/" class="nav-link"><i class="undefined"></i>
  JUC
</a></li><li class="dropdown-item"><!----> <a href="/categories/JVM/" class="nav-link"><i class="undefined"></i>
  JVM
</a></li><li class="dropdown-item"><!----> <a href="/categories/JavaSE/" class="nav-link"><i class="undefined"></i>
  JavaSE
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/LeetCode/" class="nav-link"><i class="undefined"></i>
  LeetCode
</a></li><li class="dropdown-item"><!----> <a href="/categories/LINUX/" class="nav-link"><i class="undefined"></i>
  LINUX
</a></li><li class="dropdown-item"><!----> <a href="/categories/Linux/" class="nav-link"><i class="undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/categories/DB/" class="nav-link"><i class="undefined"></i>
  DB
</a></li><li class="dropdown-item"><!----> <a href="/categories/SSM/" class="nav-link"><i class="undefined"></i>
  SSM
</a></li><li class="dropdown-item"><!----> <a href="/categories/RK/" class="nav-link"><i class="undefined"></i>
  RK
</a></li><li class="dropdown-item"><!----> <a href="/categories/MQ/" class="nav-link"><i class="undefined"></i>
  MQ
</a></li><li class="dropdown-item"><!----> <a href="/categories/redis/" class="nav-link"><i class="undefined"></i>
  redis
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spark/" class="nav-link"><i class="undefined"></i>
  Spark
</a></li><li class="dropdown-item"><!----> <a href="/categories/SpringBoot/" class="nav-link"><i class="undefined"></i>
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/categories/projects/" class="nav-link"><i class="undefined"></i>
  projects
</a></li><li class="dropdown-item"><!----> <a href="/categories/SpringCloud/" class="nav-link"><i class="undefined"></i>
  SpringCloud
</a></li><li class="dropdown-item"><!----> <a href="/categories/project1/" class="nav-link"><i class="undefined"></i>
  project1
</a></li><li class="dropdown-item"><!----> <a href="/categories/Tools/" class="nav-link"><i class="undefined"></i>
  Tools
</a></li><li class="dropdown-item"><!----> <a href="/categories/arthas/" class="nav-link"><i class="undefined"></i>
  arthas
</a></li><li class="dropdown-item"><!----> <a href="/categories/deploy/" class="nav-link"><i class="undefined"></i>
  deploy
</a></li><li class="dropdown-item"><!----> <a href="/categories/k8s/" class="nav-link"><i class="undefined"></i>
  k8s
</a></li><li class="dropdown-item"><!----> <a href="/categories/mall/" class="nav-link"><i class="undefined"></i>
  mall
</a></li><li class="dropdown-item"><!----> <a href="/categories/Python/" class="nav-link"><i class="undefined"></i>
  Python
</a></li><li class="dropdown-item"><!----> <a href="/categories/others/" class="nav-link"><i class="undefined"></i>
  others
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/documents/" class="nav-link"><i class="undefined"></i>
  documents
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/recoluan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>Pandas</h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>Awaken</span>
            
          <!---->
          2024
        </a></span></div></div> <div data-v-1156296a><main class="page"><section><div class="page-title"><h1 class="title">Pandas</h1> <div data-v-1ff7123e><i class="iconfont reco-account" data-v-1ff7123e><span data-v-1ff7123e>Awaken</span></i> <i class="iconfont reco-date" data-v-1ff7123e><span data-v-1ff7123e>4/1/2024</span></i> <!----> <i class="tags iconfont reco-tag" data-v-1ff7123e><span class="tag-item" data-v-1ff7123e>Pandas</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="_1-下载安装"><a href="#_1-下载安装" class="header-anchor">#</a> 1. 下载安装</h2> <ul><li>下载使用Python类库集成安装包：anaconda
<ul><li>https://www.anaconda.com</li> <li>当今最流行的Python数据分析发行版</li> <li>已经安装了数据分析需要的几乎所有的类库</li></ul></li> <li>pip install pandas</li></ul> <h2 id="_2-pandas数据读取"><a href="#_2-pandas数据读取" class="header-anchor">#</a> 2. Pandas数据读取</h2> <blockquote><p>Pandas需要先读取表格类型的数据，然后进行分析</p></blockquote> <table><thead><tr><th>数据类型</th> <th>说明</th> <th>Pandas读取方法</th></tr></thead> <tbody><tr><td>csv、tsv、txt</td> <td>用逗号分隔、tab分割的纯文本文件</td> <td>pd.read_csv</td></tr> <tr><td>excel</td> <td>微软xls或者xlsx文件</td> <td>pd.read_excel</td></tr> <tr><td>mysql</td> <td>关系型数据库</td> <td>pd.read_sql</td></tr></tbody></table> <h2 id="_3-dataframe-series"><a href="#_3-dataframe-series" class="header-anchor">#</a> 3. DataFrame&amp;Series</h2> <ul><li><p>df.loc方法，根据行、列标签值查询</p> <ul><li>使用单个label值查询数据</li> <li>使用值列表批量查询</li> <li>使用数值区间进行范围查询</li> <li>使用条件表达式查询</li> <li>调用函数查询</li></ul></li> <li><p>df.iloc方法，根据行、列的数字位置查询</p></li> <li><p>df.where方法</p></li> <li><p>df.query方法</p></li></ul> <blockquote><p>.loc既能查询，也能覆盖写入，强烈推荐使用</p></blockquote> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># series： 是一种类似于一维数组的对象，它由一组数据(不同数据类型)以及一组与之相关的数据标签(即索引)组成</span>

<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

s1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token number">5.2</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 左侧为索引，右侧为数据</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span><span class="token operator">*</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span>index<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span><span class="token operator">*</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span>values<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=============dict===============&quot;</span><span class="token punctuation">)</span>
<span class="token builtin">dict</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'a'</span><span class="token punctuation">:</span><span class="token number">123</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">:</span><span class="token number">234</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">:</span><span class="token number">567</span><span class="token punctuation">}</span>
s2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>s2<span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;============================DataFrame==============================&quot;</span><span class="token punctuation">)</span>
<span class="token comment"># DataFrame 是一个表格型的数据格式</span>

data <span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token string">'state'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'linux'</span><span class="token punctuation">,</span> <span class="token string">'pandas'</span><span class="token punctuation">,</span> <span class="token string">'numpy'</span><span class="token punctuation">,</span><span class="token string">'pip'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'year'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">2000</span><span class="token punctuation">,</span><span class="token number">2001</span><span class="token punctuation">,</span><span class="token number">2003</span><span class="token punctuation">,</span><span class="token number">2005</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'pop'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1.5</span><span class="token punctuation">,</span><span class="token number">2.0</span><span class="token punctuation">,</span><span class="token number">3.6</span><span class="token punctuation">,</span><span class="token number">4.5</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>dtypes<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;===&quot;</span><span class="token operator">*</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token comment"># 查询列</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'year'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'year'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;==========row============&quot;</span><span class="token punctuation">)</span>
<span class="token comment"># 查询行</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;==========many rows============&quot;</span><span class="token punctuation">)</span>
<span class="token comment"># 查询多行</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h2 id="_4-新增列"><a href="#_4-新增列" class="header-anchor">#</a> 4. 新增列</h2> <ol><li>直接赋值</li> <li>apply方法</li> <li>assign方法</li> <li>按条件选择分组分别赋值</li></ol> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

model <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;../model.csv&quot;</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">[</span><span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;KW&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float'</span><span class="token punctuation">)</span>

<span class="token comment"># 1.新增一列</span>
<span class="token comment"># model[&quot;power_after&quot;] 其实是一个 Series，后面加法返回的也是一个 Series</span>
model<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token string">&quot;power_sub&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">[</span><span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span> <span class="token operator">-</span> model<span class="token punctuation">[</span><span class="token string">&quot;power_before&quot;</span><span class="token punctuation">]</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;time_stamp&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;power_before&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;power_after&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;power_sub&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=====================apply========================&quot;</span><span class="token punctuation">)</span>
<span class="token comment"># 2.新增列(apply)</span>
<span class="token keyword">def</span> <span class="token function">get_time_type</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> model<span class="token punctuation">[</span><span class="token string">&quot;time_stamp&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">&quot;2022/8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">&quot;08年&quot;</span>
    <span class="token keyword">elif</span> model<span class="token punctuation">[</span><span class="token string">&quot;time_stamp&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">&quot;2022/7&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token string">&quot;07年&quot;</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token string">&quot;其他年份&quot;</span>

<span class="token comment"># 注意需要设置 axis=1 ， 这是 Series 的 index是 columns</span>
model<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token string">&quot;time_type&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>get_time_type<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span>
<span class="token comment"># 查看时间类型的记数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">[</span><span class="token string">&quot;time_type&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 3.新增多列(assign)，原对象不变，返回一个新的对象</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;========================assign============================&quot;</span><span class="token punctuation">)</span>
new_model <span class="token operator">=</span> model<span class="token punctuation">.</span>assign<span class="token punctuation">(</span>
    <span class="token comment"># mw -&gt; kw</span>
    power_before_kw <span class="token operator">=</span> <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token string">&quot;power_before&quot;</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span>
    power_after_kw <span class="token operator">=</span> <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">1000</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>new_model<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;========================condition==================================&quot;</span><span class="token punctuation">)</span>
<span class="token comment"># 感觉power_after和power_before的差来判断是增加功率还是降低功率</span>
model<span class="token punctuation">[</span><span class="token string">&quot;power_sub_type&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
condition <span class="token operator">=</span> model<span class="token punctuation">[</span><span class="token string">&quot;power_sub&quot;</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;power_sub_type&quot;</span>
model<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>condition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;增加功率&quot;</span>
model<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>model<span class="token punctuation">[</span><span class="token string">&quot;power_sub&quot;</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;power_sub_type&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;降低功率&quot;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">[</span><span class="token string">&quot;power_sub_type&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h2 id="_5-数据统计函数"><a href="#_5-数据统计函数" class="header-anchor">#</a> 5. 数据统计函数</h2> <ol><li>汇总类统计</li> <li>唯一去重和按值计数</li> <li>相关系数和协方差</li></ol> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

model <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;../model.csv&quot;</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">[</span><span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;KW&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float'</span><span class="token punctuation">)</span>

prefix <span class="token operator">=</span> subfix <span class="token operator">=</span> <span class="token string">&quot;=&quot;</span><span class="token operator">*</span><span class="token number">20</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>prefix<span class="token punctuation">}</span></span><span class="token string">describe</span><span class="token interpolation"><span class="token punctuation">{</span>subfix<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token comment"># 提取所有数字列，并提供以下数据统计</span>
<span class="token comment"># count：记数</span>
<span class="token comment"># mean：平均值</span>
<span class="token comment"># std：标准差</span>
<span class="token comment"># min：最小值</span>
<span class="token comment"># max：最大值</span>
<span class="token comment"># 25%，50%，75%：返回数组的三个不同百分位置的数值，也就是统计学中的四分位数，其中50%对应的是中位数。</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>prefix<span class="token punctuation">}</span></span><span class="token string">Series</span><span class="token interpolation"><span class="token punctuation">{</span>subfix<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token comment"># 查看单个 Series 的值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">[</span><span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">[</span><span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">[</span><span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">[</span><span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 唯一去重和按值计数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>prefix<span class="token punctuation">}</span></span><span class="token string">唯一去重和按值记数</span><span class="token interpolation"><span class="token punctuation">{</span>subfix<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">[</span><span class="token string">&quot;power_before&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>unique<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">[</span><span class="token string">&quot;power_before&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 相关系数和协方差</span>
<span class="token comment"># 用途例如：</span>
<span class="token comment">#   1.两只股票是否同涨同跌？程度多大？正相关还是负相关</span>
<span class="token comment">#   2.产品销量的波动，跟那些因素正相关、负相关，程度多大？</span>

<span class="token comment"># 1.协方差：衡量同向反向程度，</span>
<span class="token comment">#   如果协方差为正，说明 X，Y同向变化，协方差越大，说明同向程度越高；</span>
<span class="token comment">#   如果协方差为负，说明 X，Y反向运动，协方差越小，说明反向程度越高</span>
<span class="token comment"># 2.相关系数：衡量相似度程度，</span>
<span class="token comment">#   当相关系数为1时，说明两个变量变化时的正向相似度最大，</span>
<span class="token comment">#   当相关系数为-1时，说明两个变量变化的反向相似度最大</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>prefix<span class="token punctuation">}</span></span><span class="token string">相关系数和协方差</span><span class="token interpolation"><span class="token punctuation">{</span>subfix<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

new_model <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>model<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'power_before'</span><span class="token punctuation">,</span> <span class="token string">'power_after'</span><span class="token punctuation">,</span> <span class="token string">'outdoor_temperature'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
new_model<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token string">&quot;power_sub&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> new_model<span class="token punctuation">[</span><span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span> <span class="token operator">-</span> new_model<span class="token punctuation">[</span><span class="token string">&quot;power_before&quot;</span><span class="token punctuation">]</span>

<span class="token comment"># 协方差矩阵</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>prefix<span class="token punctuation">}</span></span><span class="token string">cov</span><span class="token interpolation"><span class="token punctuation">{</span>subfix<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>new_model<span class="token punctuation">.</span>cov<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_string<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>new_model<span class="token punctuation">[</span><span class="token string">&quot;power_before&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cov<span class="token punctuation">(</span>new_model<span class="token punctuation">[</span><span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>prefix<span class="token punctuation">}</span></span><span class="token string">corr</span><span class="token interpolation"><span class="token punctuation">{</span>subfix<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>new_model<span class="token punctuation">.</span>corr<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 功率差和外部气温相关系数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>new_model<span class="token punctuation">[</span><span class="token string">&quot;power_sub&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>corr<span class="token punctuation">(</span>new_model<span class="token punctuation">[</span><span class="token string">&quot;outdoor_temperature&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><h2 id="_6-数据缺失处理"><a href="#_6-数据缺失处理" class="header-anchor">#</a> 6. 数据缺失处理</h2> <p>Pandas使用这些函数处理缺失值：</p> <ul><li>isnull和notnull：检查空值，可用于df和series</li> <li>dropna：丢弃、删除缺失值
<ul><li>axis：删除行还是列，{0 or 'index', 1 or 'columns'}, default 0</li> <li>how：如果等于 any 则任何值为空都删除，如果等于 all 则所有值为空才删除</li> <li>inplace：如果为 True则修改当前df，否则返回新的df</li></ul></li> <li>fillna：填充空值
<ul><li>value：用于填充的空值，可以是单个值，或者字典（key是列名，value是值）</li> <li>method：等于 ffill 则使用前一个不为空的值填充(forword fill)；等于 bfill 则使用后一个不为空的值填充(backword fill)</li> <li>axis：按行还是按列填充，{0 or 'index', 1 or 'columns'}</li> <li>inplace：如果为 True则修改当前df，否则返回新的df</li></ul></li></ul> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

prefix <span class="token operator">=</span> subfix <span class="token operator">=</span> <span class="token string">&quot;=&quot;</span><span class="token operator">*</span><span class="token number">20</span>

<span class="token comment"># 跳过前面的5行空行</span>
stud <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">&quot;./files/stud.xlsx&quot;</span><span class="token punctuation">,</span> skiprows<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>stud<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>prefix<span class="token punctuation">}</span></span><span class="token string">删除分数列为空的数据</span><span class="token interpolation"><span class="token punctuation">{</span>subfix<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>stud<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>stud<span class="token punctuation">[</span><span class="token string">&quot;分数&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>notnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>prefix<span class="token punctuation">}</span></span><span class="token string">删除全是空值的列</span><span class="token interpolation"><span class="token punctuation">{</span>subfix<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
stud<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token string">&quot;columns&quot;</span><span class="token punctuation">,</span>how<span class="token operator">=</span><span class="token string">'all'</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>prefix<span class="token punctuation">}</span></span><span class="token string">删除全是空值的行</span><span class="token interpolation"><span class="token punctuation">{</span>subfix<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
stud<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token string">&quot;index&quot;</span><span class="token punctuation">,</span>how<span class="token operator">=</span><span class="token string">'all'</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>prefix<span class="token punctuation">}</span></span><span class="token string">将分数列为空的数据填充为0</span><span class="token interpolation"><span class="token punctuation">{</span>subfix<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
stud<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;分数&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># 等同于</span>
<span class="token comment"># stud.loc[:, &quot;分数&quot;] = stud[&quot;分数&quot;].fillna(0)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>prefix<span class="token punctuation">}</span></span><span class="token string">将姓名的缺失值填充</span><span class="token interpolation"><span class="token punctuation">{</span>subfix<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
stud<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">&quot;ffill&quot;</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># stud.loc[:, &quot;姓名&quot;] = stud[&quot;姓名&quot;].fillna(method=&quot;ffill&quot;)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>stud<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>prefix<span class="token punctuation">}</span></span><span class="token string">将处理完成的excel进行保存</span><span class="token interpolation"><span class="token punctuation">{</span>subfix<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token comment"># index=False表示不希望将自动生成的索引一并导出</span>
stud<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span><span class="token string">&quot;./files/stud_clean.xlsx&quot;</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="_7-settingwithcopywarning报警"><a href="#_7-settingwithcopywarning报警" class="header-anchor">#</a> 7. SettingWithCopyWarning报警</h2> <div class="language-python line-numbers-mode"><pre class="language-python"><code>condition <span class="token operator">=</span> model<span class="token punctuation">[</span><span class="token string">&quot;time_stamp&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">&quot;2022&quot;</span><span class="token punctuation">)</span>
model<span class="token punctuation">[</span>condition<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;power_sub&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">[</span><span class="token string">&quot;power_before&quot;</span><span class="token punctuation">]</span> <span class="token operator">-</span> model<span class="token punctuation">[</span><span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>相当于 df.get(condition).set(power_sub)，第一步get发出报警，get得到的可能是dataframe的view也可能是copy</p></blockquote> <p>解决方法1：将get+set，改成set一步到位</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>model<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>condition<span class="token punctuation">,</span> <span class="token string">&quot;power_sub&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">[</span><span class="token string">&quot;power_before&quot;</span><span class="token punctuation">]</span> <span class="token operator">-</span> model<span class="token punctuation">[</span><span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>解决方法2：使用copy复制dataframe</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>new_model <span class="token operator">=</span> model<span class="token punctuation">[</span>condition<span class="token punctuation">]</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
new_model<span class="token punctuation">[</span><span class="token string">&quot;power_sub&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">[</span><span class="token string">&quot;power_before&quot;</span><span class="token punctuation">]</span> <span class="token operator">-</span> model<span class="token punctuation">[</span><span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>总之，Pandas不允许先筛选子dataframe，再进行修改</p> <p>要么使用 .loc一步到位</p> <p>要么复制一个子dataframe，再执行修改</p></blockquote> <h2 id="_8-数据排序"><a href="#_8-数据排序" class="header-anchor">#</a> 8. 数据排序</h2> <ul><li>Series.sort_values(ascending=True,inplace=False)
<ul><li>ascending：默认为 True 升序排序</li> <li>inplace：是否修改原Series</li></ul></li> <li>DataFrame.sort_values(by, ascending=True, inplace=False)
<ul><li>by：字符串或者 List&lt;字符串&gt;，单列排序或者多列排序</li> <li>ascending：bool或者List，升序还是降序，如果是 list 则对应 by的多列</li> <li>inplace：是否修改原始DataFrame</li></ul></li></ul> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

model <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;../model.csv&quot;</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">[</span><span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;KW&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float'</span><span class="token punctuation">)</span>

<span class="token comment"># 单个Series排序</span>
new_model <span class="token operator">=</span> model<span class="token punctuation">[</span><span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>new_model<span class="token punctuation">)</span>

<span class="token comment"># 多字段分别升序、降序</span>
new_model_by2 <span class="token operator">=</span> model<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;power_before&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ascending<span class="token operator">=</span><span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>new_model_by2<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="_9-字符串处理"><a href="#_9-字符串处理" class="header-anchor">#</a> 9. 字符串处理</h2> <div class="language-python line-numbers-mode"><pre class="language-python"><code>model<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">[</span><span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;KW&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>使用方法：先获取 Series 的 str 属性，然后在属性上调用函数</li> <li>只能在字符串列上使用，不能数字列上使用</li> <li>DataFrame上没有 str 属性和出列方法，这是Series特有的</li> <li>Series.str并不是Python原生字符串，而是自己的一套方法，不过大部分与原生相似</li></ul> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

model <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;../model.csv&quot;</span><span class="token punctuation">)</span>
<span class="token comment"># print(model.dtypes)</span>
<span class="token comment"># 不能在数字列上使用</span>
<span class="token comment"># model.loc[:, &quot;fcst_air_power&quot;] = model[&quot;fcst_air_power&quot;].str.replace(&quot;KW&quot;, &quot;&quot;).astype('float')</span>

<span class="token comment"># 判断是否为数字类型</span>
<span class="token comment"># print(model[&quot;time_stamp&quot;].str.isnumeric())</span>
<span class="token comment"># 获取长度</span>
<span class="token comment"># print(model[&quot;time_stamp&quot;].str.len())</span>

condition <span class="token operator">=</span> model<span class="token punctuation">[</span><span class="token string">&quot;time_stamp&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">&quot;2022/8&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">[</span>condition<span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 提取月份</span>
<span class="token comment"># print(model[&quot;time_stamp&quot;].str.replace(&quot;/&quot;, &quot;&quot;))</span>
<span class="token comment"># 每次调用函数都返回一个新 Series，Series无法直接调用 slice，所以需要重新获取 str 属性</span>
<span class="token comment"># model[&quot;time_stamp&quot;].str.replace(&quot;/&quot;, &quot;&quot;).slice(0, 6)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">[</span><span class="token string">&quot;time_stamp&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span><span class="token builtin">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># slice就是切片，可以直接用</span>
<span class="token comment"># print(model[&quot;time_stamp&quot;].str.replace(&quot;/&quot;, &quot;&quot;).str[0:6])</span>

<span class="token comment"># 添加新列，用于格式化日期</span>
<span class="token keyword">def</span> <span class="token function">getFormatDate</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">:</span>
    year<span class="token punctuation">,</span>month<span class="token punctuation">,</span>day <span class="token operator">=</span> d<span class="token punctuation">[</span><span class="token string">&quot;time_stamp&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>year<span class="token punctuation">}</span></span><span class="token string">年</span><span class="token interpolation"><span class="token punctuation">{</span>month<span class="token punctuation">}</span></span><span class="token string">月</span><span class="token interpolation"><span class="token punctuation">{</span>day<span class="token punctuation">}</span></span><span class="token string">日&quot;</span></span>
model<span class="token punctuation">[</span><span class="token string">&quot;time_stamp&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">[</span><span class="token string">&quot;time_stamp&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span><span class="token builtin">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
model<span class="token punctuation">[</span><span class="token string">&quot;中文日期&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>getFormatDate<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">[</span><span class="token string">&quot;中文日期&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 将 年/月/日，去除</span>
<span class="token comment"># 方法1：replace，忽略</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">[</span><span class="token string">&quot;中文日期&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;年&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;月&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;日&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 方法2：正则表达式 (Series默认开启了正则表达式模式)</span>
<span class="token comment"># print(model[&quot;中文日期&quot;].str.replace(f&quot;年|月|日&quot;, &quot;&quot;, regex = True))</span>
<span class="token comment"># print(model[&quot;中文日期&quot;].str.replace(&quot;年|月|日&quot;, &quot;&quot;, regex = True))</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">[</span><span class="token string">&quot;中文日期&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;[年月日]&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> regex <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h2 id="_10-axis参数"><a href="#_10-axis参数" class="header-anchor">#</a> 10. axis参数</h2> <ul><li>axis = 0 或者 &quot;index&quot;
<ul><li>如果是单行操作，就指的是某一行</li> <li>如果是聚合操作，指的是跨行cross rows</li></ul></li> <li>axis = 1 或者 &quot;columns&quot;
<ul><li>如果是单列操作，就指的是某一列</li> <li>如果是聚合操作，指的是跨列cross columns</li></ul></li></ul> <blockquote><p>按照哪个 axis，就是这个 axis 要动起来 (类似于被 for 遍历)，其他 axis 保持不动</p></blockquote> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>
    np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">,</span><span class="token string">'d'</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span>

<span class="token comment"># 删除某一列</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># print(df.drop('a', axis='columns'))</span>

<span class="token comment"># 删除某一行</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># print(df.drop(1, axis='index'))</span>

<span class="token comment"># 按照 axis=0/index执行mean聚合操作 (按照行来取平均值,即每一列数字的平均值)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 按照 axis=1/columns执行mean聚合操作 (按照列来取平均值,即每一行数字的平均值)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">get_sum_value</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> x<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span> <span class="token operator">+</span> x<span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span> <span class="token operator">+</span> x<span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span> <span class="token operator">+</span> x<span class="token punctuation">[</span><span class="token string">'d'</span><span class="token punctuation">]</span>
df<span class="token punctuation">[</span><span class="token string">'sum_value'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>get_sum_value<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="_11-index用途"><a href="#_11-index用途" class="header-anchor">#</a> 11. index用途</h2> <ul><li>方便数据查询</li> <li>使用index可以获得性能提升</li> <li>自动的数据对齐功能</li> <li>更多更强大的数据结构支持</li></ul> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> pymysql
<span class="token comment"># from sklearn.utils import shuffle</span>

conn <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>
    host<span class="token operator">=</span><span class="token string">&quot;192.168.1.102&quot;</span><span class="token punctuation">,</span>
    user<span class="token operator">=</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span>
    password<span class="token operator">=</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span>
    database<span class="token operator">=</span><span class="token string">&quot;digital_twin&quot;</span><span class="token punctuation">,</span>
    charset<span class="token operator">=</span><span class="token string">&quot;utf8&quot;</span>
<span class="token punctuation">)</span>

mysql_page <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_sql<span class="token punctuation">(</span><span class="token string">&quot;select * from station_info&quot;</span><span class="token punctuation">,</span> con <span class="token operator">=</span> conn<span class="token punctuation">)</span>
<span class="token comment"># drop=False，让索引列还保留在column中</span>
mysql_page<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> drop<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>mysql_page<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>mysql_page<span class="token punctuation">.</span>index<span class="token punctuation">)</span>

<span class="token comment"># 不使用索引查询数据</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>mysql_page<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>mysql_page<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'电站01'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 使用索引查询数据</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>mysql_page<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">'电站01'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 在Pandas中，如果你设置了某一列作为DataFrame的索引列，使用该列进行查询时，结果默认是按行索引的。</span>
<span class="token comment"># 如果你希望查询结果保持列的形式，可以使用.reset_index()方法将行索引重置为默认的整数索引，</span>
<span class="token comment"># 或者使用.T属性对数据进行转置。</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>mysql_page<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">'电站01'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to_frame<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>T<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h2 id="_12-merge"><a href="#_12-merge" class="header-anchor">#</a> 12. Merge</h2> <blockquote><p>Pandas的Merge，相当于Sql中的 join，将不同的表按 key 关联到一个表</p></blockquote> <h3 id="_12-1-merge语法"><a href="#_12-1-merge语法" class="header-anchor">#</a> 12.1 merge语法</h3> <blockquote><p>pd.merge(self/left, right, how: &quot;inner&quot;, on, left_on, right_on, left_index, right_index, sort, suffixes, copy, indicator, validate)</p></blockquote> <ul><li>left(self)，right：要merge的 df 或者有 name 的 Series</li> <li>how：join类型，'left', 'right', 'outer', 'inner'</li> <li>on：join的key，left和right都需要有这个key</li> <li>left_on：left的df或者series的key</li> <li>right_on：right的df或者series的key</li> <li>suffixes：两个元素的后缀，如果列有重名，自动添加后缀，默认是<code>('_x', '_y')</code></li></ul> <h2 id="_13-concat"><a href="#_13-concat" class="header-anchor">#</a> 13. concat</h2> <blockquote><p>使用场景：</p> <p>批量合并相同格式的Excel、给DataFrame添加行、给DataFrame添加列</p></blockquote> <ul><li>使用某种合并方式(inner/outer)</li> <li>沿着某个轴向(axis=0/1)</li> <li>把多个Pandas对象(DataFrame/Series)合并成一个。</li></ul> <p>concat语法：pandas.concat(objs, axis=0,join='outer', ignore_index=False)</p> <ul><li>objs：一个列表，内容可以是DataFrame或者Series，可以混合</li> <li>axis：默认是0代表按行合并</li> <li>join：合并时索引的对齐方式，默认是outer join，也可以是inner join</li> <li>ignore_index：是否忽略掉原来的数据索引</li></ul> <p>append语法：DataFrame.append(other, ignore_index=False)</p> <p>append只有按行合并，没有按列合并，相当于concat按行的简写形式</p> <ul><li>other：单个DataFrame、Series、dict，或者列表</li> <li>ignore_index：是否忽略掉原来的数据索引</li></ul> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token keyword">import</span> warnings

warnings<span class="token punctuation">.</span>filterwarnings<span class="token punctuation">(</span><span class="token string">'ignore'</span><span class="token punctuation">)</span>

df1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'A'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'A0'</span><span class="token punctuation">,</span> <span class="token string">'A1'</span><span class="token punctuation">,</span> <span class="token string">'A2'</span><span class="token punctuation">,</span> <span class="token string">'A3'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'B'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'B0'</span><span class="token punctuation">,</span> <span class="token string">'B1'</span><span class="token punctuation">,</span> <span class="token string">'B2'</span><span class="token punctuation">,</span> <span class="token string">'B3'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'C'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'C0'</span><span class="token punctuation">,</span> <span class="token string">'C1'</span><span class="token punctuation">,</span> <span class="token string">'C2'</span><span class="token punctuation">,</span> <span class="token string">'C3'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'D'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'D0'</span><span class="token punctuation">,</span> <span class="token string">'D1'</span><span class="token punctuation">,</span> <span class="token string">'D2'</span><span class="token punctuation">,</span> <span class="token string">'D3'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'E'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'E0'</span><span class="token punctuation">,</span> <span class="token string">'E1'</span><span class="token punctuation">,</span> <span class="token string">'E2'</span><span class="token punctuation">,</span> <span class="token string">'E3'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'A'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'A4'</span><span class="token punctuation">,</span> <span class="token string">'A5'</span><span class="token punctuation">,</span> <span class="token string">'A6'</span><span class="token punctuation">,</span> <span class="token string">'A7'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'B'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'B4'</span><span class="token punctuation">,</span> <span class="token string">'B5'</span><span class="token punctuation">,</span> <span class="token string">'B6'</span><span class="token punctuation">,</span> <span class="token string">'B7'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'C'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'C4'</span><span class="token punctuation">,</span> <span class="token string">'C5'</span><span class="token punctuation">,</span> <span class="token string">'C6'</span><span class="token punctuation">,</span> <span class="token string">'C7'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'D'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'D4'</span><span class="token punctuation">,</span> <span class="token string">'D5'</span><span class="token punctuation">,</span> <span class="token string">'D6'</span><span class="token punctuation">,</span> <span class="token string">'D7'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'F'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'F4'</span><span class="token punctuation">,</span> <span class="token string">'F5'</span><span class="token punctuation">,</span> <span class="token string">'F6'</span><span class="token punctuation">,</span> <span class="token string">'F7'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 默认concat，参数为axis=0, join=outer, ignore_index=False</span>
<span class="token comment"># print(pd.concat([df1, df2]))</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>df1<span class="token punctuation">,</span> df2<span class="token punctuation">]</span><span class="token punctuation">,</span> ignore_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 使用 inner join过滤不匹配的列</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>df1<span class="token punctuation">,</span> df2<span class="token punctuation">]</span><span class="token punctuation">,</span> join<span class="token operator">=</span><span class="token string">'inner'</span><span class="token punctuation">,</span> ignore_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># axis=1 相当于添加新列</span>
<span class="token comment"># 添加一列</span>
s1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'F'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>df1<span class="token punctuation">,</span> s1<span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 添加多列</span>
s2 <span class="token operator">=</span> df1<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;_GG&quot;</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment"># print(s2)</span>
s2<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;G&quot;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>df1<span class="token punctuation">,</span> s1<span class="token punctuation">,</span> s2<span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>s1<span class="token punctuation">,</span>s2<span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 使用 DF 的 append</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df1<span class="token punctuation">.</span>_append<span class="token punctuation">(</span>df2<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># print(df1._append(s2))</span>


df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 每次都在复制，性能很差</span>
    df <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'A'</span><span class="token punctuation">:</span> i<span class="token punctuation">}</span><span class="token punctuation">,</span> ignore_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># 一行一行地往DF中添加数据的高性能版</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span>
    <span class="token punctuation">[</span>pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    ignore_index<span class="token operator">=</span><span class="token boolean">True</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><h2 id="_14-文件拆分与合并"><a href="#_14-文件拆分与合并" class="header-anchor">#</a> 14. 文件拆分与合并</h2> <p>拆分</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> os

splits_dir <span class="token operator">=</span> <span class="token string">&quot;./files/split&quot;</span>

model <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;../model.csv&quot;</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">[</span><span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;KW&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float'</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>splits_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>splits_dir<span class="token punctuation">)</span>

<span class="token comment"># 打印 (行数,列数)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

total_row_count <span class="token operator">=</span> model<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

<span class="token comment"># 使用df.iloc，将一个大的df，拆分成多个小的df</span>

<span class="token comment"># 创建拆分任务所需要的人数</span>
user_names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'xiaohong'</span><span class="token punctuation">,</span> <span class="token string">'xiaoming'</span><span class="token punctuation">,</span> <span class="token string">'laowang'</span><span class="token punctuation">,</span> <span class="token string">'xiaozhang'</span><span class="token punctuation">,</span> <span class="token string">'xiaozhang'</span><span class="token punctuation">,</span> <span class="token string">'xiaok'</span><span class="token punctuation">]</span>

<span class="token comment"># 斜杠“/”（普通除法）执行浮点数除法，返回的结果是浮点数</span>
<span class="token comment"># 双斜杠“//”（地板除法或整数除法）执行整数除法，返回结果的整数部分</span>
<span class="token comment"># 每个人的任务数</span>
split_size <span class="token operator">=</span> total_row_count <span class="token operator">//</span> <span class="token builtin">len</span><span class="token punctuation">(</span>user_names<span class="token punctuation">)</span>
<span class="token keyword">if</span> total_row_count <span class="token operator">%</span> split_size <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
    split_size <span class="token operator">+=</span> <span class="token number">1</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>split_size<span class="token punctuation">)</span>

df_subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> idx<span class="token punctuation">,</span> user_name <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>user_names<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># iloc的开始索引</span>
    begin <span class="token operator">=</span> idx <span class="token operator">*</span> split_size
    <span class="token comment"># iloc的结束索引</span>
    end <span class="token operator">=</span> begin <span class="token operator">+</span> split_size
    <span class="token comment"># 实现 df 按照iloc拆分</span>
    df_sub <span class="token operator">=</span> model<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>begin<span class="token punctuation">:</span>end<span class="token punctuation">]</span>
    <span class="token comment"># 将每个子df存入列表</span>
    df_subs<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span> user_name<span class="token punctuation">,</span> df_sub<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 将每个df存入excel</span>
<span class="token keyword">for</span> idx<span class="token punctuation">,</span>user_name<span class="token punctuation">,</span>df_sub <span class="token keyword">in</span> df_subs<span class="token punctuation">:</span>
    file_name <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>splits_dir<span class="token punctuation">}</span></span><span class="token string">/model_</span><span class="token interpolation"><span class="token punctuation">{</span>idx<span class="token punctuation">}</span></span><span class="token string">_</span><span class="token interpolation"><span class="token punctuation">{</span>user_name<span class="token punctuation">}</span></span><span class="token string">.xlsx'</span></span>
    df_sub<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span>file_name<span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>合并</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span><span class="token operator">*</span><span class="token number">20</span> <span class="token operator">+</span> <span class="token string">&quot;多个小文件合并一个大文件&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span><span class="token operator">*</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token comment"># 1.遍历文件夹，得到要合并的Excel文件列表</span>
excel_names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> excel_name <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>splits_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    excel_names<span class="token punctuation">.</span>append<span class="token punctuation">(</span>excel_name<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>excel_names<span class="token punctuation">)</span>
df_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token comment"># 2.分别读取到dataframe，给每个df添加一列用于标记来源</span>
<span class="token keyword">for</span> excel_name <span class="token keyword">in</span> excel_names<span class="token punctuation">:</span>
    split_excel <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>splits_dir<span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span>excel_name<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    <span class="token comment"># 得到 user_name</span>
    user_name <span class="token operator">=</span> excel_name<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;model_&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;.xlsx&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    <span class="token comment"># print(excel_name, user_name)</span>
    <span class="token comment"># 给每个df添加1列，即用户名字</span>
    split_excel<span class="token punctuation">[</span><span class="token string">'user_name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> user_name
    df_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>split_excel<span class="token punctuation">)</span>
<span class="token comment"># 3.使用pd.concat进行df批量合并</span>
df_merged <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span>df_list<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df_merged<span class="token punctuation">)</span>
<span class="token comment"># 4.将合并后的dataframe输出到excel</span>
df_merged<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span><span class="token string">&quot;./files/model_merged.xlsx&quot;</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="_15-groupby分组统计"><a href="#_15-groupby分组统计" class="header-anchor">#</a> 15. groupby分组统计</h2> <blockquote><p>类似SQL：</p> <p><code>select city ,max(temperate) from city_weather group by city;</code></p></blockquote> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token keyword">import</span> warnings
<span class="token comment"># 忽略警告信息</span>
warnings<span class="token punctuation">.</span>filterwarnings<span class="token punctuation">(</span><span class="token string">'ignore'</span><span class="token punctuation">)</span>

df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'A'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'B'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'three'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'three'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'C'</span><span class="token punctuation">:</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'D'</span><span class="token punctuation">:</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span>

<span class="token comment"># 根据 A 列分组求和</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 多个列分组</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 取消索引</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> as_index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 对于某个groupby来说，可以同时查看多种数据统计结果</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">,</span>np<span class="token punctuation">.</span>std<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 查看单列的结果统计</span>
<span class="token comment"># 方法1：预过滤，性能更佳</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'C'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">,</span>np<span class="token punctuation">.</span>std<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 方法2：</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">,</span>np<span class="token punctuation">.</span>std<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'C'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 不同列使用不同的聚合函数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;C&quot;</span><span class="token punctuation">:</span>np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">,</span> <span class="token string">&quot;D&quot;</span><span class="token punctuation">:</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span><span class="token operator">*</span><span class="token number">20</span> <span class="token operator">+</span> <span class="token string">&quot;遍历GroupBy的结果&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span><span class="token operator">*</span><span class="token number">20</span><span class="token punctuation">)</span>
g <span class="token operator">=</span> df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> name<span class="token punctuation">,</span> group <span class="token keyword">in</span> g<span class="token punctuation">:</span>
    <span class="token comment"># print(name, group)</span>
    <span class="token comment"># print(type(group))</span>
    <span class="token keyword">pass</span>

<span class="token comment"># 获取单个分组的值</span>
<span class="token comment"># print(g.get_group('bar'))</span>

g <span class="token operator">=</span> df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> name<span class="token punctuation">,</span> group <span class="token keyword">in</span> g<span class="token punctuation">:</span>
    <span class="token comment"># print(name, group)</span>
    <span class="token comment"># print(type(group))</span>
    <span class="token keyword">pass</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>get_group<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token string">'one'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 查看每个月的最高功率</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span><span class="token operator">*</span><span class="token number">20</span> <span class="token operator">+</span> <span class="token string">&quot;查看每个月的最高功率&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span><span class="token operator">*</span><span class="token number">20</span><span class="token punctuation">)</span>
model <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;../model.csv&quot;</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">[</span><span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;KW&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float'</span><span class="token punctuation">)</span>

<span class="token comment"># 新增一列月份</span>
model<span class="token punctuation">[</span><span class="token string">&quot;month&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">[</span><span class="token string">&quot;time_stamp&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span>
data <span class="token operator">=</span> model<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">&quot;month&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 绘制图表</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

group_data <span class="token operator">=</span> model<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">&quot;month&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;power_after&quot;</span><span class="token punctuation">:</span>np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">,</span> <span class="token string">&quot;power_before&quot;</span><span class="token punctuation">:</span>np<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">,</span> <span class="token string">&quot;outdoor_temperature&quot;</span><span class="token punctuation">:</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">}</span><span class="token punctuation">)</span>
group_data<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 展示图表</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div><h2 id="_16-分层索引multiindex"><a href="#_16-分层索引multiindex" class="header-anchor">#</a> 16. 分层索引MultiIndex</h2> <ul><li>分层索引：在一个轴向上拥有多个索引层级，可以表达更高维度数据的形式</li> <li>可以更方便的进行数据筛选，如果有序则性能更好</li> <li>groupby等操作的结果，如果是多KEY，结果是分层索引，需要会使用</li> <li>一般不需要自己创建分层索引（MultiIndex有构造函数但一般不用）</li></ul> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> pymysql

conn <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>
    host<span class="token operator">=</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span>
    user<span class="token operator">=</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span>
    password<span class="token operator">=</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span>
    database<span class="token operator">=</span><span class="token string">&quot;digital_twin&quot;</span><span class="token punctuation">,</span>
    charset<span class="token operator">=</span><span class="token string">&quot;utf8&quot;</span>
<span class="token punctuation">)</span>

mysql_page <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_sql<span class="token punctuation">(</span><span class="token string">&quot;select * from station_info&quot;</span><span class="token punctuation">,</span> con <span class="token operator">=</span> conn<span class="token punctuation">)</span>
<span class="token comment"># print(mysql_page)</span>

mysql_page<span class="token punctuation">[</span><span class="token string">&quot;area&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>unique<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>mysql_page<span class="token punctuation">.</span>index<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>mysql_page<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">&quot;area&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&quot;installed_power&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 1.Series的分层索引MultiIndex</span>
ser <span class="token operator">=</span> mysql_page<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;area&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;station_type&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&quot;installed_power&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ser<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ser<span class="token punctuation">.</span>index<span class="token punctuation">)</span>
<span class="token comment"># unstack()：把二级索引变成列</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ser<span class="token punctuation">.</span>unstack<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># reset_index()：将两层索引变成普通的列，将Series转为一个包含3列的DF</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ser<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 2.Series有多层索引如何筛选数据？</span>
<span class="token comment"># 只筛选第一层索引</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ser<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">&quot;衢州市常山县&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 筛选两层索引</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ser<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">&quot;衢州市常山县&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 只筛选第二层索引</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ser<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 3.DataFrame的分层索引MultiIndex</span>
mysql_page<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'area'</span><span class="token punctuation">,</span> <span class="token string">'station_type'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># print(mysql_page)</span>
<span class="token comment"># 将数据根据索引进行排序</span>
mysql_page<span class="token punctuation">.</span>sort_index<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>mysql_page<span class="token punctuation">)</span>
<span class="token comment"># 4.DataFrame有多层索引如何筛选数据？</span>
<span class="token comment">#   1.元组(key1,key2)代表筛选多层索引，key1为索引第一季，key2为索引第二级</span>
<span class="token comment">#   2.列表[key1,key2]代表同一层的多个key</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>mysql_page<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">'衢州市常山县'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 筛选两层索引</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>mysql_page<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'衢州市常山县'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 或者</span>
<span class="token comment"># print(mysql_page.loc[('衢州市常山县', '2'), :])</span>
<span class="token comment"># 查看指定列</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>mysql_page<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'衢州市常山县'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 筛选单层索引多个值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>mysql_page<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'衢州市常山县'</span><span class="token punctuation">,</span> <span class="token string">'衢州市柯城区'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 或者</span>
<span class="token comment"># print(mysql_page.loc[['衢州市常山县', '衢州市柯城区'], :])</span>

<span class="token comment"># 同时筛选多层索引分别的多个值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>mysql_page<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'衢州市常山县'</span><span class="token punctuation">,</span> <span class="token string">'衢州市柯城区'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># slice(None)代表筛选这一索引的所有内容</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>mysql_page<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">slice</span><span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>mysql_page<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><h2 id="_17-数据转换函数"><a href="#_17-数据转换函数" class="header-anchor">#</a> 17. 数据转换函数</h2> <ul><li>map
<ul><li>只用于 Series，实现每个值-&gt;值的映射</li></ul></li> <li>apply
<ul><li>既可用于 Series实现每个值的处理，也可用于DF实现某个轴的Series的处理</li></ul></li> <li>applymap
<ul><li>只能用于DF，用于处理该DF中的每个元素</li></ul></li></ul> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> pymysql

conn <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>
    host<span class="token operator">=</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span>
    user<span class="token operator">=</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span>
    password<span class="token operator">=</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span>
    database<span class="token operator">=</span><span class="token string">&quot;digital_twin&quot;</span><span class="token punctuation">,</span>
    charset<span class="token operator">=</span><span class="token string">&quot;utf8&quot;</span>
<span class="token punctuation">)</span>

mysql_page <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_sql<span class="token punctuation">(</span><span class="token string">&quot;select * from station_info&quot;</span><span class="token punctuation">,</span> con <span class="token operator">=</span> conn<span class="token punctuation">)</span>
mysql_page<span class="token punctuation">[</span><span class="token string">&quot;area&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>unique<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># map</span>
dict_area <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;衢州市常山县&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;330822&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;衢州市柯城区&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;330802&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;衢州市衢江区&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;330803&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;衢州市开化县&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;330824&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;衢州市龙游县&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;330825&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;衢州市江山市&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;330881&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment"># 参数：字典</span>
<span class="token comment"># .str.lower() 转小写</span>
mysql_page<span class="token punctuation">[</span><span class="token string">'area_code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> mysql_page<span class="token punctuation">[</span><span class="token string">'area'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>dict_area<span class="token punctuation">)</span>
<span class="token comment"># 参数：函数</span>
mysql_page<span class="token punctuation">[</span><span class="token string">'area_code1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> mysql_page<span class="token punctuation">[</span><span class="token string">'area'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> dict_area<span class="token punctuation">[</span>x<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># apply</span>
<span class="token comment"># Series.apply(function)：函数的参数是每个值</span>
mysql_page<span class="token punctuation">[</span><span class="token string">'area_code2'</span><span class="token punctuation">]</span> <span class="token operator">=</span> mysql_page<span class="token punctuation">[</span><span class="token string">'area'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> dict_area<span class="token punctuation">[</span>x<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># DataFrame.apply(function)：函数的参数是Series</span>
<span class="token comment"># 指定参数  axis=1 ，所以 Series的key是列名</span>
mysql_page<span class="token punctuation">[</span><span class="token string">'area_code3'</span><span class="token punctuation">]</span> <span class="token operator">=</span> mysql_page<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> dict_area<span class="token punctuation">[</span>x<span class="token punctuation">[</span><span class="token string">'area'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># applymap</span>
sub_page <span class="token operator">=</span> mysql_page<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'longitude'</span><span class="token punctuation">,</span><span class="token string">'latitude'</span><span class="token punctuation">,</span><span class="token string">'installed_power'</span><span class="token punctuation">,</span> <span class="token string">'active_power'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token comment"># print(sub_page.head())</span>
<span class="token comment"># 将这些列取整处理</span>
<span class="token comment"># print(sub_page.applymap(lambda x: int(x)))</span>
<span class="token comment"># 直接修改原df的这几列</span>
mysql_page<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'longitude'</span><span class="token punctuation">,</span><span class="token string">'latitude'</span><span class="token punctuation">,</span><span class="token string">'installed_power'</span><span class="token punctuation">,</span> <span class="token string">'active_power'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> sub_page<span class="token punctuation">.</span>applymap<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># pd.set_option('display.max_rows', None)</span>
pd<span class="token punctuation">.</span>set_option<span class="token punctuation">(</span><span class="token string">'display.max_columns'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>mysql_page<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><h2 id="_18-group后进行apply"><a href="#_18-group后进行apply" class="header-anchor">#</a> 18.Group后进行apply</h2> <p><img src="https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/python%2Fgroup_apply.png" alt=""></p> <h3 id="归一化"><a href="#归一化" class="header-anchor">#</a> 归一化</h3> <p>将不同范围的数值列进行归一化，映射到[0,1]区间：</p> <ul><li>更容易做数据横向对比，比如价格字段是几百到几千，增幅字段是0到100</li> <li>机器学习模型学的更快性能更好</li></ul> <p><img src="https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/python%2F%E5%BD%92%E4%B8%80%E5%8C%96.png" alt=""></p> <p>X：当前值；Xmin：当前这组数据的最小值，Xmax：当前这组数据的最大值</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> warnings

warnings<span class="token punctuation">.</span>filterwarnings<span class="token punctuation">(</span><span class="token string">&quot;ignore&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># 1.对数值列按分组归一化</span>
ratings <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;./files/ratings.dat&quot;</span><span class="token punctuation">)</span>
<span class="token comment"># print(ratings)</span>

<span class="token comment"># 实现按照用户ID分组，然后对其中一列进行归一化</span>
<span class="token keyword">def</span> <span class="token function">rating_norm</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    @param df: 每个用户分组的DataFrame
    &quot;&quot;&quot;</span>
    min_value <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">&quot;Rating&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    max_value <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">&quot;Rating&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    df<span class="token punctuation">[</span><span class="token string">'Rating_Norm'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">&quot;Rating&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> min_value<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>max_value <span class="token operator">-</span> min_value<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> df

ratings <span class="token operator">=</span> ratings<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">&quot;UserId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>rating_norm<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ratings<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>ratings<span class="token punctuation">[</span>ratings<span class="token punctuation">[</span><span class="token string">'UserId'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 2.怎样取每个分组的TopN数据</span>

<span class="token comment"># 获取每个月温度最高的两天数据</span>
model <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;../model.csv&quot;</span><span class="token punctuation">)</span>
<span class="token comment"># 新增一列月份</span>
model<span class="token punctuation">[</span><span class="token string">'月份'</span><span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token string">&quot;time_stamp&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">wenduTopN</span><span class="token punctuation">(</span>df<span class="token punctuation">,</span> topn<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    这里的df，是每个月分组groupby后的df
    &quot;&quot;&quot;</span>
    <span class="token keyword">return</span> df<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token string">&quot;outdoor_temperature&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;time_stamp&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;outdoor_temperature&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span>topn<span class="token punctuation">:</span><span class="token punctuation">]</span>

pd<span class="token punctuation">.</span>set_option<span class="token punctuation">(</span><span class="token string">'display.max_rows'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">&quot;月份&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>wenduTopN<span class="token punctuation">,</span> topn<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h2 id="_19-stack和pivot实现数据透视"><a href="#_19-stack和pivot实现数据透视" class="header-anchor">#</a> 19. Stack和pivot实现数据透视</h2> <p><img src="https://lskyimage-1306894954.cos.ap-nanjing.myqcloud.com/python%2F%E6%95%B0%E6%8D%AE%E9%80%8F%E8%A7%86.png" alt=""></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> warnings

warnings<span class="token punctuation">.</span>filterwarnings<span class="token punctuation">(</span><span class="token string">&quot;ignore&quot;</span><span class="token punctuation">)</span>

ratings <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;./files/ratings.dat&quot;</span><span class="token punctuation">)</span>
ratings<span class="token punctuation">[</span><span class="token string">'pdate'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>ratings<span class="token punctuation">[</span><span class="token string">'Timestamp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ratings<span class="token punctuation">.</span>dtypes<span class="token punctuation">)</span>

<span class="token comment"># 1.实现数据统计</span>
ratings_group <span class="token operator">=</span> ratings<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span>ratings<span class="token punctuation">[</span><span class="token string">&quot;pdate&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dt<span class="token punctuation">.</span>month<span class="token punctuation">,</span> <span class="token string">'Rating'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'UserId'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span>pv<span class="token operator">=</span>np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ratings_group<span class="token punctuation">)</span>

<span class="token comment"># 2.使用unstack()实现数据二维透视</span>
<span class="token comment"># 目的：想要画图对比按照月份的不同评分的数量趋势</span>
ratings_stack <span class="token operator">=</span> ratings_group<span class="token punctuation">.</span>unstack<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ratings_stack<span class="token punctuation">)</span>

ratings_stack<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># plt.show()</span>

<span class="token comment"># unstack()和stack()是互逆操作</span>
<span class="token comment"># print(ratings_stack.stack())</span>


<span class="token comment"># 3.使用pivot简化透视</span>
rat_reset <span class="token operator">=</span> ratings_group<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>rat_reset<span class="token punctuation">)</span>

rat_pivot <span class="token operator">=</span> rat_reset<span class="token punctuation">.</span>pivot<span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token string">'pdate'</span><span class="token punctuation">,</span> columns <span class="token operator">=</span> <span class="token string">'Rating'</span><span class="token punctuation">,</span> values<span class="token operator">=</span> <span class="token string">'pv'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>rat_pivot<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h2 id="_20-使用apply添加多列"><a href="#_20-使用apply添加多列" class="header-anchor">#</a> 20. 使用apply添加多列</h2> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

model <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;../model.csv&quot;</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">[</span><span class="token string">&quot;power_after&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;KW&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">my_func</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> row<span class="token punctuation">[</span><span class="token string">'power_after'</span><span class="token punctuation">]</span> <span class="token operator">-</span> row<span class="token punctuation">[</span><span class="token string">'power_before'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'power_after'</span><span class="token punctuation">]</span> <span class="token operator">+</span> row<span class="token punctuation">[</span><span class="token string">'power_before'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span>

model<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'power_sub'</span><span class="token punctuation">,</span> <span class="token string">'avg'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>my_func<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> result_type<span class="token operator">=</span><span class="token string">'expand'</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">5 months ago</span></div></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-70334359><li class="level-2" data-v-70334359><a href="/blogs/python/pandas.html#_1-下载安装" class="sidebar-link reco-side-_1-下载安装" data-v-70334359>1. 下载安装</a></li><li class="level-2" data-v-70334359><a href="/blogs/python/pandas.html#_2-pandas数据读取" class="sidebar-link reco-side-_2-pandas数据读取" data-v-70334359>2. Pandas数据读取</a></li><li class="level-2" data-v-70334359><a href="/blogs/python/pandas.html#_3-dataframe-series" class="sidebar-link reco-side-_3-dataframe-series" data-v-70334359>3. DataFrame&amp;Series</a></li><li class="level-2" data-v-70334359><a href="/blogs/python/pandas.html#_4-新增列" class="sidebar-link reco-side-_4-新增列" data-v-70334359>4. 新增列</a></li><li class="level-2" data-v-70334359><a href="/blogs/python/pandas.html#_5-数据统计函数" class="sidebar-link reco-side-_5-数据统计函数" data-v-70334359>5. 数据统计函数</a></li><li class="level-2" data-v-70334359><a href="/blogs/python/pandas.html#_6-数据缺失处理" class="sidebar-link reco-side-_6-数据缺失处理" data-v-70334359>6. 数据缺失处理</a></li><li class="level-2" data-v-70334359><a href="/blogs/python/pandas.html#_7-settingwithcopywarning报警" class="sidebar-link reco-side-_7-settingwithcopywarning报警" data-v-70334359>7. SettingWithCopyWarning报警</a></li><li class="level-2" data-v-70334359><a href="/blogs/python/pandas.html#_8-数据排序" class="sidebar-link reco-side-_8-数据排序" data-v-70334359>8. 数据排序</a></li><li class="level-2" data-v-70334359><a href="/blogs/python/pandas.html#_9-字符串处理" class="sidebar-link reco-side-_9-字符串处理" data-v-70334359>9. 字符串处理</a></li><li class="level-2" data-v-70334359><a href="/blogs/python/pandas.html#_10-axis参数" class="sidebar-link reco-side-_10-axis参数" data-v-70334359>10. axis参数</a></li><li class="level-2" data-v-70334359><a href="/blogs/python/pandas.html#_11-index用途" class="sidebar-link reco-side-_11-index用途" data-v-70334359>11. index用途</a></li><li class="level-2" data-v-70334359><a href="/blogs/python/pandas.html#_12-merge" class="sidebar-link reco-side-_12-merge" data-v-70334359>12. Merge</a></li><li class="level-3" data-v-70334359><a href="/blogs/python/pandas.html#_12-1-merge语法" class="sidebar-link reco-side-_12-1-merge语法" data-v-70334359>12.1 merge语法</a></li><li class="level-2" data-v-70334359><a href="/blogs/python/pandas.html#_13-concat" class="sidebar-link reco-side-_13-concat" data-v-70334359>13. concat</a></li><li class="level-2" data-v-70334359><a href="/blogs/python/pandas.html#_14-文件拆分与合并" class="sidebar-link reco-side-_14-文件拆分与合并" data-v-70334359>14. 文件拆分与合并</a></li><li class="level-2" data-v-70334359><a href="/blogs/python/pandas.html#_15-groupby分组统计" class="sidebar-link reco-side-_15-groupby分组统计" data-v-70334359>15. groupby分组统计</a></li><li class="level-2" data-v-70334359><a href="/blogs/python/pandas.html#_16-分层索引multiindex" class="sidebar-link reco-side-_16-分层索引multiindex" data-v-70334359>16. 分层索引MultiIndex</a></li><li class="level-2" data-v-70334359><a href="/blogs/python/pandas.html#_17-数据转换函数" class="sidebar-link reco-side-_17-数据转换函数" data-v-70334359>17. 数据转换函数</a></li><li class="level-2" data-v-70334359><a href="/blogs/python/pandas.html#_18-group后进行apply" class="sidebar-link reco-side-_18-group后进行apply" data-v-70334359>18.Group后进行apply</a></li><li class="level-3" data-v-70334359><a href="/blogs/python/pandas.html#归一化" class="sidebar-link reco-side-归一化" data-v-70334359>归一化</a></li><li class="level-2" data-v-70334359><a href="/blogs/python/pandas.html#_19-stack和pivot实现数据透视" class="sidebar-link reco-side-_19-stack和pivot实现数据透视" data-v-70334359>19. Stack和pivot实现数据透视</a></li><li class="level-2" data-v-70334359><a href="/blogs/python/pandas.html#_20-使用apply添加多列" class="sidebar-link reco-side-_20-使用apply添加多列" data-v-70334359>20. 使用apply添加多列</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div></div><APlayer audio="" fixed="true" mini="true" theme="#f9bcdd" loop="loop" order="random" preload="auto" volume="0.3" mutex="true" lrc-type="0" list-folded="true" list-max-height="250" storage-name="vuepress-plugin-meting" id="aplayer-fixed"></APlayer></div></div>
    <script src="/assets/js/app.03646987.js" defer></script><script src="/assets/js/3.a8134f0a.js" defer></script><script src="/assets/js/1.a394b090.js" defer></script><script src="/assets/js/147.00acaf92.js" defer></script>
  </body>
</html>
